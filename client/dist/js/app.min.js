"use strict";function config($stateProvider,$urlRouterProvider,$locationProvider,$mdThemingProvider,$httpProvider){$urlRouterProvider.otherwise("/home"),$stateProvider.state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginCtrl",controllerAs:"sesion"}).state("index",{url:"/","abstract":!0,templateUrl:"views/base.html"}).state("index.home",{url:"home",templateUrl:"views/home.html",controller:"homeCtrl"}).state("index.usuarios",{url:"usuarios",templateUrl:"views/usuarios.html",controller:"usuariosCtrl",controllerAs:"usuarios",resolve:{datos:function(usuarios){return usuarios.query().$promise}}}).state("index.perfiles",{url:"perfiles",templateUrl:"views/perfiles.html",controller:"perfilesCtrl",controllerAs:"perfiles",resolve:{datos:function(permisos){return permisos.query().$promise}}}).state("index.tipositem",{url:"tipositem",templateUrl:"views/tipositem.html",controller:"tiposItemCtrl",controllerAs:"tipositem",resolve:{datos:function(tipositem){return tipositem.query().$promise}}}).state("index.subtipositem",{url:"subtipositem",templateUrl:"views/subtipositem.html",controller:"subTiposItemCtrl",controllerAs:"subtipositem",resolve:{datos:function(subtipositem){return subtipositem.query().$promise}}}).state("index.proveedores",{url:"proveedores",templateUrl:"views/proveedores.html",controller:"proveedoresCtrl",controllerAs:"proveedores",resolve:{datos:function(proveedores){return proveedores.query().$promise}}}).state("index.items",{url:"items",templateUrl:"views/items.html",controller:"itemsCtrl",controllerAs:"items",resolve:{datos:function(items){return items.query().$promise}}}).state("index.tiposalmacen",{url:"tiposalmacen",templateUrl:"views/tiposalmacen.html",controller:"tiposAlmacenCtrl",controllerAs:"tiposalmacen",resolve:{datos:function(tiposalmacen){return tiposalmacen.query().$promise}}}).state("index.almacenes",{url:"almacenes",templateUrl:"views/almacenes.html",controller:"almacenesCtrl",controllerAs:"almacenes",resolve:{datos:function(almacenes){return almacenes.query().$promise}}}).state("index.conexiones",{url:"conexiones",templateUrl:"views/conexiones.html",controller:function($rootScope){$rootScope.titulo="Conexiones"}}).state("index.usualm",{url:"usualm",templateUrl:"views/usuarioalmacen.html",controller:"usualmCtrl",controllerAs:"usualm",resolve:{datos:function(busqueda,$q){var promesa=$q.defer(),usuarios=busqueda.usuariosAlmacen();return $q.all([usuarios]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.itempro",{url:"itempro",templateUrl:"views/itempro.html",controller:"itemproCtrl",controllerAs:"itempro",resolve:{datos:function(busqueda){return busqueda.itemsProveedor()}}}).state("index.existencias",{url:"existencias",templateUrl:"views/existencias.html",controller:"existenciasCtrl",controllerAs:"existencias",resolve:{datos:function(busqueda,$rootScope){return busqueda.existencias($rootScope.id)}}}),$locationProvider.html5Mode(!0),$mdThemingProvider.theme("theme1").primaryPalette("indigo").accentPalette("red").warnPalette("deep-orange"),$mdThemingProvider.theme("theme2").primaryPalette("red").accentPalette("deep-purple"),$mdThemingProvider.theme("theme3").primaryPalette("purple").accentPalette("deep-orange"),$mdThemingProvider.theme("theme4").primaryPalette("blue-grey").accentPalette("deep-purple"),$mdThemingProvider.theme("theme5").primaryPalette("teal").accentPalette("indigo"),$mdThemingProvider.theme("theme6").primaryPalette("green").accentPalette("deep-purple"),$mdThemingProvider.theme("theme7").primaryPalette("amber").accentPalette("blue"),$mdThemingProvider.theme("theme8").primaryPalette("orange").accentPalette("cyan"),$mdThemingProvider.theme("theme9").primaryPalette("blue").accentPalette("red"),$mdThemingProvider.theme("theme10").primaryPalette("light-green").accentPalette("indigo"),$mdThemingProvider.setDefaultTheme("theme1"),$mdThemingProvider.alwaysWatchTheme(!0),$httpProvider.defaults.timeout=1e4}function run($rootScope,$state,$mdSidenav,$mdBottomSheet,auth,webStorage){var url="";$rootScope.toggleSidenav=function(menuId){$mdSidenav(menuId).toggle()},$rootScope.listItemClick=function(){},$rootScope.showGridBottomSheet=function($event){$mdBottomSheet.show({templateUrl:"views/interactivo.html",targetEvent:$event})},$rootScope.logout=function(){$mdBottomSheet.hide(),auth.logout()},$rootScope.ir=function(ruta){$mdSidenav("left").toggle(),$state.go(ruta)},$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){url=toState.name,"login"!=url&&null==webStorage.session.get("username")&&(event.preventDefault(),$state.go("login")),"login"==url&&null!=webStorage.session.get("username")&&(event.preventDefault(),$state.go("index.home")),$rootScope.cargando=!0}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$rootScope.cargando=!1}),$rootScope.username=webStorage.session.get("username"),$rootScope.nombre=webStorage.session.get("nombre"),$rootScope.id=webStorage.session.get("id")}function almacenesCtrl($rootScope,$mdDialog,datos,almacenes,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Almacenes Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:almacenCtrl,templateUrl:"views/almacen.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=almacenes.query()})},scope.edita=function(ev,index){var usuario=scope.info[index];$mdDialog.show({controller:almacenEditCtrl,templateUrl:"views/almacen.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario}}).then(function(){scope.info=almacenes.query()})},scope.confirmacion=function(ev,index){var almacen=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el almacen?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar almacen").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){almacen.ALM_activo=almacen.ALM_activo?0:1;var datos={nombre:almacen.ALM_nombre,observaciones:almacen.ALM_observaciones,ubicacion:almacen.ALM_ubicacion,tipo:almacen.TAL_clave,unidad:almacen.UNI_clave,activo:almacen.ALM_activo};almacenes.update({almacen:almacen.ALM_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function almacenCtrl($scope,$mdDialog,busqueda,almacenes,mensajes){busqueda.unidades().then(function(info){$scope.unidades=info.data}),busqueda.tiposAlmacen().then(function(info){$scope.tiposalmacen=info.data}),$scope.inicio=function(){$scope.datos={nombre:"",observaciones:"",ubicacion:"",tipo:"",unidad:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.almacenForm.$valid&&($scope.guardando=!0,almacenes.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.almacenForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function almacenEditCtrl($scope,$mdDialog,busqueda,almacenes,mensajes,informacion){busqueda.unidades().then(function(info){$scope.unidades=info.data}),busqueda.tiposAlmacen().then(function(info){$scope.tiposalmacen=info.data}),$scope.inicio=function(){$scope.datos={nombre:informacion.ALM_nombre,observaciones:informacion.ALM_observaciones,ubicacion:informacion.ALM_ubicacion,tipo:informacion.TAL_clave,unidad:informacion.UNI_clave,activo:informacion.ALM_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.almacenForm.$valid&&($scope.guardando=!0,almacenes.update({almacen:informacion.ALM_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.almacenForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function homeCtrl($rootScope){$rootScope.tema="theme1",$rootScope.titulo="Bienvenido"}function itemproCtrl($rootScope,datos,$mdDialog,busqueda,operacion){var scope=this;$rootScope.titulo="Conexiones",$rootScope.cargando=!1,$rootScope.tema="theme1",scope.items=datos.data,scope.inicio=function(){scope.total=0,scope.limit=10,scope.page=1},scope.nuevo=function(ev){$mdDialog.show({controller:nuevoItemproCtrl,templateUrl:"views/altaitempro.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){busqueda.itemsProveedor().success(function(data){scope.items=data})})},scope.confirma=function(ev,index,almacen){var usuario=scope.usuarios[index],confirm=$mdDialog.confirm().title("¿Seguro que deseas asignar este almacen?").content("").ariaLabel("Asignar Almacen").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){operacion.bajaAlmacen(almacen.ALM_clave,usuario.clave)},function(){busqueda.usuariosAlmacen().success(function(data){scope.items=data})})}}function nuevoItemproCtrl($scope,$mdDialog,busqueda,mensajes,$q,$filter,operacion,$rootScope){function consultado(query){var q=$q.defer();return findValues(query,$scope.items).then(function(res){q.resolve(res)}),q.promise}function findValues(query,obj){var deferred=$q.defer();return deferred.resolve($filter("filter")(obj,query)),deferred.promise}busqueda.proveedores().then(function(info){$scope.proveedores=info.data}),busqueda.items().then(function(info){$scope.items=info.data}),$scope.inicio=function(){$scope.seleccionado=null,$scope.busqueda=null,$scope.consultado=consultado,$scope.datos={usuarioasigno:$rootScope.id,item:"",proveedor:"",cantidad:""},$scope.guardando=!1},$scope.guardar=function(){console.log($scope.datos),$scope.guardando=!0,operacion.altaItempro($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.inicio()}).error(function(error){})},$scope.cancel=function(){$mdDialog.hide()}}function itemsCtrl($rootScope,$mdDialog,datos,items,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Items Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:itemCtrl,templateUrl:"views/item.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=items.query()})},scope.edita=function(ev,index){var usuario=scope.info[index];$mdDialog.show({controller:itemEditCtrl,templateUrl:"views/item.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario}}).then(function(){scope.info=items.query()})},scope.confirmacion=function(ev,index){var item=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar item").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){item.ITE_activo=item.ITE_activo?0:1;var datos={nombre:item.ITE_nombre,precio:item.ITE_precioventa,cantidad:item.ITE_cantidadtotal,tipo:item.TIT_clave,subtipo:item.STI_clave,activo:item.ITE_activo};items.update({item:item.ITE_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function itemCtrl($scope,$mdDialog,busqueda,items,mensajes){busqueda.tiposItem().then(function(info){$scope.tipoitems=info.data}),busqueda.SubTiposItem().then(function(info){$scope.subtipoitems=info.data}),$scope.inicio=function(){$scope.datos={nombre:"",precio:"",cantidad:"",tipo:"",subtipo:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.itemForm.$valid&&($scope.guardando=!0,items.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.itemForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function itemEditCtrl($scope,$mdDialog,busqueda,items,mensajes,informacion){busqueda.tiposItem().then(function(info){$scope.tipoitems=info.data}),busqueda.SubTiposItem().then(function(info){$scope.subtipoitems=info.data}),$scope.inicio=function(){$scope.datos={nombre:informacion.ITE_nombre,precio:informacion.ITE_precioventa,cantidad:informacion.ITE_cantidadtotal,tipo:informacion.TIT_clave,subtipo:informacion.STI_clave,activo:informacion.ITE_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.itemForm.$valid&&($scope.guardando=!0,items.update({item:informacion.ITE_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.itemForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function loginCtrl(auth,$rootScope){var sesion=this;$rootScope.cargando=!1,$rootScope.tema="theme1",sesion.inicio=function(){sesion.datos={usuario:"",psw:"",guardar:!1}},sesion.login=function(){$rootScope.cargando=!0,auth.login(sesion.datos)}}function perfilesCtrl($rootScope,$mdDialog,datos,permisos,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Perfiles Registrados",scope.info=datos,scope.nuevoPerfil=function(ev){$mdDialog.show({controller:perfilCtrl,templateUrl:"views/perfil.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=permisos.query()})},scope.editaPerfil=function(ev,index){var perfil=scope.info[index];$mdDialog.show({controller:perfilEditCtrl,templateUrl:"views/perfil.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:perfil}}).then(function(){scope.info=permisos.query()})},scope.confirmacion=function(ev,index){var permiso=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el permiso?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){permiso.PER_activo=permiso.PER_activo?0:1;var datos={nombre:permiso.PER_nombre,entradas:permiso.PER_entradas,salidas:permiso.PER_salidas,traspasos:permiso.PER_traspasos,editaItem:permiso.PER_consultaItems,desactivaItem:permiso.PER_desactivaItems,editaCatalogos:permiso.PER_consultaCatalogo,desactivaCatalogos:permiso.PER_desactivaCatalogo,autorizaorden:permiso.PER_autorizaOrden,modificaorden:permiso.PER_modificaOrden,cerrarorden:permiso.PER_cerrarOrden,surtir:permiso.PER_surtir,facturas:permiso.PER_subirFactura,asociar:permiso.PER_asociar,activo:permiso.PER_activo};permisos.update({permiso:permiso.PER_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function perfilCtrl($scope,$mdDialog,permisos,mensajes){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:"",entradas:!1,salidas:!1,traspasos:!1,editaItem:!1,desactivaItem:!1,editaCatalogos:!1,desactivaCatalogos:!1,autorizaorden:!1,modificaorden:!1,cerrarorden:!1,surtir:!1,facturas:!1,asociar:!1,activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,permisos.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function perfilEditCtrl($scope,$mdDialog,permisos,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.PER_nombre,entradas:informacion.PER_entradas?!0:!1,salidas:informacion.PER_salidas?!0:!1,traspasos:informacion.PER_traspasos?!0:!1,editaItem:informacion.PER_consultaItems?!0:!1,desactivaItem:informacion.PER_desactivaItems?!0:!1,editaCatalogos:informacion.PER_consultaCatalogo?!0:!1,desactivaCatalogos:informacion.PER_desactivaCatalogo?!0:!1,autorizaorden:informacion.PER_autorizaOrden?!0:!1,modificaorden:informacion.PER_modificaOrden?!0:!1,cerrarorden:informacion.PER_cerrarOrden?!0:!1,surtir:informacion.PER_surtir?!0:!1,facturas:informacion.PER_subirFactura?!0:!1,asociar:informacion.PER_asociar?!0:!1,activo:informacion.PER_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,permisos.update({permiso:informacion.PER_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function proveedoresCtrl($rootScope,$mdDialog,datos,proveedores,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Proveedores Registrados",scope.info=datos,scope.nuevo=function(ev){$mdDialog.show({controller:proveedorCtrl,templateUrl:"views/proveedor.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=proveedores.query()})},scope.edita=function(ev,index){var usuario=scope.info[index];$mdDialog.show({controller:proveedorEditCtrl,templateUrl:"views/proveedor.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario}}).then(function(){scope.info=proveedores.query()})},scope.confirmacion=function(ev,index){var proveedor=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el proveedor?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar proveedor").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){proveedor.PRO_activo=proveedor.PRO_activo?0:1;var datos={nombre:proveedor.PRO_nombre,nombrecorto:proveedor.PRO_nombrecorto,razon:proveedor.PRO_razonSocial,rfc:proveedor.PRO_rfc,activo:proveedor.PRO_activo};proveedores.update({proveedor:proveedor.PRO_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function proveedorCtrl($scope,$mdDialog,permisos,proveedores,mensajes){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:"",nombrecorto:"",rfc:"",razon:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.proveedorForm.$valid&&($scope.guardando=!0,proveedores.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.proveedorForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function proveedorEditCtrl($scope,$mdDialog,permisos,proveedores,mensajes,informacion){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:informacion.PRO_nombre,nombrecorto:informacion.PRO_nombrecorto,razon:informacion.PRO_razon,rfc:informacion.PRO_rfc,activo:informacion.PRO_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.proveedorForm.$valid&&($scope.guardando=!0,proveedores.update({proveedor:informacion.PRO_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.proveedorForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function subTiposItemCtrl($rootScope,$mdDialog,datos,subtipositem,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="SubTipos de Item Registrados",scope.info=datos,scope.nuevoTipo=function(ev){$mdDialog.show({controller:subTipoItemCtrl,templateUrl:"views/subtipoitem.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=subtipositem.query()})},scope.editaTipo=function(ev,index){var subtipoitem=scope.info[index];$mdDialog.show({controller:subTipoItemEditCtrl,templateUrl:"views/subtipoitem.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:subtipoitem}}).then(function(){scope.info=subtipositem.query()})},scope.confirmacion=function(ev,index){var subtipoitem=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){subtipoitem.STI_activo=subtipoitem.STI_activo?0:1;var datos={nombre:subtipoitem.STI_nombre,activo:subtipoitem.STI_activo};subtipositem.update({subtipoitem:subtipoitem.STI_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function subTipoItemCtrl($scope,$mdDialog,subtipositem,mensajes){$scope.subtipositem=subtipositem.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.subtipoForm.$valid&&($scope.guardando=!0,subtipositem.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.subtipoForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function subTipoItemEditCtrl($scope,$mdDialog,subtipositem,mensajes,informacion){console.log(informacion),$scope.inicio=function(){$scope.datos={nombre:informacion.STI_nombre,activo:informacion.STI_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.subtipoForm.$valid&&($scope.guardando=!0,subtipositem.update({subtipoitem:informacion.STI_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.subtipoForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function tiposAlmacenCtrl($rootScope,$mdDialog,datos,tiposalmacen,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Tipos de Almacen Registrados",scope.info=datos,scope.nuevo=function(ev){$mdDialog.show({controller:tipoAlmacenCtrl,templateUrl:"views/tipoalmacen.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=tiposalmacen.query()})},scope.edita=function(ev,index){var tipoalmacen=scope.info[index];$mdDialog.show({controller:tipoAlmacenEditCtrl,templateUrl:"views/tipoalmacen.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:tipoalmacen}}).then(function(){scope.info=tiposalmacen.query()})},scope.confirmacion=function(ev,index){var tipoalmacen=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de almacen?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){tipoalmacen.TAL_activo=tipoalmacen.TAL_activo?0:1;var datos={nombre:tipoalmacen.TAL_nombre,activo:tipoalmacen.TAL_activo};tiposalmacen.update({tipoalmacen:tipoalmacen.TAL_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoAlmacenCtrl($scope,$mdDialog,tiposalmacen,mensajes){$scope.tiposalmacen=tiposalmacen.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoAlmacenForm.$valid&&($scope.guardando=!0,tiposalmacen.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoAlmacenForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoAlmacenEditCtrl($scope,$mdDialog,tiposalmacen,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TAL_nombre,activo:informacion.TAL_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoAlmacenForm.$valid&&($scope.guardando=!0,tiposalmacen.update({tipoalmacen:informacion.TAL_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoAlmacenForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function tiposItemCtrl($rootScope,$mdDialog,datos,tipositem,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Tipos de Item Registrados",scope.info=datos,scope.nuevoTipo=function(ev){$mdDialog.show({controller:tipoItemCtrl,templateUrl:"views/tipoitem.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=tipositem.query()})},scope.editaTipo=function(ev,index){var tipoitem=scope.info[index];$mdDialog.show({controller:tipoItemEditCtrl,templateUrl:"views/tipoitem.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:tipoitem}}).then(function(){scope.info=tipositem.query()})},scope.confirmacion=function(ev,index){var tipoitem=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){tipoitem.TIT_activo=tipoitem.TIT_activo?0:1;var datos={nombre:tipoitem.TIT_nombre,activo:tipoitem.TIT_activo};tipositem.update({tipoitem:tipoitem.TIT_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoItemCtrl($scope,$mdDialog,tipositem,mensajes){$scope.tipositem=tipositem.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,tipositem.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoItemEditCtrl($scope,$mdDialog,tipositem,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TIT_nombre,activo:informacion.TIT_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,tipositem.update({tipoitem:informacion.TIT_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function usualmCtrl($rootScope,datos,$mdDialog,busqueda,operacion){var scope=this;$rootScope.titulo="Conexiones",$rootScope.cargando=!1,$rootScope.tema="theme1",scope.inicio=function(){scope.total=0,scope.limit=10,scope.page=1,scope.usuarios=datos[0].data},scope.nuevo=function(ev,index){var usuario=scope.usuarios[index];$mdDialog.show({controller:nuevoUsualmCtrl,templateUrl:"views/almacenusuario.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1,locals:{informacion:usuario}}).then(function(){busqueda.usuariosAlmacen().success(function(data){scope.usuarios=data})})},scope.confirma=function(ev,index,almacen){var usuario=scope.usuarios[index],confirm=$mdDialog.confirm().title("¿Seguro que deseas asignar este almacen?").content("").ariaLabel("Asignar Almacen").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){operacion.bajaAlmacen(almacen.ALM_clave,usuario.clave)},function(){busqueda.usuariosAlmacen().success(function(data){scope.usuarios=data})})}}function nuevoUsualmCtrl($scope,$mdDialog,busqueda,mensajes,$q,$filter,informacion,operacion,$rootScope){function consultado(query){var q=$q.defer();return findValues(query,$scope.almacenes).then(function(res){q.resolve(res)}),q.promise}function findValues(query,obj){var deferred=$q.defer();return deferred.resolve($filter("filter")(obj,query)),deferred.promise}console.log(informacion),busqueda.almacenUsuario(informacion.clave).then(function(info){$scope.almacenes=info.data}),$scope.inicio=function(){$scope.seleccionado=null,$scope.busqueda=null,$scope.consultado=consultado,$scope.almacenesseleccionados=[],$scope.datos={usuario:informacion.clave,usuarioasigno:$rootScope.id,almacenes:$scope.almacenesseleccionados},$scope.guardando=!1},$scope.guardar=function(){console.log($scope.datos),$scope.guardando=!0,operacion.altaAlmacenes($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.inicio()}).error(function(error){})},$scope.cancel=function(){$mdDialog.hide()}}function usuariosCtrl($rootScope,$mdDialog,datos,usuarios,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Usuarios Registrados",scope.info=datos,scope.nuevoUsuario=function(ev){$mdDialog.show({controller:usuarioCtrl,templateUrl:"views/usuario.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=usuarios.query()})},scope.editaUsuario=function(ev,index){var usuario=scope.info[index];$mdDialog.show({controller:usuarioEditCtrl,templateUrl:"views/usuarioEdicion.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario}}).then(function(){scope.info=usuarios.query()})},scope.confirmacion=function(ev,index){var usuario=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el usuario?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar usuario").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){usuario.USU_activo=usuario.USU_activo?0:1;var datos={nombre:usuario.USU_nombrecompleto,usuario:usuario.USU_login,perfil:usuario.PER_clave,activo:usuario.USU_activo};usuarios.update({usuario:usuario.USU_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function usuarioCtrl($scope,$mdDialog,permisos,usuarios,mensajes){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:"",usuario:"",psw:"",psw2:"",perfil:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.usuarioForm.$valid&&($scope.guardando=!0,usuarios.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.usuarioForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function usuarioEditCtrl($scope,$mdDialog,permisos,usuarios,mensajes,informacion){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:informacion.USU_nombrecompleto,usuario:informacion.USU_login,psw:"",psw2:"",perfil:informacion.PER_clave,activo:informacion.USU_activo?!0:!1},$scope.nuevopsw=!1,$scope.guardando=!1},$scope.guardar=function(){$scope.usuarioForm.$valid&&($scope.guardando=!0,usuarios.update({usuario:informacion.USU_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.usuarioForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function almacenes($resource,api){var Almacen=$resource(api+"almacenes/:almacen",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return Almacen}function auth($http,api,$state,webStorage,$rootScope,mensajes){return{login:function(credenciales){$http.post(api+"login",credenciales).success(function(data){$rootScope.cargando=!1,webStorage.session.add("username",data.USU_login),webStorage.session.add("nombre",data.USU_nombrecompleto),webStorage.session.add("id",data.USU_clave),$rootScope.username=webStorage.session.get("username"),$rootScope.nombre=webStorage.session.get("nombre"),$rootScope.id=webStorage.session.get("id"),credenciales.guardar&&webStorage.local.add("usuario",JSON.stringify(data)),$state.go("index.home")}).error(function(data){mensajes.alerta(data.flash,"error center-dialog","top","error"),$rootScope.cargando=!1})},logout:function(){webStorage.session.clear(),$http.get(api+"logout"),$state.go("login")},verify:function(api){}}}function busqueda($http,api){return{almacenes:function(){return $http.get(api+"busquedas/almacenes")},almacenUsuario:function(usuario){return $http.get(api+"busquedas/almacen/"+usuario)},items:function(){return $http.get(api+"busquedas/items")},itemsProveedor:function(){return $http.get(api+"busquedas/items/proveedor")},tiposAlmacen:function(){return $http.get(api+"busquedas/tiposalmacen")},tiposItem:function(){return $http.get(api+"busquedas/tipositem")},SubTiposItem:function(){return $http.get(api+"busquedas/subtipositem")},perfiles:function(){return $http.get(api+"busquedas/permisos")},proveedores:function(){return $http.get(api+"busquedas/proveedores");

},unidades:function(){return $http.get(api+"busquedas/unidades")},usuarios:function(){return $http.get(api+"busquedas/usuarios")},usuariosAlmacen:function(){return $http.get(api+"operacion/usuarios/almacen")}}}function items($resource,api){var Item=$resource(api+"items/:item",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return Item}function mensajes($mdToast){return{confirmacion:function(titulo,mensaje){},alerta:function(mensaje,tipo,posicion,icono){$mdToast.show({template:'<md-toast class="'+tipo+'"> <md-icon layout-padding><ng-md-icon icon="'+icono+'" style="fill:white"></ng-md-icon></md-icon> <span flex>'+mensaje+"</span></md-toast>",hideDelay:4e3,position:posicion})},popup:function(mensaje){}}}function operacion($http,api){return{altaAlmacenes:function(datos){return $http.post(api+"operacion/usuario/almacenes",datos)},bajaAlmacen:function(almacen,usuario){return $http.get(api+"operacion/elimina/almacen/"+almacen+"/"+usuario)},altaItempro:function(datos){return $http.post(api+"operacion/item/proveedor",datos)}}}function permisos($resource,api){var Permiso=$resource(api+"permisos/:permiso",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return Permiso}function proveedores($resource,api){var Proveedor=$resource(api+"proveedores/:proveedor",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return Proveedor}function subtipositem($resource,api){var TipoItem=$resource(api+"subtipositem/:subtipoitem",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoItem}function tiposalmacen($resource,api){var TipoItem=$resource(api+"tiposalmacen/:tipoalmacen",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoItem}function tipositem($resource,api){var TipoItem=$resource(api+"tipositem/:tipoitem",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoItem}function usuarios($resource,api){var User=$resource(api+"usuarios/:usuario",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return User}var app=angular.module("app",["ui.router","ngMaterial","ngMdIcons","webStorageModule","ngResource","md.data.table"]);app.config(config),app.run(run),app.constant("api","http://api.medicavial.mx/api/"),app.controller("almacenCtrl",almacenCtrl),app.controller("almacenesCtrl",almacenesCtrl),app.controller("almacenEditCtrl",almacenEditCtrl),app.controller("homeCtrl",homeCtrl),app.controller("itemproCtrl",itemproCtrl),app.controller("itemCtrl",itemCtrl),app.controller("itemsCtrl",itemsCtrl),app.controller("itemEditCtrl",itemEditCtrl),app.controller("loginCtrl",loginCtrl),app.controller("perfilCtrl",perfilCtrl),app.controller("perfilesCtrl",perfilesCtrl),app.controller("perfilEditCtrl",perfilEditCtrl),app.controller("proveedorCtrl",proveedorCtrl),app.controller("proveedoresCtrl",proveedoresCtrl),app.controller("proveedorEditCtrl",proveedorEditCtrl),app.controller("subTipoItemCtrl",subTipoItemCtrl),app.controller("subTiposItemCtrl",subTiposItemCtrl),app.controller("subTipoItemEditCtrl",subTipoItemEditCtrl),app.controller("tipoAlmacenCtrl",tipoAlmacenCtrl),app.controller("tiposAlmacenCtrl",tiposAlmacenCtrl),app.controller("tipoAlmacenEditCtrl",tipoAlmacenEditCtrl),app.controller("tipoItemCtrl",tipoItemCtrl),app.controller("tiposItemCtrl",tiposItemCtrl),app.controller("tipoItemEditCtrl",tipoItemEditCtrl),app.controller("usualmCtrl",usualmCtrl),app.controller("usuarioCtrl",usuarioCtrl),app.controller("usuariosCtrl",usuariosCtrl),app.controller("usuarioEditCtrl",usuarioEditCtrl),app.directive("dinero",function(){function link(scope,el,attrs,ngModelCtrl){function round(num){var d=Math.pow(10,precision);return Math.round(num*d)/d}function formatPrecision(value){return parseFloat(value).toFixed(precision)}function formatViewValue(value){return ngModelCtrl.$isEmpty(value)?"":""+value}var lastValidValue,min=parseFloat(attrs.min||0),precision=parseFloat(attrs.precision||2);ngModelCtrl.$parsers.push(function(value){0===value.indexOf(".")&&(value="0"+value),0===value.indexOf("-")&&(min>=0?(value=null,ngModelCtrl.$setViewValue(""),ngModelCtrl.$render()):"-"===value&&(value=""));var empty=ngModelCtrl.$isEmpty(value);return empty||NUMBER_REGEXP.test(value)?lastValidValue=""===value?null:empty?value:parseFloat(value):(ngModelCtrl.$setViewValue(formatViewValue(lastValidValue)),ngModelCtrl.$render()),ngModelCtrl.$setValidity("number",!0),lastValidValue}),ngModelCtrl.$formatters.push(formatViewValue);var minValidator=function(value){return!ngModelCtrl.$isEmpty(value)&&min>value?void ngModelCtrl.$setValidity("min",!1):(ngModelCtrl.$setValidity("min",!0),value)};if(ngModelCtrl.$parsers.push(minValidator),ngModelCtrl.$formatters.push(minValidator),attrs.max){var max=parseFloat(attrs.max),maxValidator=function(value){return!ngModelCtrl.$isEmpty(value)&&value>max?void ngModelCtrl.$setValidity("max",!1):(ngModelCtrl.$setValidity("max",!0),value)};ngModelCtrl.$parsers.push(maxValidator),ngModelCtrl.$formatters.push(maxValidator)}precision>-1&&(ngModelCtrl.$parsers.push(function(value){return value?round(value):value}),ngModelCtrl.$formatters.push(function(value){return value?formatPrecision(value):value})),el.bind("blur",function(){var value=ngModelCtrl.$modelValue;value&&(ngModelCtrl.$viewValue=formatPrecision(value),ngModelCtrl.$render())})}var NUMBER_REGEXP=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;return{restrict:"A",require:"ngModel",link:link}}),app.factory("almacenes",almacenes),app.factory("auth",auth),app.factory("busqueda",busqueda),app.factory("items",items),app.factory("mensajes",mensajes),app.factory("operacion",operacion),app.factory("permisos",permisos),app.factory("proveedores",proveedores),app.factory("subtipositem",subtipositem),app.factory("tiposalmacen",tiposalmacen),app.factory("tipositem",tipositem),app.factory("usuarios",usuarios);