"use strict";function config($stateProvider,$urlRouterProvider,$locationProvider,$mdThemingProvider,$httpProvider){$urlRouterProvider.otherwise("/home"),$stateProvider.state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginCtrl",controllerAs:"sesion"}).state("index",{url:"/","abstract":!0,templateUrl:"views/base.html"}).state("index.almacenes",{url:"almacenes",templateUrl:"views/almacenes.html",controller:"almacenesCtrl",controllerAs:"almacenes",resolve:{datos:function(almacenes){return almacenes.query().$promise}}}).state("index.conexiones",{url:"conexiones",templateUrl:"views/conexiones.html",controller:function($rootScope){$rootScope.titulo="Conexiones"}}).state("index.existencias",{url:"existencias",templateUrl:"views/existencias.html",controller:"existenciasCtrl",controllerAs:"existencias",resolve:{datos:function(busqueda,$rootScope){return busqueda.existencias($rootScope.id)}}}).state("index.home",{url:"home",templateUrl:"views/home.html",controller:"homeCtrl"}).state("index.items",{url:"items",templateUrl:"views/items.html",controller:"itemsCtrl",controllerAs:"items",resolve:{datos:function(items){return items.query().$promise}}}).state("index.item",{url:"item",templateUrl:"views/item.html",controller:"itemCtrl",resolve:{datos:function(busqueda,$q){var promesa=$q.defer(),tipoitems=busqueda.tiposItem(),subtipoitems=busqueda.SubTiposItem(),presentaciones=busqueda.presentaciones();return $q.all([tipoitems,subtipoitems,presentaciones]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.detalleItem",{url:"detalleItem?itemId",templateUrl:"views/item.html",controller:"itemEditCtrl",resolve:{datos:function(busqueda,$q,$stateParams,items){var promesa=$q.defer(),tipoitems=busqueda.tiposItem(),subtipoitems=busqueda.SubTiposItem(),presentaciones=busqueda.presentaciones(),item=items.get({item:$stateParams.itemId}).$promise;return $q.all([tipoitems,subtipoitems,presentaciones,item]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.itempro",{url:"itempro",templateUrl:"views/itempro.html",controller:"itemproCtrl",controllerAs:"itempro",resolve:{datos:function(busqueda){return busqueda.itemsProveedor()}}}).state("index.movimientos",{url:"movimientos",templateUrl:"views/movimientos.html",controller:"movimientosCtrl",controllerAs:"movimientos",resolve:{datos:function(busqueda){return busqueda.movimientos()}}}).state("index.ordenescompra",{url:"ordenescompra",templateUrl:"views/ordenescompra.html",controller:"ordenesCompraCtrl",controllerAs:"ordenescompra",resolve:{datos:function(busqueda,$rootScope){return busqueda.ordenescompra()}}}).state("index.nuevaorden",{url:"nuevaorden",templateUrl:"views/ordencompra.html",controller:"ordenCompraCtrl",resolve:{datos:function(busqueda,$rootScope){return busqueda.unidades()}}}).state("index.perfiles",{url:"perfiles",templateUrl:"views/perfiles.html",controller:"perfilesCtrl",controllerAs:"perfiles",resolve:{datos:function(permisos){return permisos.query().$promise}}}).state("index.proveedores",{url:"proveedores",templateUrl:"views/proveedores.html",controller:"proveedoresCtrl",controllerAs:"proveedores",resolve:{datos:function(proveedores){return proveedores.query().$promise}}}).state("index.proveedor",{url:"proveedor",templateUrl:"views/proveedor.html",controller:"proveedorCtrl",resolve:{datos:function(permisos){return permisos.query()}}}).state("index.subtipositem",{url:"subtipositem",templateUrl:"views/subtipositem.html",controller:"subTiposItemCtrl",controllerAs:"subtipositem",resolve:{datos:function(subtipositem){return subtipositem.query().$promise}}}).state("index.tipositem",{url:"tipositem",templateUrl:"views/tipositem.html",controller:"tiposItemCtrl",controllerAs:"tipositem",resolve:{datos:function(tipositem){return tipositem.query().$promise}}}).state("index.tiposalmacen",{url:"tiposalmacen",templateUrl:"views/tiposalmacen.html",controller:"tiposAlmacenCtrl",controllerAs:"tiposalmacen",resolve:{datos:function(tiposalmacen){return tiposalmacen.query().$promise}}}).state("index.tiposmovimiento",{url:"tiposmovimiento",templateUrl:"views/tiposmovimiento.html",controller:"tiposMovimientoCtrl",controllerAs:"tiposmovimiento",resolve:{datos:function(tiposmovimiento){return tiposmovimiento.query().$promise}}}).state("index.tiposajuste",{url:"tiposajuste",templateUrl:"views/tiposajuste.html",controller:"tiposAjusteCtrl",controllerAs:"tiposajuste",resolve:{datos:function(tiposajuste){return tiposajuste.query().$promise}}}).state("index.tiposorden",{url:"tiposorden",templateUrl:"views/tiposorden.html",controller:"tiposOrdenCtrl",controllerAs:"tiposorden",resolve:{datos:function(tiposorden){return tiposorden.query().$promise}}}).state("index.usuarios",{url:"usuarios",templateUrl:"views/usuarios.html",controller:"usuariosCtrl",controllerAs:"usuarios",resolve:{datos:function(usuarios){return usuarios.query().$promise}}}).state("index.unidades",{url:"unidades",templateUrl:"views/unidades.html",controller:"unidadesCtrl",controllerAs:"unidades",resolve:{datos:function(unidades){return unidades.query().$promise}}}).state("index.usualm",{url:"usualm",templateUrl:"views/usuarioalmacen.html",controller:"usualmCtrl",controllerAs:"usualm",resolve:{datos:function(busqueda,$q){var promesa=$q.defer(),usuarios=busqueda.usuariosAlmacen();return $q.all([usuarios]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.traspaso",{url:"traspaso",templateUrl:"views/traspaso.html",controller:"traspasoCtrl",resolve:{datos:function($rootScope,busqueda,$q){var promesa=$q.defer(),almacenes=busqueda.almacenesUsuario($rootScope.id);return $q.all([almacenes]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.configuracion",{url:"configuracion",templateUrl:"views/configuracion.html",controller:"configuracionCtrl",controllerAs:"configuracion",resolve:{datos:function(busqueda){return busqueda.unidades()}}}),$locationProvider.html5Mode(!0),$mdThemingProvider.theme("theme1").primaryPalette("indigo").accentPalette("red"),$mdThemingProvider.theme("theme2").primaryPalette("red").accentPalette("deep-purple"),$mdThemingProvider.theme("theme3").primaryPalette("purple").accentPalette("deep-orange"),$mdThemingProvider.theme("theme4").primaryPalette("blue-grey").accentPalette("deep-purple"),$mdThemingProvider.theme("theme5").primaryPalette("teal").accentPalette("indigo"),$mdThemingProvider.theme("theme6").primaryPalette("green").accentPalette("deep-purple"),$mdThemingProvider.theme("theme7").primaryPalette("amber").accentPalette("blue"),$mdThemingProvider.theme("theme8").primaryPalette("orange").accentPalette("cyan"),$mdThemingProvider.theme("theme9").primaryPalette("blue").accentPalette("red"),$mdThemingProvider.theme("theme10").primaryPalette("light-green").accentPalette("indigo"),$mdThemingProvider.setDefaultTheme("theme1"),$mdThemingProvider.alwaysWatchTheme(!0),$httpProvider.defaults.timeout=1e4}function run($rootScope,$state,$mdSidenav,$mdBottomSheet,auth,webStorage){var url="";$rootScope.toggleSidenav=function(menuId){$mdSidenav(menuId).toggle()},$rootScope.muestra=function(ruta){$state.go(ruta)},$rootScope.showGridBottomSheet=function($event){$mdBottomSheet.show({templateUrl:"views/interactivo.html",targetEvent:$event})},$rootScope.logout=function(){$mdBottomSheet.hide(),auth.logout()},$rootScope.ir=function(ruta){$mdSidenav("left").toggle(),$state.go(ruta)},$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){url=toState.name,"login"!=url&&null==webStorage.session.get("username")&&(event.preventDefault(),$state.go("login")),"login"==url&&null!=webStorage.session.get("username")&&(event.preventDefault(),$state.go("index.home")),$rootScope.cargando=!0}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$rootScope.cargando=!1}),$rootScope.username=webStorage.session.get("username"),$rootScope.nombre=webStorage.session.get("nombre"),$rootScope.id=webStorage.session.get("id")}function almacenes($resource,api){var Almacen=$resource(api+"almacenes/:almacen",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return Almacen}function archivos($http,api,Upload,$q){return{items:function(archivos,clave){var promesa=$q.defer();imagenes=[];for(var i=0;i<archivos.length;i++)Upload.upload({url:api+"upload",fields:{clave:clave},file:archivos[i]}).progress(function(evt){var progressPercentage=parseInt(100*evt.loaded/evt.total);promesa.notify(progressPercentage),console.log("progress: "+progressPercentage+"% "+evt.config.file.name)}).success(function(data,status,headers,config){imagenes.push(data),console.log("file "+config.file.name+"uploaded. Response: "+data)}).error(function(data,status,headers,config){promesa.reject(data),console.log("error status: "+status)});return $q.when(imagenes).then(function(data){promesa.resolve("Imagenes subidas correctamente")}),promesa.promise},eliminaItem:function(imagen,clave){return $http["delete"](api+"delete",{image:imagen,item:clave})}}}function auth($http,api,$state,webStorage,$rootScope,mensajes){return{login:function(credenciales){$http.post(api+"login",credenciales).success(function(data){$rootScope.cargando=!1,webStorage.session.add("username",data.USU_login),webStorage.session.add("nombre",data.USU_nombrecompleto),webStorage.session.add("id",data.USU_clave),$rootScope.username=webStorage.session.get("username"),$rootScope.nombre=webStorage.session.get("nombre"),$rootScope.id=webStorage.session.get("id"),credenciales.guardar&&webStorage.local.add("usuario",JSON.stringify(data)),$state.go("index.home")}).error(function(data){mensajes.alerta(data.flash,"error center-dialog","top","error"),$rootScope.cargando=!1})},logout:function(){webStorage.session.clear(),$http.get(api+"logout"),$state.go("login")},verify:function(api){}}}function busqueda($http,api){return{almacenes:function(){return $http.get(api+"busquedas/almacenes")},almacenesUsuario:function(usuario){return $http.get(api+"busquedas/almacenes/"+usuario)},almacenUsuario:function(usuario){return $http.get(api+"busquedas/almacen/"+usuario)},almacenesUnidad:function(unidad){return $http.get(api+"busquedas/almacenes/unidad/"+unidad)},configuracion:function(unidad){return $http.get(api+"operacion/configuracion/unidad/"+unidad)},existencias:function(usuario){return $http.get(api+"busquedas/existencias/"+usuario)},items:function(){return $http.get(api+"busquedas/items")},itemsAlmacen:function(almacen){return $http.get(api+"busquedas/items/existencias/"+almacen)},itemsProveedor:function(){return $http.get(api+"busquedas/items/proveedor")},itemsUnidad:function(unidad){return $http.get(api+"operacion/items/unidad/"+unidad)},itemUnidad:function(item,unidad){return $http.get(api+"busquedas/item/unidad/"+item+"/"+unidad)},movimientos:function(){return $http.get(api+"busquedas/movimientos")},ordenescompra:function(){return $http.get(api+"busquedas/ordenescompra")},detalleOrdenCompra:function(id){return $http.get(api+"busquedas/ordencompra/"+id)},tiposAjuste:function(){return $http.get(api+"busquedas/tiposajuste")},tiposAlmacen:function(){return $http.get(api+"busquedas/tiposalmacen")},tiposItem:function(){return $http.get(api+"busquedas/tipositem")},tiposMovimiento:function(){return $http.get(api+"busquedas/tiposmovimiento")},SubTiposItem:function(){return $http.get(api+"busquedas/subtipositem")},perfiles:function(){return $http.get(api+"busquedas/permisos")},presentaciones:function(){return $http.get(api+"busquedas/presentaciones")},proveedores:function(){return $http.get(api+"busquedas/proveedores")},proveedoresItems:function(items){return $http.post(api+"operacion/proveedores/items",items)},unidades:function(){return $http.get(api+"busquedas/unidades")},usuarios:function(){return $http.get(api+"busquedas/usuarios")},usuariosAlmacen:function(){return $http.get(api+"operacion/usuarios/almacen")}}}function items($resource,api){var Item=$resource(api+"items/:item",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return Item}function mensajes($mdToast,$mdDialog){return{confirmacion:function(titulo,mensaje){},notifica:function(mensaje,descripcion,ev){$mdDialog.show($mdDialog.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(mensaje).content(descripcion).ariaLabel(mensaje).ok("OK").targetEvent(ev))},alerta:function(mensaje,tipo,posicion,icono){$mdToast.show({template:'<md-toast class="'+tipo+'"> <md-icon layout-padding><ng-md-icon icon="'+icono+'" style="fill:white"></ng-md-icon></md-icon> <span flex>'+mensaje+"</span></md-toast>",hideDelay:4e3,position:posicion})},popup:function(mensaje){}}}function operacion($http,api,$q,busqueda,$rootScope,$filter){return{altaAlmacenes:function(datos){return $http.post(api+"operacion/usuario/almacenes",datos)},actualizaConfiguracion:function(id,datos){return $http.put(api+"operacion/configuraciones/"+id,datos)},altaConfiguracion:function(datos){return $http.post(api+"operacion/configuraciones",datos)},altaItempro:function(datos){return $http.post(api+"operacion/item/proveedor",datos)},altaMovimiento:function(datos){return $http.post(api+"operacion/movimiento",datos)},altaTraspaso:function(datos){return $http.post(api+"operacion/traspaso",datos)},bajaAlmacen:function(almacen,usuario){return $http.get(api+"operacion/elimina/almacen/"+almacen+"/"+usuario)},cambioXproveedor:function(poveedor,item,items){var datos,promesa=$q.defer(),respuesta=[],totalActual=0;datos=$filter("filter")(items,item);var cantidad=datos[0].porsurtir,proveedorCambio=datos.indexOf(poveedor);return angular.forEach(datos,function(value,key){respuesta.push(value),totalActual+=value.cantidad}),$q.when(respuesta).then(function(data){if(totalActual>cantidad){alert("Te pasaste de la cantidad a surtir");var valorDeMas=totalActual-cantidad,valorActual=items[proveedorCambio].cantidad;items[proveedorCambio].cantidad=valorActual-valorDeMas}else promesa.resolve(items)}),promesa.promise},itemsAlmacenes:function(unidad,almacenes){return $http.post(api+"operacion/items/almacenes/"+unidad,almacenes)},infoUnidad:function(unidad){var promesa=$q.defer(),almacenes=busqueda.almacenesUnidad(unidad),items=busqueda.itemsUnidad(unidad);return $q.all([almacenes,items]).then(function(data){promesa.resolve(data)},function(error){promesa.reject("Hubo un problema favor de reintentarlo")}),promesa.promise},preparaOrden:function(items){var promesa=$q.defer(),proveedores=[],seleccionOrden=[];return $http.post(api+"operacion/proveedores/items",items).success(function(data){var info=data;angular.forEach(data,function(value,key){var cantidad=value.Cantidad,nivelcompra=value.CON_nivelCompra,existenciaitem=value.EXI_cantidad;angular.forEach(value.proveedores,function(value,key){var existencia=proveedores.indexOf(value.PRO_clave);-1==existencia&&proveedores.push(value.PRO_clave),value.porsurtir=cantidad,value.nivelcompra=nivelcompra,value.existencia=existenciaitem,0==key?(value.cantidad=cantidad,seleccionOrden.push(value)):(value.cantidad=0,seleccionOrden.push(value))})}),$q.when(seleccionOrden).then(function(data){var respuesta={info:info,datos:data,proveedores:proveedores};promesa.resolve(respuesta)})}),promesa.promise},economicoXitem:function(item,items){var datos,promesa=$q.defer(),respuesta=[];datos=$filter("filter")(items,item);var cantidad=datos[0].porsurtir;return proveedores=datos.length,angular.forEach(datos,function(value,key){var id=items.indexOf(value);items[id].cantidad=0==key?cantidad:0,respuesta.push(id)}),$q.when(respuesta).then(function(data){promesa.resolve(items)}),promesa.promise},proporcionalXitem:function(item,items){var datos,promesa=$q.defer(),respuesta=[];datos=$filter("filter")(items,item);var cantidad=datos[0].porsurtir;return proveedores=datos.length,angular.forEach(datos,function(value,key){var cantidadProporcionada=parseInt(cantidad/proveedores),cantidadSegunProporcion=cantidadProporcionada*proveedores,diferencia=cantidad-cantidadSegunProporcion,id=items.indexOf(value);items[id].cantidad=0==key?cantidadProporcionada+diferencia:cantidadProporcionada,respuesta.push(id)}),$q.when(respuesta).then(function(data){promesa.resolve(items)}),promesa.promise},generaCantidades:function(items){var promesa=$q.defer(),seleccionOrden=[];return angular.forEach(items,function(value,key){var cantidad=value.Cantidad;proveedores=value.proveedores.length;var cantidadProporcionada=parseInt(cantidad/proveedores),cantidadSegunProporcion=cantidadProporcionada*proveedores,diferencia=cantidad-cantidadSegunProporcion;angular.forEach(value.proveedores,function(value,key){value.cantidad=0==key?cantidadProporcionada+diferencia:cantidadProporcionada,seleccionOrden.push(value)})}),$q.when(seleccionOrden).then(function(data){promesa.resolve(data)}),promesa.promise},generaMasBarato:function(items){var promesa=$q.defer(),seleccionOrden=[];return angular.forEach(items,function(value,key){var cantidad=value.Cantidad;angular.forEach(value.proveedores,function(value,key){0==key?(value.cantidad=cantidad,seleccionOrden.push(value)):(value.cantidad=0,seleccionOrden.push(value))})}),$q.when(seleccionOrden).then(function(data){promesa.resolve(data)}),promesa.promise},ordenXproveedor:function(proveedor,unidad,almacenes,catalogo){var items,promesa=$q.defer(),ordenes=[];items=$filter("filter")(catalogo,proveedor);var proveedor=items[0].PRO_clave,total=0,itemsproveedor=[];return angular.forEach(items,function(value,key){var cantidad=value.cantidad*value.IPR_ultimoCosto;total+=cantidad,itemsproveedor.push(value);var id=catalogo.indexOf(value);catalogo.splice(id,1)}),$q.when(itemsproveedor).then(function(data){var preorden={proveedor:proveedor,items:itemsproveedor,total:total,tipo:1,usuario:$rootScope.id,unidad:unidad,almacenes:almacenes};ordenes.push(preorden),$http.post(api+"operacion/ordencompra",ordenes).success(function(datos){promesa.resolve(datos)}).error(function(data){promesa.reject("Se encontro un error intentalo nuevamente")})}),promesa.promise},generaOrdenes:function(items,proveedores,unidad,almacenes){var promesa=$q.defer(),ordenes=[];return angular.forEach(proveedores,function(value,key){var proveedor=value,total=0,itemsproveedor=[];if(angular.forEach(items,function(value,key){if(proveedor==value.PRO_clave){var cantidad=value.cantidad*value.IPR_ultimoCosto;total+=cantidad,itemsproveedor.push(value)}}),itemsproveedor.length>0){var preorden={proveedor:proveedor,items:itemsproveedor,total:total,tipo:1,usuario:$rootScope.id,unidad:unidad,almacenes:almacenes};ordenes.push(preorden)}}),$q.when(ordenes).then(function(data){$http.post(api+"operacion/ordencompra",data).success(function(datos){promesa.resolve(datos)}).error(function(data){promesa.reject("Se encontro un error intentalo nuevamente")})}),promesa.promise},generaTotales:function(items,proveedor){var promesa=$q.defer(),seleccionOrden=[],total=0;return angular.forEach(items,function(value,key){var cantidad=value.cantidad;value.PRO_nombre==proveedor&&(seleccionOrden.push(value),total+=cantidad)}),$q.when(seleccionOrden).then(function(data){promesa.resolve(total)}),promesa.promise},generaDetalleOrdenes:function(ordenes){var promesa=$q.defer(),promesas=[];return angular.forEach(ordenes,function(value,key){var dato=busqueda.detalleOrdenCompra(value);promesas.push(dato)}),$q.all(promesas).then(function(datos){console.log(datos),promesa.resolve(datos)}),promesa.promise},proveedoresItems:function(items){return $http.post(api+"operacion/proveedores/items",items)},verificaItems:function(items){var promesa=$q.defer(),validos=[];return angular.forEach(items,function(value,key){value.cantidad>0&&validos.push(value)}),$q.when(validos).then(function(data){promesa.resolve(data)}),promesa.promise}}}function permisos($resource,api){var Permiso=$resource(api+"permisos/:permiso",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return Permiso}function proveedores($resource,api){var Proveedor=$resource(api+"proveedores/:proveedor",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return Proveedor}function subtipositem($resource,api){var TipoItem=$resource(api+"subtipositem/:subtipoitem",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoItem}function tiposajuste($resource,api){var tipoajuste=$resource(api+"tiposajuste/:tipo",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return tipoajuste}function tiposalmacen($resource,api){var TipoItem=$resource(api+"tiposalmacen/:tipoalmacen",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoItem}function tipositem($resource,api){var TipoItem=$resource(api+"tipositem/:tipoitem",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoItem}function tiposmovimiento($resource,api){var tipomovimietno=$resource(api+"tiposmovimiento/:tipo",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return tipomovimietno}function tiposorden($resource,api){var TipoOrden=$resource(api+"tiposorden/:tipoorden",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoOrden}function unidades($resource,api){var unidad=$resource(api+"unidades/:unidad",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return unidad}function usuarios($resource,api){var User=$resource(api+"usuarios/:usuario",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return User}function almacenesCtrl($rootScope,$mdDialog,datos,almacenes,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Almacenes Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Almacenes por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:almacenCtrl,templateUrl:"views/almacen.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=almacenes.query()})},scope.edita=function(ev,index){var usuario=scope.info[index];$mdDialog.show({controller:almacenEditCtrl,templateUrl:"views/almacen.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario}}).then(function(){scope.info=almacenes.query()})},scope.confirmacion=function(ev,index){var almacen=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el almacen?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar almacen").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){almacen.ALM_activo=almacen.ALM_activo?0:1;var datos={nombre:almacen.ALM_nombre,observaciones:almacen.ALM_observaciones,ubicacion:almacen.ALM_ubicacion,tipo:almacen.TAL_clave,unidad:almacen.UNI_clave,activo:almacen.ALM_activo};almacenes.update({almacen:almacen.ALM_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function almacenCtrl($scope,$mdDialog,busqueda,almacenes,mensajes){busqueda.unidades().then(function(info){$scope.unidades=info.data}),busqueda.tiposAlmacen().then(function(info){$scope.tiposalmacen=info.data}),$scope.inicio=function(){$scope.datos={nombre:"",observaciones:"",ubicacion:"",tipo:"",unidad:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.almacenForm.$valid&&($scope.guardando=!0,almacenes.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.almacenForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function almacenEditCtrl($scope,$mdDialog,almacenes,mensajes,informacion,busqueda){busqueda.unidades().then(function(info){$scope.unidades=info.data}),busqueda.tiposAlmacen().then(function(info){$scope.tiposalmacen=info.data}),$scope.inicio=function(){$scope.datos={nombre:informacion.ALM_nombre,observaciones:informacion.ALM_observaciones,ubicacion:informacion.ALM_ubicacion,tipo:informacion.TAL_clave,unidad:informacion.UNI_clave,activo:informacion.ALM_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.almacenForm.$valid&&($scope.guardando=!0,almacenes.update({almacen:informacion.ALM_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.almacenForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function configuracionCtrl($rootScope,$mdDialog,busqueda,operacion,mensajes,datos){console.log(datos);var scope=this;$rootScope.titulo="Configuración",$rootScope.cargando=!1,$rootScope.tema="theme1",scope.guardando=!1,scope.unidades=datos.data,scope.edicion=!0,scope.correos=[],scope.datos={minimo:0,compra:0,maxima:0,unidad:"",item:""},scope.inicio=function(){scope.datos.compra=0,scope.datos.minimo=0,scope.datos.maxima=0,scope.id="",scope.minimo=0,scope.compra=0,scope.existe=!1},scope.verificaUnidad=function(unidad){busqueda.configuracion(unidad).success(function(data){scope.edicion=!0,scope.items=data})},scope.verDetalle=function(index){scope.inicio();var item=scope.items[index];scope.datos.item=item.ITE_clave,busqueda.itemUnidad(item.ITE_clave,item.UNI_clave).success(function(data){console.log(data),data.length>0&&(scope.datos.compra=Number(data[0].CON_nivelCompra),scope.datos.minimo=Number(data[0].CON_nivelMinimo),scope.datos.maxima=Number(data[0].CON_nivelMaximo),scope.id=data[0].id,scope.existe=!0),scope.minimo=Number(100*scope.datos.minimo/scope.datos.maxima),scope.compra=Number(100*scope.datos.compra/scope.datos.maxima),scope.edicion=!1})},scope.valida=function(){return scope.datos.compra>0&&scope.datos.minimo>0&&scope.datos.maxima>0?scope.datos.minimo>scope.datos.compra||scope.datos.minimo>scope.datos.maximo?!0:scope.datos.compra>scope.datos.maxima?!0:!1:!0},scope.verificaMinimo=function(){scope.datos.minimo=Number(scope.minimo*scope.datos.maxima/100)},scope.verificaCompra=function(){scope.datos.compra=Number(scope.compra*scope.datos.maxima/100)},scope.guardar=function(){scope.guardando=!0,operacion.altaConfiguracion(scope.datos).success(function(data){scope.guardando=!1,mensajes.alerta(data.respuesta,"success","top right","done_all"),scope.inicio(),scope.edicion=!0})},scope.actualizar=function(){scope.guardando=!0,operacion.actualizaConfiguracion(scope.id,scope.datos).success(function(data){scope.guardando=!1,mensajes.alerta(data.respuesta,"success","top right","done_all"),scope.inicio(),scope.edicion=!0})}}function existenciasCtrl($rootScope,$mdDialog,datos,busqueda,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Existencias",scope.info=datos.data,scope.total=0,scope.limit=10,scope.page=1,scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.traspasar=function(ev,almacen,item){var datos={almacen:almacen,item:item};$mdDialog.show({controller:traspasoCtrl,templateUrl:"views/traspaso.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1,locals:{informacion:datos}}).then(function(){busqueda.existencias($rootScope.id).success(function(data){scope.info=data})})}}function traspasoCtrl($scope,$rootScope,$mdDialog,busqueda,operacion,mensajes,datos,$filter,$q){function consultado(query){var q=$q.defer();return findValues(query,$scope.itemsAlmacen).then(function(res){q.resolve(res)}),q.promise}function findValues(query,obj){var deferred=$q.defer();return deferred.resolve($filter("filter")(obj,query)),deferred.promise}$rootScope.tema="theme1",$rootScope.titulo="Nuevo traspaso",$scope.almacenes=datos[0].data,$scope.inicio=function(){$scope.seleccionado=null,$scope.busqueda=null,$scope.consultado=consultado,$scope.item="",$scope.datos={almacenOrigen:"",almacenDestino:"",item:"",cantidad:"",usuario:$rootScope.id},$scope.guardando=!1},$scope.guardar=function(){$scope.traspasoForm.$valid&&(console.log($scope.datos),$scope.guardando=!0,operacion.altaTraspaso($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.traspasoForm.$setPristine(),$scope.inicio()}))},$scope.itemsxalmacen=function(clave){busqueda.itemsAlmacen(clave).success(function(data){$scope.itemsAlmacen=data})},$scope.seleccionaItem=function(item){console.log(item),$scope.datos.item=item.ITE_clave,$scope.disponible=item.EXI_cantidad},$scope.verificaAlmacen=function(ev){$scope.datos.almacenDestino==$scope.datos.almacenOrigen&&(alert("No puedes seleccionar el mismo almacen"),$scope.datos.almacenDestino="")}}function homeCtrl($rootScope){$rootScope.tema="theme1",$rootScope.titulo="Bienvenido"}function itemproCtrl($rootScope,$mdDialog,datos,busqueda,operacion){var scope=this;$rootScope.titulo="Conexiones",$rootScope.cargando=!1,$rootScope.tema="theme1",scope.items=datos.data,scope.inicio=function(){scope.total=0,scope.limit=10,scope.page=1},scope.nuevo=function(ev){$mdDialog.show({controller:nuevoItemproCtrl,templateUrl:"views/altaitempro.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){busqueda.itemsProveedor().success(function(data){scope.items=data})})},scope.confirma=function(ev,index,almacen){var usuario=scope.usuarios[index],confirm=$mdDialog.confirm().title("¿Seguro que deseas asignar este almacen?").content("").ariaLabel("Asignar Almacen").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){operacion.bajaAlmacen(almacen.ALM_clave,usuario.clave)},function(){busqueda.usuariosAlmacen().success(function(data){scope.items=data})})}}function nuevoItemproCtrl($scope,$mdDialog,busqueda,mensajes,$q,$filter,operacion,$rootScope){function consultado(query){var q=$q.defer();return findValues(query,$scope.items).then(function(res){q.resolve(res)}),q.promise}function findValues(query,obj){var deferred=$q.defer();return deferred.resolve($filter("filter")(obj,query)),deferred.promise}busqueda.proveedores().then(function(info){$scope.proveedores=info.data}),busqueda.items().then(function(info){$scope.items=info.data}),$scope.inicio=function(){$scope.seleccionado=null,$scope.busqueda=null,$scope.consultado=consultado,$scope.datos={usuarioasigno:$rootScope.id,item:"",proveedor:"",cantidad:""},$scope.guardando=!1},$scope.guardar=function(){console.log($scope.datos),$scope.guardando=!0,operacion.altaItempro($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.inicio()}).error(function(error){})},$scope.cancel=function(){$mdDialog.hide()}}function itemsCtrl($rootScope,$mdDialog,datos,items,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Items Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:itemCtrl,templateUrl:"views/item.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=items.query()})},scope.edita=function(ev,index){var usuario=scope.info[index];$mdDialog.show({controller:itemEditCtrl,templateUrl:"views/item.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario}}).then(function(){scope.info=items.query()})},scope.confirmacion=function(ev,index){var item=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar item").ok("Si").cancel("No").targetEvent(ev);

$mdDialog.show(confirm).then(function(){item.ITE_activo=item.ITE_activo?0:1;var datos={nombre:item.ITE_nombre,precio:item.ITE_precioventa,cantidad:item.ITE_cantidadtotal,tipo:item.TIT_clave,subtipo:item.STI_clave,activo:item.ITE_activo};items.update({item:item.ITE_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function itemCtrl($scope,$mdDialog,busqueda,items,mensajes,$rootScope,datos,archivos){$rootScope.titulo="Nuevo Item",$scope.tipoitems=datos[0].data,$scope.subtipoitems=datos[1].data,$scope.presentaciones=datos[2].data,$scope.inicio=function(){$scope.sustancias=[],$scope.imagenes=[],$scope.guardando=!1,$scope.datos={nombre:"",precio:"",cantidad:"",codigo:"",codigoean:"",tipo:"",subtipo:"",presentacion:"",clasificacion:"",sustancia:$scope.sustancias,posologia:"",activo:!0}},$scope.guardar=function(){$scope.guardando=!0,items.save($scope.datos,function(data){var respuesta=data.respuesta;archivos.items($scope.imagenes,data.clave).then(function(data){console.log("Imagenes: "+data),mensajes.alerta(respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.itemForm.$setPristine(),$scope.inicio()},function(data){mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","done_all")},function(data){console.log("Estatus: "+data)})})},$scope.verificador=function(){return $scope.itemForm.$valid&&1!=$scope.datos.tipo?!1:$scope.itemForm.$valid&&1==$scope.datos.tipo&&$scope.sustancias&&$scope.datos.posologia?!1:!0},$scope.upload=function(files,file,event){if(files&&files.length)for(var i=0;i<files.length;i++)$scope.imagenes.push(files[i])},$scope.eliminaImagen=function(index){$scope.imagenes.splice(index,1)},$scope.cancel=function(){$mdDialog.hide()}}function itemEditCtrl($scope,$mdDialog,busqueda,items,mensajes,$rootScope,datos,archivos){$rootScope.titulo="Detalle de Item",$scope.tipoitems=datos[0].data,$scope.subtipoitems=datos[1].data,$scope.presentaciones=datos[2].data,$scope.sustancias=datos[3].datos.ITE_sustancia?datos[3].datos.ITE_sustancia.split(","):"",$scope.clave=datos[3].datos.ITE_clave,$scope.datos={nombre:datos[3].datos.ITE_nombre,codigo:datos[3].datos.ITE_codigo,precio:datos[3].datos.ITE_precioventa,cantidad:datos[3].datos.ITE_cantidadtotal,tipo:datos[3].datos.TIT_clave,subtipo:datos[3].datos.STI_clave,sustancia:$scope.sustancias,posologia:datos[3].datos.ITE_posologia,presentacion:datos[3].datos.PRE_clave,activo:datos[3].datos.ITE_activo?!0:!1},$scope.inicio=function(){$scope.imagenesguardadas=datos[3].archivos,$scope.imagenes=[],$scope.guardando=!1},$scope.verificador=function(){return $scope.itemForm.$valid&&1!=$scope.datos.tipo?!1:$scope.itemForm.$valid&&1==$scope.datos.tipo&&$scope.sustancias&&$scope.datos.posologia?!1:!0},$scope.upload=function(files,file,event){if(files&&files.length)for(var i=0;i<files.length;i++)$scope.imagenes.push(files[i])},$scope.eliminaImagen=function(index){$scope.imagenes.splice(index,1)},$scope.eliminaImagenGuardad=function(index){mensajes.alerta("Eliminando imagen","","top right","");var imagen=$scope.imagenesguardadas[index];archivos.eliminaItem(imagen,$scope.clave).success(function(data){$scope.imagenesguardadas.splice(index,1)})},$scope.guardar=function(){$scope.itemForm.$valid&&($scope.guardando=!0,items.update({item:$scope.clave},$scope.datos,function(data){var respuesta=data.respuesta;archivos.items($scope.imagenes,$scope.clave).then(function(data){console.log("Imagenes: "+data),mensajes.alerta(respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.itemForm.$setPristine(),$scope.inicio()},function(data){mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","done_all")},function(data){console.log("Estatus: "+data)})}))}}function loginCtrl(auth,$rootScope){var sesion=this;$rootScope.cargando=!1,$rootScope.tema="theme1",sesion.inicio=function(){sesion.datos={usuario:"",psw:"",guardar:!1}},sesion.login=function(){$rootScope.cargando=!0,auth.login(sesion.datos)}}function movimientosCtrl($rootScope,$mdDialog,datos,busqueda,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Movimientos Registrados",scope.info=datos.data,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Movimientos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:movimientoCtrl,templateUrl:"views/movimiento.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){busqueda.movimientos().success(function(data){scope.info=data})})}}function movimientoCtrl($scope,$rootScope,$mdDialog,busqueda,operacion,mensajes,$q,$filter){function consultado(query){var q=$q.defer();return findValues(query,$scope.items).then(function(res){q.resolve(res)}),q.promise}function findValues(query,obj){var deferred=$q.defer();return deferred.resolve($filter("filter")(obj,query)),deferred.promise}busqueda.items().then(function(info){$scope.items=info.data}),busqueda.almacenes().then(function(info){$scope.almacenes=info.data}),busqueda.tiposMovimiento().then(function(info){$scope.tiposmovimiento=info.data}),busqueda.tiposAjuste().then(function(info){$scope.tiposajuste=info.data}),$scope.inicio=function(){$scope.busqueda=null,$scope.consultado=consultado,$scope.item="",$scope.datos={item:"",cantidad:"",tipomov:"",tipoa:"",orden:"",usuario:$rootScope.id,observaciones:""},$scope.guardando=!1},$scope.guardar=function(){$scope.movimientoForm.$valid&&$scope.item&&($scope.datos.item=$scope.item.ITE_clave,console.log($scope.datos),$scope.guardando=!0,operacion.altaMovimiento($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.movimientoForm.$setPristine(),$scope.inicio()}))},$scope.verificaForm=function(){return 1==$scope.datos.tipomov&&""==$scope.datos.tipoa?!0:$scope.movimientoForm.$invalid?!0:$scope.guardando?!0:!1},$scope.cancel=function(){$mdDialog.hide()}}function ordenesCompraCtrl($rootScope,$mdDialog,datos,busqueda,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Ordenes Registrados",scope.info=datos.data,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Movimientos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:ordenCompraCtrl,templateUrl:"views/ordencompra.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){busqueda.ordenescompra().success(function(data){scope.info=data})})}}function ordenCompraCtrl($scope,$rootScope,operacion,mensajes,datos){$scope.paso1="views/ordenPaso1.html",$scope.paso2="views/ordenPaso2.html",$scope.paso3="views/ordenPaso3.html",$scope.paso4="views/ordenPaso4.html",$rootScope.tema="theme1",$rootScope.titulo="Nueva Orden",$scope.unidades=datos.data,$scope.inicio=function(){$scope.step2block=!0,$scope.step3block=!0,$scope.step4block=!0,$scope.todos=!0,$scope.selectedIndex=0,$scope.unidad="",$scope.seleccionItems=[],$scope.seleccionOrden=[],$scope.ordenItems=[],$scope.totalItems=[],$scope.proveedores=[],$scope.selected=[],$scope.items=[],$scope.ordenesListas=[],$scope.ordenes=[]},$scope.info=function(unidad){$scope.selected=[],$scope.items=[],$scope.almacenes="",$scope.unidad=unidad,operacion.infoUnidad(unidad).then(function(data){$scope.almacenes=data[0].data,$scope.items=data[1].data,angular.forEach(data[0].data,function(value,key){$scope.selected.push(value)})},function(error){alert(error)})},$scope.muestraItems=function(datos){operacion.itemsAlmacenes($scope.unidad,datos).success(function(data){$scope.items=data})},$scope.toggle=function(item,list){var idx=list.indexOf(item);idx>-1?list.splice(idx,1):list.push(item),$scope.muestraItems(list)},$scope.exists=function(item,list){return list.indexOf(item)>-1},$scope.muestraSemaforo=function(existencia,nivelMinimo,nimvelCompra){return existencia==nivelMinimo||nivelMinimo>existencia?"bgm-red":existencia>nivelMinimo&&nimvelCompra>existencia||existencia==nimvelCompra?"bgm-yellow":existencia>nimvelCompra?"bgm-green":void 0},$scope.ir2=function(selecciones){operacion.preparaOrden(selecciones).then(function(data){$scope.ordenItems=data.datos,$scope.totalItems=data.info,$scope.proveedores=data.proveedores,$scope.selectedIndex=1,$scope.step2block=!1})},$scope.cambio=function(item,list){var id2x=list.indexOf(item);id2x>-1?list.splice(id2x,1):list.push(item)},$scope.existeEnOrden=function(item,list){return list.indexOf(item)>-1},$scope.cantidad=function(item){for(var i=0;i<$scope.ordenItems.length;i++){var itx=$scope.ordenItems[i];if(itx.ITE_nombre==item)return itx.porsurtir}},$scope.compra=function(item){for(var i=0;i<$scope.ordenItems.length;i++){var itx=$scope.ordenItems[i];if(itx.ITE_nombre==item)return itx.nivelcompra}},$scope.existencia=function(item){for(var i=0;i<$scope.ordenItems.length;i++){var itx=$scope.ordenItems[i];if(itx.ITE_nombre==item)return itx.existencia}},$scope.itemProporcional=function(item){operacion.proporcionalXitem(item,$scope.ordenItems)},$scope.itemEconomico=function(item){operacion.economicoXitem(item,$scope.ordenItems)},$scope.verificaCantidad=function(item,proveedor){operacion.cambioXproveedor(proveedor,item,$scope.ordenItems)},$scope.generaOrden=function(){$scope.selectedIndex=2,$scope.step3block=!1,operacion.verificaItems($scope.ordenItems).then(function(data){$scope.seleccionOrden=data})},$scope.generaCantidades=function(){console.log($scope.ordenItems),console.log($scope.totalItems),operacion.generaCantidades($scope.totalItems).then(function(data){$scope.ordenItems=data})},$scope.generaMasBarato=function(){operacion.generaMasBarato($scope.totalItems).then(function(data){$scope.ordenItems=data})},$scope.muestraTotal=function(proveedor){for(var total=0,i=0;i<$scope.seleccionOrden.length;i++){var item=$scope.seleccionOrden[i],cantidad=item.cantidad*item.IPR_ultimoCosto;item.PRO_nombrecorto==proveedor&&(total+=cantidad)}return total},$scope.total=function(){for(var TotalGeneral=0,i=0;i<$scope.seleccionOrden.length;i++){var item=$scope.seleccionOrden[i],cantidad=item.cantidad*item.IPR_ultimoCosto;TotalGeneral+=cantidad}return TotalGeneral},$scope.confirmaOrden=function(){operacion.generaOrdenes($scope.seleccionOrden,$scope.proveedores,$scope.unidad,$scope.almacenes).then(function(data){$scope.selectedIndex=3,$scope.step4block=!1,$scope.step3block=!0,$scope.step2block=!0,$scope.ordenes=data.ordenes},function(error){alert(error)})},$scope.confirmaOrdenProveedor=function(proveedor){operacion.ordenXproveedor(proveedor,$scope.unidad,$scope.almacenes,$scope.seleccionOrden).then(function(data){mensajes.alerta("Orden generada satisfactoriamente","success","top right","done_all"),$scope.todos=!1,$scope.step2block=!0,$scope.step4block=!1,$scope.ordenes.push(data.ordenes[0])},function(error){alert(error)})},$scope.muestraOrdenes=function(){operacion.generaDetalleOrdenes($scope.ordenes).then(function(data){$scope.ordenesListas=data},function(error){alert(error)})}}function perfilesCtrl($rootScope,$mdDialog,datos,permisos,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Perfiles Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Perfiles por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevoPerfil=function(ev){$mdDialog.show({controller:perfilCtrl,templateUrl:"views/perfil.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=permisos.query()})},scope.editaPerfil=function(ev,index){var perfil=scope.info[index];$mdDialog.show({controller:perfilEditCtrl,templateUrl:"views/perfil.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:perfil}}).then(function(){scope.info=permisos.query()})},scope.confirmacion=function(ev,index){var permiso=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el permiso?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){permiso.PER_activo=permiso.PER_activo?0:1;var datos={nombre:permiso.PER_nombre,entradas:permiso.PER_entradas,salidas:permiso.PER_salidas,traspasos:permiso.PER_traspasos,editaItem:permiso.PER_consultaItems,desactivaItem:permiso.PER_desactivaItems,editaCatalogos:permiso.PER_consultaCatalogo,desactivaCatalogos:permiso.PER_desactivaCatalogo,autorizaorden:permiso.PER_autorizaOrden,modificaorden:permiso.PER_modificaOrden,cerrarorden:permiso.PER_cerrarOrden,surtir:permiso.PER_surtir,facturas:permiso.PER_subirFactura,asociar:permiso.PER_asociar,activo:permiso.PER_activo};permisos.update({permiso:permiso.PER_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function perfilCtrl($scope,$mdDialog,permisos,mensajes){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:"",entradas:!1,salidas:!1,traspasos:!1,editaItem:!1,desactivaItem:!1,editaCatalogos:!1,desactivaCatalogos:!1,autorizaorden:!1,modificaorden:!1,cerrarorden:!1,surtir:!1,facturas:!1,asociar:!1,activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,permisos.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function perfilEditCtrl($scope,$mdDialog,permisos,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.PER_nombre,entradas:informacion.PER_entradas?!0:!1,salidas:informacion.PER_salidas?!0:!1,traspasos:informacion.PER_traspasos?!0:!1,editaItem:informacion.PER_consultaItems?!0:!1,desactivaItem:informacion.PER_desactivaItems?!0:!1,editaCatalogos:informacion.PER_consultaCatalogo?!0:!1,desactivaCatalogos:informacion.PER_desactivaCatalogo?!0:!1,autorizaorden:informacion.PER_autorizaOrden?!0:!1,modificaorden:informacion.PER_modificaOrden?!0:!1,cerrarorden:informacion.PER_cerrarOrden?!0:!1,surtir:informacion.PER_surtir?!0:!1,facturas:informacion.PER_subirFactura?!0:!1,asociar:informacion.PER_asociar?!0:!1,activo:informacion.PER_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,permisos.update({permiso:informacion.PER_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function proveedoresCtrl($rootScope,$mdDialog,datos,proveedores,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Proveedores Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Proveedores por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevo=function(ev){$mdDialog.show({controller:proveedorCtrl,templateUrl:"views/proveedor.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=proveedores.query()})},scope.edita=function(ev,index){var usuario=scope.info[index];$mdDialog.show({controller:proveedorEditCtrl,templateUrl:"views/proveedor.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario}}).then(function(){scope.info=proveedores.query()})},scope.confirmacion=function(ev,index){var proveedor=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el proveedor?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar proveedor").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){proveedor.PRO_activo=proveedor.PRO_activo?0:1;var datos={nombre:proveedor.PRO_nombre,nombrecorto:proveedor.PRO_nombrecorto,razon:proveedor.PRO_razonSocial,rfc:proveedor.PRO_rfc,activo:proveedor.PRO_activo};proveedores.update({proveedor:proveedor.PRO_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function proveedorCtrl($scope,$mdDialog,permisos,proveedores,mensajes,datos,Upload,$rootScope){$rootScope.titulo="Nuevo Proveedor",$scope.permisos=datos,$scope.inicio=function(){$scope.datos={nombre:"",nombrecorto:"",rfc:"",razon:"",activo:!0},$scope.imagenes=[],$scope.guardando=!1},$scope.guardar=function(){$scope.proveedorForm.$valid&&($scope.guardando=!0,proveedores.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.proveedorForm.$setPristine(),$scope.inicio()}))},$scope.upload=function(files,file,event){if(files&&files.length)for(var i=0;i<files.length;i++)$scope.imagenes.push(files[i])},$scope.eliminaImagen=function(index){$scope.imagenes.splice(index,1)},$scope.cancel=function(){$mdDialog.hide()}}function proveedorEditCtrl($scope,$mdDialog,permisos,proveedores,mensajes,informacion){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:informacion.PRO_nombre,nombrecorto:informacion.PRO_nombrecorto,razon:informacion.PRO_razon,rfc:informacion.PRO_rfc,activo:informacion.PRO_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.proveedorForm.$valid&&($scope.guardando=!0,proveedores.update({proveedor:informacion.PRO_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.proveedorForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function subTiposItemCtrl($rootScope,$mdDialog,datos,subtipositem,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="SubTipos de Item Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevoTipo=function(ev){$mdDialog.show({controller:subTipoItemCtrl,templateUrl:"views/subtipoitem.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=subtipositem.query()})},scope.editaTipo=function(ev,index){var subtipoitem=scope.info[index];$mdDialog.show({controller:subTipoItemEditCtrl,templateUrl:"views/subtipoitem.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:subtipoitem}}).then(function(){scope.info=subtipositem.query()})},scope.confirmacion=function(ev,index){var subtipoitem=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){subtipoitem.STI_activo=subtipoitem.STI_activo?0:1;var datos={nombre:subtipoitem.STI_nombre,activo:subtipoitem.STI_activo};subtipositem.update({subtipoitem:subtipoitem.STI_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function subTipoItemCtrl($scope,$mdDialog,busqueda,subtipositem,mensajes){$scope.subtipositem=subtipositem.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.subtipoForm.$valid&&($scope.guardando=!0,subtipositem.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.subtipoForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function subTipoItemEditCtrl($scope,$mdDialog,subtipositem,mensajes,informacion,busqueda){console.log(informacion),$scope.inicio=function(){$scope.datos={nombre:informacion.STI_nombre,activo:informacion.STI_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.subtipoForm.$valid&&($scope.guardando=!0,subtipositem.update({subtipoitem:informacion.STI_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.subtipoForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function tiposAlmacenCtrl($rootScope,$mdDialog,datos,tiposalmacen,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Tipos de Almacen Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevo=function(ev){$mdDialog.show({controller:tipoAlmacenCtrl,templateUrl:"views/tipoalmacen.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=tiposalmacen.query()})},scope.edita=function(ev,index){var tipoalmacen=scope.info[index];$mdDialog.show({controller:tipoAlmacenEditCtrl,templateUrl:"views/tipoalmacen.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:tipoalmacen}}).then(function(){scope.info=tiposalmacen.query()})},scope.confirmacion=function(ev,index){var tipoalmacen=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de almacen?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){tipoalmacen.TAL_activo=tipoalmacen.TAL_activo?0:1;var datos={nombre:tipoalmacen.TAL_nombre,activo:tipoalmacen.TAL_activo};tiposalmacen.update({tipoalmacen:tipoalmacen.TAL_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoAlmacenCtrl($scope,$mdDialog,tiposalmacen,mensajes){$scope.tiposalmacen=tiposalmacen.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoAlmacenForm.$valid&&($scope.guardando=!0,tiposalmacen.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoAlmacenForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoAlmacenEditCtrl($scope,$mdDialog,tiposalmacen,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TAL_nombre,activo:informacion.TAL_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoAlmacenForm.$valid&&($scope.guardando=!0,tiposalmacen.update({tipoalmacen:informacion.TAL_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoAlmacenForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function tiposItemCtrl($rootScope,$mdDialog,datos,tipositem,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Tipos de Item Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevoTipo=function(ev){$mdDialog.show({controller:tipoItemCtrl,templateUrl:"views/tipoitem.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=tipositem.query()})},scope.editaTipo=function(ev,index){var tipoitem=scope.info[index];$mdDialog.show({controller:tipoItemEditCtrl,templateUrl:"views/tipoitem.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:tipoitem}}).then(function(){scope.info=tipositem.query()})},scope.confirmacion=function(ev,index){var tipoitem=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){tipoitem.TIT_activo=tipoitem.TIT_activo?0:1;var datos={nombre:tipoitem.TIT_nombre,activo:tipoitem.TIT_activo};tipositem.update({tipoitem:tipoitem.TIT_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoItemCtrl($scope,$mdDialog,tipositem,mensajes){$scope.tipositem=tipositem.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,tipositem.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoItemEditCtrl($scope,$mdDialog,tipositem,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TIT_nombre,activo:informacion.TIT_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,tipositem.update({tipoitem:informacion.TIT_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function tiposAjusteCtrl($rootScope,$mdDialog,datos,tiposajuste,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Tipos de Ajuste",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:tipoAjusteCtrl,templateUrl:"views/tipoajuste.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=tiposajuste.query()})},scope.edita=function(ev,index){var tipo=scope.info[index];$mdDialog.show({controller:tipoAjusteEditCtrl,templateUrl:"views/tipoajuste.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:tipo}}).then(function(){scope.info=tiposajuste.query()})},scope.confirmacion=function(ev,index){var tipoajuste=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el tipo de ajuste?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar Tipo Ajuste").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){tipoajuste.TIA_activo=tipoajuste.TIA_activo?0:1;var datos={nombre:tipoajuste.TIA_nombre,activo:tipoajuste.TIA_activo};tipoajustes.update({tipo:tipoajuste.TIA_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoAjusteCtrl($scope,$mdDialog,busqueda,tiposajuste,mensajes){$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoAForm.$valid&&($scope.guardando=!0,tiposajuste.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoAForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoAjusteEditCtrl($scope,$mdDialog,tiposajuste,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TIA_nombre,activo:informacion.TIA_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoAForm.$valid&&($scope.guardando=!0,tiposajuste.update({tipo:informacion.TIA_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoAForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function tiposMovimientoCtrl($rootScope,$mdDialog,datos,tiposmovimiento,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Tipos de Movmiento",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:tipoMovimientoCtrl,templateUrl:"views/tipomovimiento.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=tiposmovimiento.query()})},scope.edita=function(ev,index){var usuario=scope.info[index];$mdDialog.show({controller:tipoMovimientoEditCtrl,templateUrl:"views/tipomovimiento.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario}}).then(function(){scope.info=tiposmovimiento.query()})},scope.confirmacion=function(ev,index){var tipomovimiento=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el tipo de movimiento?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar Tipo Movimiento").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){tipomovimiento.TIM_activo=tipomovimiento.TIM_activo?0:1;var datos={nombre:tipomovimiento.TIM_nombre,activo:tipomovimiento.TIM_activo};tiposmovimiento.update({tipo:tipomovimiento.TIM_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoMovimientoCtrl($scope,$mdDialog,tiposmovimiento,mensajes){$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoMovForm.$valid&&($scope.guardando=!0,tiposmovimiento.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoMovForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoMovimientoEditCtrl($scope,$mdDialog,tiposmovimiento,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TIM_nombre,activo:informacion.TIM_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoMovForm.$valid&&($scope.guardando=!0,tiposmovimiento.update({tipo:informacion.TIM_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoMovForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function tiposOrdenCtrl($rootScope,$mdDialog,datos,tiposorden,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Tipos de Orden Registrados",scope.info=datos,scope.total=0,scope.order="TOR_clave",scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.onOrderChange=function(order){},scope.nuevo=function(ev){$mdDialog.show({controller:tipoOrdenCtrl,templateUrl:"views/tipoorden.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=tiposorden.query()})},scope.edita=function(ev,index){var tipoorden=scope.info[index];$mdDialog.show({controller:tipoOrdenEditCtrl,templateUrl:"views/tipoorden.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:tipoorden}}).then(function(){scope.info=tiposorden.query()})},scope.confirmacion=function(ev,index){var tipoorden=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){tipoorden.TOR_activo=tipoorden.TOR_activo?0:1;var datos={nombre:tipoorden.TOR_nombre,activo:tipoorden.TOR_activo};tiposorden.update({tipoorden:tipoorden.TOR_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoOrdenCtrl($scope,$mdDialog,tiposorden,mensajes){$scope.tiposorden=tiposorden.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoOrdenForm.$valid&&($scope.guardando=!0,tiposorden.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoOrdenForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoOrdenEditCtrl($scope,$mdDialog,tiposorden,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TOR_nombre,activo:informacion.TOR_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){
$scope.tipoOrdenForm.$valid&&($scope.guardando=!0,tiposorden.update({tipoorden:informacion.TOR_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoOrdenForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function unidadesCtrl($rootScope,$mdDialog,datos,unidades,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Unidades Registradas",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevo=function(ev){$mdDialog.show({controller:unidadCtrl,templateUrl:"views/unidad.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=unidades.query()})},scope.edita=function(ev,index){var unidad=scope.info[index];$mdDialog.show({controller:unidadEditCtrl,templateUrl:"views/unidad.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:unidad}}).then(function(){scope.info=unidades.query()})},scope.confirmacion=function(ev,index){var unidad=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar la Unidad?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar unidad").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){unidad.UNI_activo=unidad.UNI_activo?0:1;var datos={nombre:unidad.UNI_nombre,nombrecorto:unidad.UNI_nombrecorto,correo:unidad.UNI_correo,activo:unidad.UNI_activo};unidades.update({unidad:unidad.UNI_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function unidadCtrl($scope,$mdDialog,unidades,mensajes){$scope.unidades=unidades.query(),$scope.inicio=function(){$scope.datos={nombre:"",nombrecorto:"",correo:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.unidadForm.$valid&&($scope.guardando=!0,unidades.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.unidadForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function unidadEditCtrl($scope,$mdDialog,unidades,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.UNI_nombre,nombrecorto:informacion.UNI_nombrecorto,correo:informacion.UNI_correo,activo:informacion.UNI_activo?!0:!1},$scope.guardando=!1},$scope.guardar=function(){$scope.unidadForm.$valid&&($scope.guardando=!0,unidades.update({unidad:informacion.UNI_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.unidadForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}function usualmCtrl($rootScope,datos,$mdDialog,busqueda,operacion){var scope=this;$rootScope.titulo="Conexiones",$rootScope.cargando=!1,$rootScope.tema="theme1",scope.inicio=function(){scope.total=0,scope.limit=10,scope.page=1,scope.usuarios=datos[0].data},scope.nuevo=function(ev,index){var usuario=scope.usuarios[index];$mdDialog.show({controller:nuevoUsualmCtrl,templateUrl:"views/almacenusuario.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1,locals:{informacion:usuario}}).then(function(){busqueda.usuariosAlmacen().success(function(data){scope.usuarios=data})})},scope.confirma=function(ev,index,almacen){var usuario=scope.usuarios[index],confirm=$mdDialog.confirm().title("¿Seguro que deseas asignar este almacen?").content("").ariaLabel("Asignar Almacen").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){operacion.bajaAlmacen(almacen.ALM_clave,usuario.clave)},function(){busqueda.usuariosAlmacen().success(function(data){scope.usuarios=data})})}}function nuevoUsualmCtrl($scope,$mdDialog,busqueda,mensajes,$q,$filter,informacion,operacion,$rootScope){function consultado(query){var q=$q.defer();return findValues(query,$scope.almacenes).then(function(res){q.resolve(res)}),q.promise}function findValues(query,obj){var deferred=$q.defer();return deferred.resolve($filter("filter")(obj,query)),deferred.promise}console.log(informacion),busqueda.almacenUsuario(informacion.clave).then(function(info){$scope.almacenes=info.data}),$scope.inicio=function(){$scope.seleccionado=null,$scope.busqueda=null,$scope.consultado=consultado,$scope.almacenesseleccionados=[],$scope.datos={usuario:informacion.clave,usuarioasigno:$rootScope.id,almacenes:$scope.almacenesseleccionados},$scope.guardando=!1},$scope.guardar=function(){console.log($scope.datos),$scope.guardando=!0,operacion.altaAlmacenes($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.inicio()}).error(function(error){})},$scope.cancel=function(){$mdDialog.hide()}}function usuariosCtrl($rootScope,$mdDialog,datos,usuarios,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Usuarios Registrados",scope.info=datos,scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Usuarios por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevoUsuario=function(ev){$mdDialog.show({controller:usuarioCtrl,templateUrl:"views/usuario.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=usuarios.query()})},scope.editaUsuario=function(ev,index){var usuario=scope.info[index];$mdDialog.show({controller:usuarioEditCtrl,templateUrl:"views/usuarioEdicion.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario}}).then(function(){scope.info=usuarios.query()})},scope.confirmacion=function(ev,index){var usuario=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el usuario?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar usuario").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){usuario.USU_activo=usuario.USU_activo?0:1;var datos={nombre:usuario.USU_nombrecompleto,usuario:usuario.USU_login,perfil:usuario.PER_clave,activo:usuario.USU_activo};usuarios.update({usuario:usuario.USU_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function usuarioCtrl($scope,$mdDialog,permisos,usuarios,mensajes){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:"",usuario:"",psw:"",psw2:"",perfil:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.usuarioForm.$valid&&($scope.guardando=!0,usuarios.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.usuarioForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function usuarioEditCtrl($scope,$mdDialog,usuarios,mensajes,informacion,permisos){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:informacion.USU_nombrecompleto,usuario:informacion.USU_login,psw:"",psw2:"",perfil:informacion.PER_clave,activo:informacion.USU_activo?!0:!1},$scope.nuevopsw=!1,$scope.guardando=!1},$scope.guardar=function(){$scope.usuarioForm.$valid&&($scope.guardando=!0,usuarios.update({usuario:informacion.USU_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.usuarioForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}var app=angular.module("app",["ui.router","ngMaterial","ngMdIcons","webStorageModule","ngMessages","ngResource","ngAnimate","md.data.table","ngFileUpload","angular.filter"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider","$mdThemingProvider","$httpProvider",config]),app.run(["$rootScope","$state","$mdSidenav","$mdBottomSheet","auth","webStorage",run]),app.constant("api","http://localhost/inventario/server/public/api/"),app.directive("mayusculas",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){element.bind("blur",function(){var inputValue=modelCtrl.$modelValue;if(inputValue){var capitalized=inputValue.toUpperCase();capitalized!==inputValue&&(modelCtrl.$setViewValue(capitalized),modelCtrl.$render())}}),element.css("text-transform","uppercase")}}}),app.directive("dinero",function(){function link(scope,el,attrs,ngModelCtrl){function round(num){var d=Math.pow(10,precision);return Math.round(num*d)/d}function formatPrecision(value){return parseFloat(value).toFixed(precision)}function formatViewValue(value){return ngModelCtrl.$isEmpty(value)?"":""+value}var lastValidValue,min=parseFloat(attrs.min||0),precision=parseFloat(attrs.precision||2);ngModelCtrl.$parsers.push(function(value){0===value.indexOf(".")&&(value="0"+value),0===value.indexOf("-")&&(min>=0?(value=null,ngModelCtrl.$setViewValue(""),ngModelCtrl.$render()):"-"===value&&(value=""));var empty=ngModelCtrl.$isEmpty(value);return empty||NUMBER_REGEXP.test(value)?lastValidValue=""===value?null:empty?value:parseFloat(value):(ngModelCtrl.$setViewValue(formatViewValue(lastValidValue)),ngModelCtrl.$render()),ngModelCtrl.$setValidity("number",!0),lastValidValue}),ngModelCtrl.$formatters.push(formatViewValue);var minValidator=function(value){return!ngModelCtrl.$isEmpty(value)&&min>value?void ngModelCtrl.$setValidity("min",!1):(ngModelCtrl.$setValidity("min",!0),value)};if(ngModelCtrl.$parsers.push(minValidator),ngModelCtrl.$formatters.push(minValidator),attrs.max){var max=parseFloat(attrs.max),maxValidator=function(value){return!ngModelCtrl.$isEmpty(value)&&value>max?void ngModelCtrl.$setValidity("max",!1):(ngModelCtrl.$setValidity("max",!0),value)};ngModelCtrl.$parsers.push(maxValidator),ngModelCtrl.$formatters.push(maxValidator)}precision>-1&&(ngModelCtrl.$parsers.push(function(value){return value?round(value):value}),ngModelCtrl.$formatters.push(function(value){return value?formatPrecision(value):value})),el.bind("blur",function(){var value=ngModelCtrl.$modelValue;value&&(ngModelCtrl.$viewValue=formatPrecision(value),ngModelCtrl.$render())})}var NUMBER_REGEXP=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;return{restrict:"A",require:"ngModel",link:link}}),app.factory("almacenes",almacenes),app.factory("archivos",archivos),app.factory("auth",auth),app.factory("busqueda",busqueda),app.factory("items",items),app.factory("mensajes",mensajes),app.factory("operacion",operacion),app.factory("permisos",permisos),app.factory("proveedores",proveedores),app.factory("subtipositem",subtipositem),app.factory("tiposajuste",tiposajuste),app.factory("tiposalmacen",tiposalmacen),app.factory("tipositem",tipositem),app.factory("tiposmovimiento",tiposmovimiento),app.factory("tiposorden",tiposorden),app.factory("unidades",unidades),app.factory("usuarios",usuarios),app.controller("almacenCtrl",almacenCtrl),app.controller("almacenesCtrl",almacenesCtrl),app.controller("almacenEditCtrl",almacenEditCtrl),almacenesCtrl.$inject=["$rootScope","$mdDialog","datos","almacenes","mensajes"],almacenCtrl.$inject=["$scope","$mdDialog","busqueda","almacenes","mensajes"],almacenEditCtrl.$inject=["$scope","$mdDialog","almacenes","mensajes","informacion","busqueda"],app.controller("configuracionCtrl",configuracionCtrl),configuracionCtrl.$inject=["$rootScope","$mdDialog","busqueda","operacion","mensajes","datos"],app.controller("existenciasCtrl",existenciasCtrl),app.controller("traspasoCtrl",traspasoCtrl),existenciasCtrl.$inject=["$rootScope","$mdDialog","datos","busqueda","mensajes"],traspasoCtrl.$inject=["$scope","$rootScope","$mdDialog","busqueda","operacion","mensajes","datos","$filter","$q"],app.controller("homeCtrl",homeCtrl),homeCtrl.$inject=["$rootScope"],app.controller("itemproCtrl",itemproCtrl),app.controller("nuevoItemproCtrl",nuevoItemproCtrl),itemproCtrl.$inject=["$rootScope","$mdDialog","datos","busqueda","operacion"],nuevoItemproCtrl.$inject=["$scope","$mdDialog","busqueda","mensajes","$q","$filter","operacion","$rootScope"],app.controller("itemCtrl",itemCtrl),app.controller("itemsCtrl",itemsCtrl),app.controller("itemEditCtrl",itemEditCtrl),itemsCtrl.$inject=["$rootScope","$mdDialog","datos","items","mensajes"],itemCtrl.$inject=["$scope","$mdDialog","busqueda","items","mensajes","$rootScope","datos","archivos"],itemEditCtrl.$inject=["$scope","$mdDialog","busqueda","items","mensajes","$rootScope","datos","archivos"],app.controller("loginCtrl",loginCtrl),loginCtrl.$inject=["auth","$rootScope"],app.controller("movimientoCtrl",movimientoCtrl),app.controller("movimientosCtrl",movimientosCtrl),movimientosCtrl.$inject=["$rootScope","$mdDialog","datos","busqueda","mensajes"],movimientoCtrl.$inject=["$scope","$rootScope","$mdDialog","busqueda","operacion","mensajes","$q","$filter"],app.controller("ordenCompraCtrl",ordenCompraCtrl),app.controller("ordenesCompraCtrl",ordenesCompraCtrl),ordenesCompraCtrl.$inject=["$rootScope","$mdDialog","datos","busqueda","mensajes"],ordenCompraCtrl.$inject=["$scope","$rootScope","operacion","mensajes","datos"],app.controller("perfilCtrl",perfilCtrl),app.controller("perfilesCtrl",perfilesCtrl),app.controller("perfilEditCtrl",perfilEditCtrl),perfilesCtrl.$inject=["$rootScope","$mdDialog","datos","permisos","mensajes"],perfilCtrl.$inject=["$scope","$mdDialog","permisos","mensajes"],perfilEditCtrl.$inject=["$scope","$mdDialog","permisos","mensajes","informacion"],app.controller("proveedorCtrl",proveedorCtrl),app.controller("proveedoresCtrl",proveedoresCtrl),app.controller("proveedorEditCtrl",proveedorEditCtrl),proveedoresCtrl.$inject=["$rootScope","$mdDialog","datos","proveedores","mensajes"],proveedorCtrl.$inject=["$scope","$mdDialog","permisos","proveedores","mensajes","datos","Upload","$rootScope"],proveedorEditCtrl.$inject=["$scope","$mdDialog","permisos","proveedores","mensajes","informacion"],app.controller("subTipoItemCtrl",subTipoItemCtrl),app.controller("subTiposItemCtrl",subTiposItemCtrl),app.controller("subTipoItemEditCtrl",subTipoItemEditCtrl),subTiposItemCtrl.$inject=["$rootScope","$mdDialog","datos","subtipositem","mensajes"],subTipoItemCtrl.$inject=["$scope","$mdDialog","busqueda","subtipositem","mensajes"],subTipoItemEditCtrl.$inject=["$scope","$mdDialog","subtipositem","mensajes","informacion","busqueda"],app.controller("tipoAlmacenCtrl",tipoAlmacenCtrl),app.controller("tiposAlmacenCtrl",tiposAlmacenCtrl),app.controller("tipoAlmacenEditCtrl",tipoAlmacenEditCtrl),tiposAlmacenCtrl.$inject=["$rootScope","$mdDialog","datos","tiposalmacen","mensajes"],tipoAlmacenCtrl.$inject=["$scope","$mdDialog","tiposalmacen","mensajes"],tipoAlmacenEditCtrl.$inject=["$scope","$mdDialog","tiposalmacen","mensajes","informacion"],app.controller("tipoItemCtrl",tipoItemCtrl),app.controller("tiposItemCtrl",tiposItemCtrl),app.controller("tipoItemEditCtrl",tipoItemEditCtrl),tiposItemCtrl.$inject=["$rootScope","$mdDialog","datos","tipositem","mensajes"],tipoItemCtrl.$inject=["$scope","$mdDialog","tipositem","mensajes"],tipoItemEditCtrl.$inject=["$scope","$mdDialog","tipositem","mensajes","informacion"],app.controller("tipoAjusteCtrl",tipoAjusteCtrl),app.controller("tiposAjusteCtrl",tiposAjusteCtrl),app.controller("tipoAjusteEditCtrl",tipoAjusteEditCtrl),tiposAjusteCtrl.$inject=["$rootScope","$mdDialog","datos","tiposajuste","mensajes"],tipoAjusteCtrl.$inject=["$scope","$mdDialog","busqueda","tiposajuste","mensajes"],tipoAjusteEditCtrl.$inject=["$scope","$mdDialog","tiposajuste","mensajes","informacion"],app.controller("tipoMovimientoCtrl",tipoMovimientoCtrl),app.controller("tiposMovimientoCtrl",tiposMovimientoCtrl),app.controller("tipoMovimientoEditCtrl",tipoMovimientoEditCtrl),tiposMovimientoCtrl.$inject=["$rootScope","$mdDialog","datos","tiposmovimiento","mensajes"],tipoMovimientoCtrl.$inject=["$scope","$mdDialog","tiposmovimiento","mensajes"],tipoMovimientoEditCtrl.$inject=["$scope","$mdDialog","tiposmovimiento","mensajes","informacion"],app.controller("tipoOrdenCtrl",tipoOrdenCtrl),app.controller("tiposOrdenCtrl",tiposOrdenCtrl),app.controller("tipoOrdenEditCtrl",tipoOrdenEditCtrl),tiposOrdenCtrl.$inject=["$rootScope","$mdDialog","datos","tiposorden","mensajes"],tipoOrdenCtrl.$inject=["$scope","$mdDialog","tiposorden","mensajes"],tipoOrdenEditCtrl.$inject=["$scope","$mdDialog","tiposorden","mensajes","informacion"],app.controller("unidadCtrl",unidadCtrl),app.controller("unidadesCtrl",unidadesCtrl),app.controller("unidadEditCtrl",unidadEditCtrl),unidadesCtrl.$inject=["$rootScope","$mdDialog","datos","unidades","mensajes"],unidadCtrl.$inject=["$scope","$mdDialog","unidades","mensajes"],unidadEditCtrl.$inject=["$scope","$mdDialog","unidades","mensajes","informacion"],app.controller("usualmCtrl",usualmCtrl),app.controller("nuevoUsualmCtrl",nuevoUsualmCtrl),usualmCtrl.$inject=["$rootScope","datos","$mdDialog","busqueda","operacion"],nuevoUsualmCtrl.$inject=["$scope","$mdDialog","busqueda","mensajes","$q","$filter","informacion","operacion","$rootScope"],app.controller("usuarioCtrl",usuarioCtrl),app.controller("usuariosCtrl",usuariosCtrl),app.controller("usuarioEditCtrl",usuarioEditCtrl),usuariosCtrl.$inject=["$rootScope","$mdDialog","datos","usuarios","mensajes"],usuarioCtrl.$inject=["$scope","$mdDialog","permisos","usuarios","mensajes"],usuarioEditCtrl.$inject=["$scope","$mdDialog","usuarios","mensajes","informacion","permisos"];