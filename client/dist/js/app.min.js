!function(){"use strict";var hoy=new Date,dd=hoy.getDate(),mm=hoy.getMonth()+1;mm<10&&(mm="0"+mm),dd<10&&(dd="0"+dd);hoy.getFullYear();angular.module("app",["ui.router","ngMaterial","ngMdIcons","webStorageModule","ngMessages","ngResource","ngAnimate","md.data.table","ngFileUpload","angular.filter"]).constant("api","https://api.medicavial.mx/api/").constant("publicfiles","https://api.medicavial.mx/exports/")}(),function(){"use strict";function config($stateProvider,$urlRouterProvider,$locationProvider,$mdThemingProvider,$httpProvider,$compileProvider,$mdDateLocaleProvider){$compileProvider.debugInfoEnabled(!0),$mdDateLocaleProvider.months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],$mdDateLocaleProvider.shortMonths=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],$mdDateLocaleProvider.days=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],$mdDateLocaleProvider.shortDays=["Do","Lu","Ma","Mi","Ju","Vi","Sa"],$mdDateLocaleProvider.formatDate=function(date){return date?moment(date).format("DD/MM/YYYY"):""},$mdDateLocaleProvider.parseDate=function(dateString){var m=moment(dateString,"DD/MM/YYYY",!0);return m.isValid()?m.toDate():new Date(NaN)},$urlRouterProvider.otherwise("/home"),$stateProvider.state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginCtrl",controllerAs:"sesion"}).state("index",{url:"/","abstract":!0,templateUrl:"views/base.html"}).state("index.altaMovimientos",{url:"altaMovimientos",templateUrl:"views/altaMovimientos.html",controller:"altaMovimientosCtrl",controllerAs:"am",resolve:{datos:function(busqueda,$q,$rootScope){var promesa=$q.defer(),items=busqueda.items(),tiposMovimiento=busqueda.tiposMovimiento(),almacenes=busqueda.almacenesUsuario($rootScope.id),tiposajuste=busqueda.tiposAjuste();return $q.all([items,tiposMovimiento,almacenes,tiposajuste]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.almacenes",{url:"almacenes",templateUrl:"views/almacenes.html",controller:"almacenesCtrl",controllerAs:"almacenes",resolve:{datos:function(almacenes){return almacenes.query().$promise}}}).state("index.accionOrden",{url:"accionOrden?ordenId",templateUrl:"views/accionOrden.html",controller:function($rootScope,$scope,$stateParams){$rootScope.titulo="Orden de Compra",$scope.orden=$stateParams.ordenId},reload:!0}).state("index.conexiones",{url:"conexiones",templateUrl:"views/conexiones.html",controller:function($rootScope){0==$rootScope.permisos.PER_conexiones&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home")),$rootScope.titulo="Conexiones"}}).state("index.configuracion",{url:"configuracion",templateUrl:"views/configuracion.html",controller:"configuracionCtrl",controllerAs:"configuracion",resolve:{datos:function(busqueda,$rootScope,$q){var promesa=$q.defer(),unidades=busqueda.unidadesUsuario($rootScope.id),items=busqueda.items();return $q.all([unidades,items]).then(function(data){var datos={unidades:data[0].data,items:data[1].data};promesa.resolve(datos)},function(error){promesa.reject(error)}),promesa.promise}}}).state("index.completar",{url:"completar?ordenId",templateUrl:"views/completar.html",controller:"completarCtrl",controllerAs:"completa",resolve:{info:function($stateParams,operacion){return operacion.verificaFaltantes($stateParams.ordenId)}},reload:!0}).state("index.detalleItem",{url:"detalleItem?itemId",templateUrl:"views/item.html",controller:"itemEditCtrl",controllerAs:"ie",resolve:{datos:function(busqueda,$q,$stateParams,items){var promesa=$q.defer(),tipoitems=busqueda.tiposItem(),subtipoitems=busqueda.SubTiposItem(),presentaciones=busqueda.presentaciones(),unidadesitem=busqueda.unidadesItem(),item=items.get({item:$stateParams.itemId}).$promise;return $q.all([tipoitems,subtipoitems,presentaciones,item,unidadesitem]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.detalleProveedor",{url:"detalleProveedor?proveedorId",templateUrl:"views/proveedor.html",controller:"proveedorEditCtrl",resolve:{datos:function($q,$stateParams,proveedores){return proveedores.get({proveedor:$stateParams.proveedorId}).$promise}}}).state("index.equivalencias",{url:"equivalencias",templateUrl:"views/equivalencias.html",controller:"equivalenciasCtrl",controllerAs:"equivalencias",resolve:{datos:function(unidadesItem){return unidadesItem.query().$promise}}}).state("index.existencias",{url:"existencias",templateUrl:"views/existencias.html",controller:"existenciasCtrl",controllerAs:"existencias",resolve:{datos:function(busqueda,$rootScope){return busqueda.existencias($rootScope.id)}}}).state("index.home",{url:"home",templateUrl:"views/home.html",controller:"homeCtrl",resolve:{datos:function(busqueda,$rootScope){return busqueda.inicial($rootScope.unidadesAdmin)}}}).state("index.importar",{url:"importar",templateUrl:"views/importar.html",controller:"importarCtrl",controllerAs:"imp"}).state("index.items",{url:"items",templateUrl:"views/items.html",controller:"itemsCtrl",controllerAs:"items",resolve:{datos:function(items){return items.query().$promise}}}).state("index.item",{url:"item",templateUrl:"views/item.html",controller:"itemCtrl",controllerAs:"ie",resolve:{datos:function(busqueda,$q){var promesa=$q.defer(),tipoitems=busqueda.tiposItem(),subtipoitems=busqueda.SubTiposItem(),unidadesitem=busqueda.unidadesItem(),presentaciones=busqueda.presentaciones();return $q.all([tipoitems,subtipoitems,presentaciones,unidadesitem]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.itempro",{url:"itempro",templateUrl:"views/itempro.html",controller:"itemproCtrl",controllerAs:"itempro",resolve:{datos:function(busqueda){return busqueda.itemsProveedor()}}}).state("index.movimientos",{url:"movimientos",templateUrl:"views/movimientos.html",controller:"movimientosCtrl",controllerAs:"movimientos",resolve:{datos:function(busqueda,$q,$rootScope){var promesa=$q.defer(),unidades=busqueda.unidadesUsuario($rootScope.id),tipoitems=busqueda.tiposItem(),items=busqueda.items();return $q.all([unidades,items,tipoitems]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.agranel",{url:"agranel",templateUrl:"views/agranel.html",controller:"agranelCtrl",controllerAs:"agranel",resolve:{datos:function(busqueda){return busqueda.movimientosAgranel()}}}).state("index.nuevaorden",{url:"nuevaorden",templateUrl:"views/ordencompra.html",controller:"ordenCompraCtrl",resolve:{datos:function(busqueda,$rootScope){return busqueda.unidadesUsuario($rootScope.id)}}}).state("index.ordenescompra",{url:"ordenescompra",templateUrl:"views/ordenescompra.html",controller:"ordenesCompraCtrl",controllerAs:"ordenescompra",resolve:{datos:function(busqueda,$rootScope){return busqueda.ordenescompra($rootScope.unidadesAdmin)}}}).state("index.perfiles",{url:"perfiles",templateUrl:"views/perfiles.html",controller:"perfilesCtrl",controllerAs:"perfiles",resolve:{datos:function(permisos){return permisos.query().$promise}}}).state("index.proveedores",{url:"proveedores",templateUrl:"views/proveedores.html",controller:"proveedoresCtrl",controllerAs:"proveedores",resolve:{datos:function(proveedores){return proveedores.query().$promise}}}).state("index.proveedor",{url:"proveedor",templateUrl:"views/proveedor.html",controller:"proveedorCtrl"}).state("index.subtipositem",{url:"subtipositem",templateUrl:"views/subtipositem.html",controller:"subTiposItemCtrl",controllerAs:"subtipositem",resolve:{datos:function(subtipositem){return subtipositem.query().$promise}}}).state("index.surtir",{url:"surtir?ordenId",templateUrl:"views/surtir.html",controller:"surtirCtrl",resolve:{datos:function($stateParams,busqueda){return busqueda.detalleOrdenCompra($stateParams.ordenId)}},reload:!0}).state("index.tipositem",{url:"tipositem",templateUrl:"views/tipositem.html",controller:"tiposItemCtrl",controllerAs:"tipositem",resolve:{datos:function(tipositem){return tipositem.query().$promise}}}).state("index.tiposalmacen",{url:"tiposalmacen",templateUrl:"views/tiposalmacen.html",controller:"tiposAlmacenCtrl",controllerAs:"tiposalmacen",resolve:{datos:function(tiposalmacen){return tiposalmacen.query().$promise}}}).state("index.tiposmovimiento",{url:"tiposmovimiento",templateUrl:"views/tiposmovimiento.html",controller:"tiposMovimientoCtrl",controllerAs:"tiposmovimiento",resolve:{datos:function(tiposmovimiento){return tiposmovimiento.query().$promise}}}).state("index.tiposajuste",{url:"tiposajuste",templateUrl:"views/tiposajuste.html",controller:"tiposAjusteCtrl",controllerAs:"tiposajuste",resolve:{datos:function(tiposajuste){return tiposajuste.query().$promise}}}).state("index.tiposorden",{url:"tiposorden",templateUrl:"views/tiposorden.html",controller:"tiposOrdenCtrl",controllerAs:"tiposorden",resolve:{datos:function(tiposorden){return tiposorden.query().$promise}}}).state("index.usuarios",{url:"usuarios",templateUrl:"views/usuarios.html",controller:"usuariosCtrl",controllerAs:"usuarios",resolve:{datos:function(usuarios){return usuarios.query().$promise}}}).state("index.unidades",{url:"unidades",templateUrl:"views/unidades.html",controller:"unidadesCtrl",controllerAs:"unidades",resolve:{datos:function(unidades){return unidades.query().$promise}}}).state("index.usualm",{url:"usualm",templateUrl:"views/usuarioalmacen.html",controller:"usualmCtrl",controllerAs:"usualm",resolve:{datos:function(busqueda,$q){var promesa=$q.defer(),usuarios=busqueda.usuariosAlmacen();return $q.all([usuarios]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.usualmNuevo",{url:"usualmNuevo?usuario",templateUrl:"views/almacenusuario.html",controller:"nuevoUsualmCtrl",controllerAs:"usualm",resolve:{datos:function(busqueda,$q,$stateParams){var promesa=$q.defer(),usuarios=busqueda.usuarios();return $q.all([usuarios]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.traspaso",{url:"traspaso",templateUrl:"views/traspaso.html",controller:"traspasoCtrl",resolve:{datos:function($rootScope,busqueda,$q){var promesa=$q.defer(),almacenes=busqueda.almacenesUsuario($rootScope.id);return $q.all([almacenes]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.receta",{url:"receta",templateUrl:"views/receta.html",controller:"recetaCtrl",controllerAs:"receta",resolve:{datos:function(busqueda,$q){var promesa=$q.defer(),tipoitems=busqueda.tiposItem(),items=busqueda.items();return $q.all([tipoitems,items]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.reporteExistencias",{url:"reporteExistencias",templateUrl:"views/reporteExistencias.html",controller:"reporteExistenciasCtrl",controllerAs:"existencia",resolve:{datos:function(busqueda,$q,$rootScope){var promesa=$q.defer(),unidades=busqueda.unidadesUsuario($rootScope.id),tipoitems=busqueda.tiposItem(),items=busqueda.items();return $q.all([unidades,items,tipoitems]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.reporteItems",{url:"reporteItems",templateUrl:"views/reporteItems.html",controller:"reporteItemsCtrl",controllerAs:"itm"}).state("index.reporteLotes",{url:"reporteLotes",templateUrl:"views/reporteLotes.html",controller:"reporteLotesCtrl",controllerAs:"lot",resolve:{datos:function(busqueda,$q,$rootScope){var promesa=$q.defer(),unidades=busqueda.unidadesUsuario($rootScope.id),tipoitems=busqueda.tiposItem(),items=busqueda.items();return $q.all([unidades,items,tipoitems]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.reporteMovimientos",{url:"reporteMovimientos",templateUrl:"views/reporteMovimientos.html",controller:"reporteMovimientosCtrl",controllerAs:"mov",resolve:{datos:function(busqueda,$q,$rootScope){var promesa=$q.defer(),unidades=busqueda.unidadesUsuario($rootScope.id),tipoitems=busqueda.tiposItem(),items=busqueda.items();return $q.all([unidades,items,tipoitems]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.reporteTraspasos",{url:"reporteTraspasos",templateUrl:"views/reporteTraspasos.html",controller:"reporteTraspasosCtrl",controllerAs:"tras",resolve:{datos:function(busqueda,$q,$rootScope){var promesa=$q.defer(),unidades=busqueda.unidadesUsuario($rootScope.id),tipoitems=busqueda.tiposItem(),items=busqueda.items();return $q.all([unidades,items,tipoitems]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.reporteOrdenes",{url:"reporteOrdenes",templateUrl:"views/reporteOrdenes.html",controller:"reporteOrdenesCtrl",controllerAs:"ordenes",resolve:{datos:function(busqueda,$q,$rootScope){var promesa=$q.defer(),unidades=busqueda.unidadesUsuario($rootScope.id),items=busqueda.items();return $q.all([unidades,items]).then(function(data){promesa.resolve(data)}),promesa.promise}}}).state("index.prueba",{url:"prueba",templateUrl:"views/prueba.html",controller:"pruebaCtrl",controllerAs:"prueba",resolve:{datos:function(proveedores){return proveedores.query().$promise}}}).state("index.pruebaSE",{url:"pruebaSE",templateUrl:"views/pruebaSE.html",controller:"pruebaSECtrl",controllerAs:"pruebaSE"}).state("index.porCaducar",{url:"porCaducar",templateUrl:"views/porCaducar.html",controller:"porCaducarCtrl",controllerAs:"porCaducar",resolve:{datos:function(busqueda,$rootScope){return busqueda.cunsultaCaducados($rootScope.unidadesAdmin)}}}).state("index.porSurtir",{url:"porSurtir",templateUrl:"views/porSurtir.html",controller:"porSurtirCtrl",controllerAs:"porSurtir",resolve:{datos:function(busqueda,$rootScope){return busqueda.cunsultaApartados($rootScope.unidadesAdmin)}}}).state("index.ordenesAbiertas",{url:"ordenesAbiertas",templateUrl:"views/ordenesAbiertas.html",controller:"ordenesAbiertasCtrl",controllerAs:"ordenesAbiertas",resolve:{datos:function(busqueda,$rootScope){return busqueda.consultaOrdenesAbiertas($rootScope.unidadesAdmin)}}}).state("index.ajusteLotes",{url:"ajusteLotes",templateUrl:"views/ajusteLotes.html",controller:"ajusteLotesCtrl",controllerAs:"ajusteLotes",resolve:{datos:function(busqueda,$q,$rootScope){var promesa=$q.defer(),unidades=busqueda.unidadesUsuario($rootScope.id),tipoitems=busqueda.tiposItem(),items=busqueda.items();return $q.all([unidades,items,tipoitems]).then(function(data){promesa.resolve(data)}),promesa.promise}}}),$locationProvider.html5Mode(!0),$mdThemingProvider.theme("theme1").primaryPalette("indigo").accentPalette("red"),$mdThemingProvider.theme("theme2").primaryPalette("deep-orange").warnPalette("indigo").accentPalette("red"),$mdThemingProvider.theme("theme3").primaryPalette("neonBlue").accentPalette("red"),$mdThemingProvider.theme("theme4").primaryPalette("blue-grey").accentPalette("red"),$mdThemingProvider.theme("theme5").primaryPalette("neonGreen").accentPalette("red"),$mdThemingProvider.theme("theme6").primaryPalette("deep-purple").accentPalette("red"),$mdThemingProvider.theme("purple").primaryPalette("purple").accentPalette("blue").warnPalette("red"),$mdThemingProvider.theme("blue").primaryPalette("blue").accentPalette("amber").warnPalette("red"),$mdThemingProvider.theme("docs-dark").primaryPalette("red").dark();var neonBlueMap=$mdThemingProvider.extendPalette("blue",{500:"#3175E7",contrastDefaultColor:"light"}),neonGreenMap=$mdThemingProvider.extendPalette("green",{500:"#259B24",contrastDefaultColor:"light"});$mdThemingProvider.definePalette("neonBlue",neonBlueMap),$mdThemingProvider.definePalette("neonGreen",neonGreenMap),$mdThemingProvider.setDefaultTheme("theme1"),$mdThemingProvider.alwaysWatchTheme(!0),$httpProvider.defaults.timeout=1e3}angular.module("app").config(config),config.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$mdThemingProvider","$httpProvider","$compileProvider","$mdDateLocaleProvider"]}(),function(){"use strict";function run($rootScope,$state,$mdSidenav,$mdBottomSheet,auth,webStorage,$window,api,$mdMedia,mensajes){var url="";$rootScope.atras=!1,$rootScope.color="#eee",$rootScope.username=webStorage.session.get("username"),$rootScope.nombre=webStorage.session.get("nombre"),$rootScope.id=webStorage.session.get("id"),$rootScope.unidadesAdmin=webStorage.session.get("unidades"),$rootScope.permisos=JSON.parse(webStorage.session.get("permisos")),$rootScope.menu="menu",$rootScope.resetMenu=function(icono){$rootScope.iconoAdmin="add",$rootScope.iconoCatalogos="add",$rootScope.iconoAlmacen="add",$rootScope.iconoReportes="add",$rootScope.iconoPruebas="add",$rootScope.admin=!1,$rootScope.catalogos=!1,$rootScope.almacen=!1,$rootScope.reportes=!1,$rootScope.pruebas=!1},$rootScope.resetMenu(),$rootScope.abrirMenu=function(index){1==index&&($rootScope.admin?$rootScope.iconoAdmin="add":$rootScope.iconoAdmin="remove",$rootScope.admin=!$rootScope.admin),2==index&&($rootScope.catalogos?$rootScope.iconoCatalogos="add":$rootScope.iconoCatalogos="remove",$rootScope.catalogos=!$rootScope.catalogos),3==index&&($rootScope.almacen?$rootScope.iconoAlmacen="add":$rootScope.iconoAlmacen="remove",$rootScope.almacen=!$rootScope.almacen),4==index&&($rootScope.reportes?$rootScope.iconoReportes="add":$rootScope.iconoReportes="remove",$rootScope.reportes=!$rootScope.reportes),5==index&&($rootScope.pruebas?$rootScope.iconoPruebas="add":$rootScope.iconoPruebas="remove",$rootScope.pruebas=!$rootScope.pruebas)},$rootScope.toggleSidenav=function(menuId){$rootScope.atras?$window.history.back():$mdSidenav(menuId).toggle()},$rootScope.muestra=function(ruta){$state.go(ruta)},$rootScope.showGridBottomSheet=function($event){$mdBottomSheet.show({templateUrl:"views/interactivo.html",targetEvent:$event})},$rootScope.logout=function(){$mdBottomSheet.hide(),auth.logout()},$rootScope.ir=function(ruta){$mdSidenav("left").isOpen()&&$mdSidenav("left").toggle(),"index.home"==ruta&&$rootScope.resetMenu(),$state.go(ruta)},$rootScope.pdf=function(index){$window.open(api+"reportes/pdf/ordencompra/"+index,"_blank")},$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){$rootScope.atras=!1,url=toState.name,"login"!=url&&null==webStorage.session.get("username")&&(event.preventDefault(),$state.go("login")),"login"==url&&null!=webStorage.session.get("username")&&(event.preventDefault(),$state.go("index.home")),$rootScope.cargando=!0}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$rootScope.cargando=!1,$rootScope.menu="menu"}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){$rootScope.cargando=!1,mensajes.alerta("Problemas de conexión intentalo nuevamente por favor","error","top right","error"),event.preventDefault(),$state.go("index.home")}),$rootScope.verificaVista=function(){return!$mdMedia("gt-md")||!!$rootScope.atras}}angular.module("app").run(run),run.$inject=["$rootScope","$state","$mdSidenav","$mdBottomSheet","auth","webStorage","$window","api","$mdMedia","mensajes"]}(),angular.module("barcodeGenerator",[]).directive("barcodeGenerator",[function(){var Barcode=function(){var barcode={settings:{barWidth:1,barHeight:50,moduleSize:5,showHRI:!1,addQuietZone:!0,marginHRI:5,bgColor:"#FFFFFF",color:"#000000",fontSize:10,posX:0,posY:0},intval:function(val){var type=typeof val;return"string"==type?(val=val.replace(/[^0-9-.]/g,""),val=parseInt(1*val,10),isNaN(val)||!isFinite(val)?0:val):"number"==type&&isFinite(val)?Math.floor(val):0},code128:{encoding:["11011001100","11001101100","11001100110","10010011000","10010001100","10001001100","10011001000","10011000100","10001100100","11001001000","11001000100","11000100100","10110011100","10011011100","10011001110","10111001100","10011101100","10011100110","11001110010","11001011100","11001001110","11011100100","11001110100","11101101110","11101001100","11100101100","11100100110","11101100100","11100110100","11100110010","11011011000","11011000110","11000110110","10100011000","10001011000","10001000110","10110001000","10001101000","10001100010","11010001000","11000101000","11000100010","10110111000","10110001110","10001101110","10111011000","10111000110","10001110110","11101110110","11010001110","11000101110","11011101000","11011100010","11011101110","11101011000","11101000110","11100010110","11101101000","11101100010","11100011010","11101111010","11001000010","11110001010","10100110000","10100001100","10010110000","10010000110","10000101100","10000100110","10110010000","10110000100","10011010000","10011000010","10000110100","10000110010","11000010010","11001010000","11110111010","11000010100","10001111010","10100111100","10010111100","10010011110","10111100100","10011110100","10011110010","11110100100","11110010100","11110010010","11011011110","11011110110","11110110110","10101111000","10100011110","10001011110","10111101000","10111100010","11110101000","11110100010","10111011110","10111101110","11101011110","11110101110","11010000100","11010010000","11010011100","11000111010"],getDigit:function(code){var tableB=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",result="",sum=0,isum=0,i=0,j=0,value=0;for(i=0;i<code.length;i++)if(tableB.indexOf(code.charAt(i))==-1)return"";var tableCActivated=code.length>1,c="";for(i=0;i<3&&i<code.length;i++)c=code.charAt(i),tableCActivated&=c>="0"&&c<="9";for(sum=tableCActivated?105:104,result=this.encoding[sum],i=0;i<code.length;){if(tableCActivated)(i==code.length||code.charAt(i)<"0"||code.charAt(i)>"9"||code.charAt(i+1)<"0"||code.charAt(i+1)>"9")&&(tableCActivated=!1,result+=this.encoding[100],sum+=100*++isum);else{for(j=0;i+j<code.length&&code.charAt(i+j)>="0"&&code.charAt(i+j)<="9";)j++;tableCActivated=j>5||i+j-1==code.length&&j>3,tableCActivated&&(result+=this.encoding[99],sum+=99*++isum)}tableCActivated?(value=barcode.intval(code.charAt(i)+code.charAt(i+1)),i+=2):(value=tableB.indexOf(code.charAt(i)),i+=1),result+=this.encoding[value],sum+=++isum*value}return result+=this.encoding[sum%103],result+=this.encoding[106],result+="11"}},bitStringTo2DArray:function(digit){var d=[];d[0]=[];for(var i=0;i<digit.length;i++)d[0][i]=digit.charAt(i);return d},digitToCssRenderer:function($container,settings,digit,hri,mw,mh,type){for(var len,current,x,lines=digit.length,columns=digit[0].length,content="",bar0="<div class='w w%s' ></div>",bar1="<div class='b b%s' ></div>",y=0;y<lines;y++){for(len=0,current=digit[y][0],x=0;x<columns;x++)current==digit[y][x]?len++:(content+=("0"==current?bar0:bar1).replace("%s",len*mw),current=digit[y][x],len=1);len>0&&(content+=("0"==current?bar0:bar1).replace("%s",len*mw))}settings.showHRI&&(content+='<div style="clear:both; width: 100%; background-color: '+settings.bgColor+"; color: "+settings.color+"; text-align: center; font-size: "+settings.fontSize+"px; margin-top: "+settings.marginHRI+'px;">'+hri+"</div>");var div=document.createElement("DIV");return div.innerHTML=content,div.className="barcode "+type+" clearfix-child",div},digitToCss:function($container,settings,digit,hri,type){var w=barcode.intval(settings.barWidth),h=barcode.intval(settings.barHeight);return this.digitToCssRenderer($container,settings,this.bitStringTo2DArray(digit),hri,w,h,type)}},generate=function(datas,type,settings){var digit="",hri="",code="",crc=!0,rect=!1,b2d=!1;if("string"==typeof datas?code=datas:"object"==typeof datas&&(code="string"==typeof datas.code?datas.code:"",crc="undefined"==typeof datas.crc||datas.crc,rect="undefined"!=typeof datas.rect&&datas.rect),""==code)return!1;"undefined"==typeof settings&&(settings=[]);for(var name in barcode.settings)void 0==settings[name]&&(settings[name]=barcode.settings[name]);switch(type){case"std25":case"int25":digit=barcode.i25.getDigit(code,crc,type),hri=barcode.i25.compute(code,crc,type);break;case"ean8":case"ean13":digit=barcode.ean.getDigit(code,type),hri=barcode.ean.compute(code,type);break;case"upc":digit=barcode.upc.getDigit(code),hri=barcode.upc.compute(code);break;case"code11":digit=barcode.code11.getDigit(code),hri=code;break;case"code39":digit=barcode.code39.getDigit(code),hri=code;break;case"code93":digit=barcode.code93.getDigit(code,crc),hri=code;break;case"code128":digit=barcode.code128.getDigit(code),hri=code;break;case"codabar":digit=barcode.codabar.getDigit(code),hri=code;break;case"msi":digit=barcode.msi.getDigit(code,crc),hri=barcode.msi.compute(code,crc);break;case"datamatrix":digit=barcode.datamatrix.getDigit(code,rect),hri=code,b2d=!0}if(0==digit.length)return this;!b2d&&settings.addQuietZone&&(digit="0000000000"+digit+"0000000000");var fname="digitToCss"+(b2d?"2D":"");return barcode[fname](this,settings,digit,hri,type)};return generate}();return{link:function(scope,element,attrs){attrs.$observe("barcodeGenerator",function(value){var code=Barcode(value,"code128",{barWidth:2}),code_wrapper=angular.element("<div class='barcode code128'></div>");code_wrapper.append(code),angular.element(element).html("").append(code_wrapper)})}}}]),function(){"use strict";function agranelCtrl($rootScope,$mdDialog,datos,busqueda,mensajes){0==$rootScope.permisos.PER_salidasAgranel&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Salidas de a granel",scope.info=datos.data,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Movimientos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.onPaginationChange=function(page,limit){},scope.onOrderChange=function(order){},scope.nuevo=function(ev){$mdDialog.show({controller:salidaAgranelCtrl,templateUrl:"views/movimiento.html",parent:angular.element(document.body),targetEvent:ev,resolve:{informacion:function(busqueda,$q){scope.loading=!0;var promesa=$q.defer(),items=busqueda.itemsAgranel(),tiposMovimiento=busqueda.tiposMovimiento(),almacenes=busqueda.almacenesUsuario($rootScope.id),tiposajuste=busqueda.tiposAjuste();return $q.all([items,tiposMovimiento,almacenes,tiposajuste]).then(function(data){promesa.resolve(data),scope.loading=!1}),promesa.promise}},clickOutsideToClose:!1}).then(function(){busqueda.movimientos().success(function(data){scope.info=data})})}}function salidaAgranelCtrl($scope,$rootScope,$mdDialog,informacion,operacion,mensajes,$q,$filter,busqueda){function consultado(query){var q=$q.defer(),response=query?$filter("filter")($scope.items,query):$scope.items;return q.resolve(response),q.promise}function consultaLote(query){var q2=$q.defer(),response2=query?$filter("filter")($scope.lotes,query):$scope.lotes;return q2.resolve(response2),q2.promise}$scope.items=informacion[0].data,$scope.tiposmovimiento=informacion[1].data,$scope.almacenes=informacion[2].data,$scope.tiposajuste=informacion[3].data,$scope.bloqueoMov=!0,console.log($scope.items),$scope.inicio=function(){$scope.existeLote=!1,$scope.busqueda=null,$scope.consultado=consultado,$scope.consultaLote=consultaLote,$scope.item="",$scope.disponible="",$scope.cantidadLote=0,$scope.lote="",$scope.lotes=[],$scope.datos={almacen:"",item:"",cantidad:"",tipomov:3,tipoa:"",orden:"",lote:"",idLote:"",caducidad:"",usuario:$rootScope.id,observaciones:""},$scope.guardando=!1},$scope.selectedItemChange=function(){console.log($scope.datos.almacen),console.log($scope.item),""!=$scope.datos.almacen&&$scope.item&&($scope.datos.lote="",$scope.datos.idLote="",$scope.datos.caducidad="",$scope.verificaExistencia($scope.datos.almacen))},$scope.mensajeError=function(){mensajes.alerta("Ocurrio un error intentalo nuevamente","error","top right","error")},$scope.datosLote=function(lote){if(lote){var dato=JSON.parse(lote);console.log(dato),$scope.datos.idLote=dato.LOT_clave,$scope.datos.lote=dato.LOT_numero,$scope.datos.caducidad=moment(dato.LOT_caducidad).toDate(),$scope.cantidadLote=dato.LOT_cantidad,$scope.existeLote=!0,$scope.verificaCantidadLote()}},$scope.verificaLote=function(){var lote=$scope.datos.lote;""!=lote&&(mensajes.alerta("Verificando Lote","info","top right","search"),busqueda.lote(lote).success(function(data){data?(mensajes.alerta("Lote Existente","success","top right","done"),$scope.datos.idLote=data.LOT_clave,$scope.datos.caducidad=moment(data.LOT_caducidad).toDate(),$scope.existeLote=!0):mensajes.alerta("Lote No Existente Ingresa Caducidad","error","top right","alert")}).error(function(data){$scope.mensajeError()}))},$scope.verificaCantidadLote=function(){$scope.cantidadLote>0&&$scope.cantidadLote<$scope.datos.cantidad&&3==$scope.datos.tipomov?(mensajes.alerta("El lote solo tiene "+$scope.cantidadLote+" disponible(s)","error","top right","error"),$scope.datos.cantidad=0):0==$scope.cantidadLote&&$scope.datos.cantidad>0&&""!=$scope.datos.idLote&&3==$scope.datos.tipomov&&mensajes.alerta("Este lote no tiene cantidad disponible","error","top right","error")},$scope.verificaExistencia=function(almacen){almacen&&(mensajes.alerta("Verificando Datos de Almacen","info","top right","search"),1==$scope.item.TIT_forzoso&&busqueda.lotesAlmacenXitem(almacen,$scope.item.ITE_clave).success(function(data){$scope.lotes=data}),busqueda.itemAlmacen(almacen,$scope.item.ITE_clave).success(function(data){3==$scope.datos.tipomov&&""==data?(mensajes.alerta("No hay Cantdad Disponible En Este Almacen Para Salida","error","top right","error"),$scope.disponible=0):""==data?$scope.disponible=0:$scope.disponible=data.EXI_cantidad}).error(function(data){$scope.mensajeError()}))},$scope.guardar=function(){$scope.movimientoForm.$valid&&$scope.item&&($scope.datos.item=$scope.item.ITE_clave,$scope.guardando=!0,operacion.altaMovimiento($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.movimientoForm.$setPristine(),$scope.inicio()}).error(function(data){$scope.mensajeError(),$scope.guardando=!1}))},$scope.detalleItem=function(item){},$scope.verificaForm=function(){return 1==$scope.datos.tipomov&&""==$scope.datos.tipoa||(3==$scope.datos.tipomov&&$scope.disponible<$scope.datos.cantidad||(3==$scope.datos.tipomov&&1==$scope.item.TIT_forzoso&&""==$scope.datos.idLote||!!$scope.guardando))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("agranelCtrl",agranelCtrl).controller("salidaAgranelCtrl",salidaAgranelCtrl),agranelCtrl.$inject=["$rootScope","$mdDialog","datos","busqueda","mensajes"],salidaAgranelCtrl.$inject=["$scope","$rootScope","$mdDialog","informacion","operacion","mensajes","$q","$filter","busqueda"]}(),function(){"use strict";function ajusteLotesCtrl($rootScope,$scope,busqueda,mensajes,datos,reportes,$mdBottomSheet,$state,$mdDialog,operacion){function creacionLoteCtrl($scope,datos,$mdDialog,operacion){$scope.trabajando=!1,$scope.nuevos=datos,$scope.fechas=operacion.fechas(),$scope.guardaAlta=function(){operacion.altaLote($scope.nuevos).success(function(data){$scope.trabajando=!1,console.log(data),"Registrado"==data.respuesta?(mensajes.alerta("Lote registrado correctamente","success","top right","check_circle"),$rootScope.buscaNuevamente(),$scope.cerrarDialogo()):data.info?(mensajes.alerta(data.info,"warning","top right","warning"),$rootScope.buscaNuevamente(),$scope.cerrarDialogo()):mensajes.alerta("No se hicieron cambios","warning","top right","warning")}).error(function(error){scope.info=[],$scope.trabajando=!1,mensajes.alerta("Ocurrio un error, vuelva a intentarlo","error","top right","error"),console.log(error)})},$scope.nuevaCaducidad=function(){$scope.nuevos.LOT_caducidad=$scope.nuevos.cadAnio+"-"+$scope.nuevos.cadMes,console.log($scope.nuevos.LOT_caducidad)},$scope.cerrarDialogo=function(){$scope.nuevos={},$rootScope.buscaNuevamente(),$mdDialog.hide()}}function revisionLotesCtrl($scope,datos,$mdDialog,operacion){$scope.trabajando=!1,$scope.loteEditor=datos,$scope.loteEditor.LOT_cantidadOriginal=datos.LOT_cantidad,$scope.loteEditor.LOT_caducidad=datos.LOT_caducidad.substr(0,7),$scope.loteEditor.LOT_caducidadOriginal=datos.LOT_caducidad.substr(0,7),$scope.loteEditor.mesNuevo=datos.LOT_caducidad.substr(5,7),$scope.loteEditor.anioNuevo=parseInt(datos.LOT_caducidad.substr(0,4)),$scope.loteEditor.LOT_obsAjuste="",$scope.fechas=operacion.fechas(),$scope.nuevaCaducidad=function(){
$scope.loteEditor.LOT_caducidad=$scope.loteEditor.anioNuevo+"-"+$scope.loteEditor.mesNuevo,console.log($scope.loteEditor.LOT_caducidad)},$scope.guardaCambios=function(){$scope.loteEditor.LOT_cantidad==$scope.loteEditor.LOT_cantidadOriginal&&$scope.loteEditor.LOT_caducidad==$scope.loteEditor.LOT_caducidadOriginal?mensajes.alerta("No hay cambios","warning","top right","warning"):($scope.trabajando=!0,$scope.loteEditor.USU_clave=$rootScope.id,console.log($scope.loteEditor),mensajes.alerta("Procesando cambios","info","top right","info"),operacion.ajusteLote($scope.loteEditor).success(function(data){$scope.trabajando=!1,console.log(data),1==data.respuesta?(mensajes.alerta("Datos procesados correctamente","success","top right","check_circle"),$rootScope.buscaNuevamente(),$scope.cerrarDialogo()):data.info?mensajes.alerta(data.info,"warning","top right","warning"):mensajes.alerta("No se hicieron cambios","warning","top right","warning")}).error(function(error){scope.info=[],$scope.trabajando=!1,mensajes.alerta("Ocurrio un error, vuelva a intentarlo","error","top right","error"),console.log(error)}))},$scope.cerrarDialogo=function(){$scope.loteEditor={},$rootScope.buscaNuevamente(),$mdDialog.hide()}}1==$rootScope.permisos.PER_clave||2==$rootScope.permisos.PER_clave?console.info("Permitido"):(console.error("Prohibido"),$state.go("index.home"));var scope=this;$rootScope.tema="purple",$rootScope.titulo="Ajuste de lotes",scope.unidades=datos[0].data,scope.total=0,scope.limit=10,scope.page=1,scope.busqueda="",scope.texto={text:"Resultados por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.inicio=function(){scope.nuevaBusqueda=!0,scope.consultando=!1,scope.items=datos[1].data,scope.almacenes=[],scope.datos={unidad:"",almacen:"",item:"",tipo:"",permiso:$rootScope.permisos.PER_clave,verCeros:!0,lote:""}},$rootScope.buscaNuevamente=function(){scope.buscar()},scope.agregaUnidad=function(unidad){scope.unidadB=" "+unidad},scope.agregaAlmacen=function(almacen){scope.almacenB=" /"+almacen},scope.agregaItem=function(item){scope.itemB=" /"+item},scope.agregaLote=function(lote){scope.loteB=" / Lote: "+lote.toUpperCase()},scope.cargaAlmacenes=function(unidad){busqueda.almacenesUnidad(unidad).success(function(data){scope.almacenes=data})},scope.cargaItems=function(almacen){busqueda.itemsAlmacen(almacen).success(function(data){scope.items=data})},scope.nombreAlmacen=function(cveAlmacen){for(var i=0;i<scope.almacenes.length;i++)if(scope.almacenes[i].ALM_clave==cveAlmacen)return scope.almacenes[i]},scope.detallesItem=function(cveItem){for(var i=0;i<scope.items.length;i++)if(scope.items[i].ITE_clave==cveItem)return scope.items[i]},scope.buscar=function(){scope.datos.unidad&&scope.datos.almacen&&scope.datos.item?(scope.consultando=!0,scope.unidadB=scope.datos.unidad?scope.unidadB:"",scope.almacenB=scope.datos.almacen?scope.almacenB:"",scope.itemB=scope.datos.item?scope.itemB:"",reportes.lotes(scope.datos).success(function(data){scope.consultando=!1,scope.info=data,data.length>0?scope.nuevaBusqueda=!1:mensajes.alerta("No se encontro información disponible","error","top right","error")}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")})):mensajes.alerta("Es necesario llenar todos los datos","warning","top right","info")},scope.detalleLote=function(lote){lote.LOT_cantidad=parseInt(lote.LOT_cantidad),lote.EXI_cantidad=parseInt(lote.EXI_cantidad),$mdDialog.show({controller:revisionLotesCtrl,templateUrl:"views/detalleLote.html",parent:angular.element(document.body),clickOutsideToClose:!1,escapeToClose:!1,locals:{datos:lote}})},scope.registraLote=function(){var datos={ITE_clave:scope.datos.item,ALM_clave:scope.datos.almacen,EXI_clave:0,EXI_cantidad:0,numLote:"",LOT_cantidad:null,LOT_caducidad:"",cadAnio:"",cadMes:"",observaciones:"",precaucion:!1,modificaExistencias:!1,USU_clave:$rootScope.id,item:scope.detallesItem(scope.datos.item),almacen:scope.nombreAlmacen(scope.datos.almacen),parametros:scope.datos};datos.ITE_nombre=datos.item.ITE_nombre,datos.ALM_nombre=datos.almacen.ALM_nombre,scope.info.length>0&&(datos.EXI_cantidad=scope.info[0].EXI_cantidad,datos.EXI_clave=scope.info[0].EXI_clave),console.log("nuevo"),$mdDialog.show({controller:creacionLoteCtrl,templateUrl:"views/altaLote.html",parent:angular.element(document.body),clickOutsideToClose:!1,escapeToClose:!1,locals:{datos:datos}})},scope.opciones=function(){$mdBottomSheet.show({templateUrl:"views/opcionesReporte.html",controller:"opcionesCtrl",clickOutsideToClose:!0}).then(function(accion){console.log(accion),"Nuevo"==accion.name?scope.inicio():"Editar"==accion.name?scope.nuevaBusqueda=!0:"Exp. Excel"==accion.name?(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportar("lotes",scope.datos)):"Exp. PDF"==accion.name&&(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportarPDF("lotes",scope.datos))})}}angular.module("app").controller("ajusteLotesCtrl",ajusteLotesCtrl),ajusteLotesCtrl.$inject=["$rootScope","$scope","busqueda","mensajes","datos","reportes","$mdBottomSheet","$state","$mdDialog","operacion"]}(),function(){"use strict";function almacenesCtrl($rootScope,$mdDialog,datos,almacenes,mensajes){var scope=this;$rootScope.tema="theme3",$rootScope.titulo="Almacenes Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Almacenes por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:almacenCtrl,templateUrl:"views/almacen.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=almacenes.query()})},scope.edita=function(ev,almacen){$mdDialog.show({controller:almacenEditCtrl,templateUrl:"views/almacen.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:almacen},closeTo:{bottom:1500}}).then(function(){scope.info=almacenes.query()})},scope.confirmacion=function(ev,almacen){var confirm=$mdDialog.confirm().title("¿Desactivar el almacen?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar almacen").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){almacen.ALM_activo?almacen.ALM_activo=0:almacen.ALM_activo=1;var datos={nombre:almacen.ALM_nombre,observaciones:almacen.ALM_observaciones,ubicacion:almacen.ALM_ubicacion,tipo:almacen.TAL_clave,unidad:almacen.UNI_clave,activo:almacen.ALM_activo};almacenes.update({almacen:almacen.ALM_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function almacenCtrl($scope,$mdDialog,busqueda,almacenes,mensajes){busqueda.unidades().then(function(info){$scope.unidades=info.data}),busqueda.tiposAlmacen().then(function(info){$scope.tiposalmacen=info.data}),$scope.inicio=function(){$scope.datos={nombre:"",observaciones:"",ubicacion:"",tipo:"",unidad:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.almacenForm.$valid&&($scope.guardando=!0,almacenes.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.almacenForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function almacenEditCtrl($scope,$mdDialog,almacenes,mensajes,informacion,busqueda){busqueda.unidades().then(function(info){$scope.unidades=info.data}),busqueda.tiposAlmacen().then(function(info){$scope.tiposalmacen=info.data}),$scope.inicio=function(){$scope.datos={nombre:informacion.ALM_nombre,observaciones:informacion.ALM_observaciones,ubicacion:informacion.ALM_ubicacion,tipo:informacion.TAL_clave,unidad:informacion.UNI_clave,activo:!!informacion.ALM_activo},$scope.guardando=!1},$scope.guardar=function(){$scope.almacenForm.$valid&&($scope.guardando=!0,almacenes.update({almacen:informacion.ALM_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.almacenForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("almacenCtrl",almacenCtrl).controller("almacenesCtrl",almacenesCtrl).controller("almacenEditCtrl",almacenEditCtrl),almacenesCtrl.$inject=["$rootScope","$mdDialog","datos","almacenes","mensajes"],almacenCtrl.$inject=["$scope","$mdDialog","busqueda","almacenes","mensajes"],almacenEditCtrl.$inject=["$scope","$mdDialog","almacenes","mensajes","informacion","busqueda"]}(),function(){"use strict";function altaMovimientosCtrl($rootScope,datos,operacion,mensajes,$q,$filter,busqueda){function consultado(query){var q=$q.defer(),response=query?$filter("filter")(scope.items,query):scope.items;return q.resolve(response),q.promise}function consultaLote(query){var q2=$q.defer(),response2=query?$filter("filter")(scope.lotes,query):scope.lotes;return q2.resolve(response2),q2.promise}$rootScope.permisos.PER_clave>2&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home")),$rootScope.cargando=!1,$rootScope.tema="theme1",$rootScope.titulo="Alta de Movimientos",$rootScope.atras=!0,$rootScope.menu="arrow_back";var scope=this;scope.items=datos[0].data,scope.tiposmovimiento=datos[1].data,scope.almacenes=datos[2].data,scope.tiposajuste=datos[3].data,scope.bloqueoMov=!1,scope.agregaMovimiento=function(){for(var i=0;i<scope.tiposmovimiento.length;i++)scope.tiposmovimiento[i].TIM_clave==scope.datos.tipomov&&(""!=scope.datos.observaciones&&(scope.datos.observaciones=scope.tiposmovimiento[i].TIM_nombre+": "+scope.datos.observaciones),""==scope.datos.observaciones&&(scope.datos.observaciones=scope.tiposmovimiento[i].TIM_nombre));console.log(scope.datos),scope.movimientos.push({almacen:scope.datos.almacen.ALM_clave,almacenTexto:scope.datos.almacen.ALM_nombre,item:scope.item.ITE_clave,itemTexto:scope.item.ITE_nombre,cantidad:scope.datos.cantidad,tipomov:scope.datos.tipomov,tipoa:scope.datos.tipoa,orden:scope.datos.orden,lote:scope.datos.lote,idLote:scope.datos.idLote,caducidad:scope.datos.caducidad,usuario:scope.datos.usuario,observaciones:scope.datos.observaciones}),scope.item="",scope.datos.item="",scope.datos.observaciones="",scope.datos.cantidad="",scope.busqueda=null,scope.disponible="",scope.cantidadLote=0,scope.lote="",scope.lotes=[]},scope.inicio=function(){scope.movimientos=[],scope.existeLote=!1,scope.busqueda=null,scope.consultado=consultado,scope.consultaLote=consultaLote,scope.item="",scope.almacen="",scope.disponible="",scope.cantidadLote=0,scope.lote="",scope.lotes=[],scope.datos={almacen:"",item:"",cantidad:"",tipomov:"",tipoa:"",orden:"",lote:"",idLote:"",caducidad:"",usuario:$rootScope.id,observaciones:""},scope.guardando=!1},scope.selectedItemChange=function(){console.log(scope.item),""!=scope.datos.almacen&&scope.item&&(scope.datos.lote="",scope.datos.idLote="",scope.datos.caducidad="",scope.verificaExistencia(JSON.stringify(scope.datos.almacen)))},scope.mensajeError=function(){mensajes.alerta("Ocurrio un error intentalo nuevamente","error","top right","error")},scope.datosLote=function(lote){if(console.log(lote),lote){var dato=JSON.parse(lote);scope.datos.idLote=dato.LOT_clave,scope.datos.lote=dato.LOT_numero,scope.datos.caducidad=moment(dato.LOT_caducidad).toDate(),scope.cantidadLote=dato.LOT_cantidad,scope.existeLote=!0,scope.verificaCantidadLote()}},scope.verificaLote=function(){var lote=scope.datos.lote;console.log(lote),""!=lote&&(mensajes.alerta("Verificando Lote","info","top right","search"),busqueda.lote(lote).success(function(data){data?(mensajes.alerta("Lote Existente","success","top right","done"),scope.datos.idLote=data.LOT_clave,scope.datos.caducidad=moment(data.LOT_caducidad).toDate(),scope.existeLote=!0):mensajes.alerta("Lote No Existente Ingresa Caducidad","error","top right","alert")}).error(function(data){scope.mensajeError()}))},scope.cambio=function(){console.log(scope.datos.caducidad);var d=new Date(scope.datos.caducidad),month=""+(d.getMonth()+1),day=""+d.getDate(),year=d.getFullYear();month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),scope.datos.caducidad=year+"-"+month+"-"+day+" 00:00:00",console.log(scope.datos.caducidad)},scope.verificaCantidadLote=function(){1==scope.item.TIT_forzoso?scope.cantidadLote>0&&scope.cantidadLote<scope.datos.cantidad&&3==scope.datos.tipomov?(mensajes.alerta("El lote solo tiene "+scope.cantidadLote+" disponible(s)","error","top right","error"),scope.datos.cantidad=0):0==scope.cantidadLote&&scope.datos.cantidad>0&&""!=scope.datos.idLote&&3==scope.datos.tipomov&&mensajes.alerta("Este lote no tiene cantidad disponible","error","top right","error"):scope.disponible>0&&scope.disponible<scope.datos.cantidad&&3==scope.datos.tipomov?(mensajes.alerta("Solo se tiene "+scope.disponible+" disponible(s)","error","top right","error"),scope.datos.cantidad=0):0==scope.disponible&&scope.datos.cantidad>0&&""!=scope.datos.idLote&&3==scope.datos.tipomov&&mensajes.alerta("No hay cantidad disponible","error","top right","error")},scope.verificaExistencia=function(objAlmacen){var almacen=JSON.parse(objAlmacen);scope.datos.almacen=almacen,almacen&&(scope.lotes=[],mensajes.alerta("Verificando Datos de Almacen","info","top right","search"),1==scope.item.TIT_forzoso&&busqueda.lotesAlmacenXitem(almacen.ALM_clave,scope.item.ITE_clave).success(function(data){scope.lotes=data}),busqueda.itemAlmacen(almacen.ALM_clave,scope.item.ITE_clave).success(function(data){3==scope.datos.tipomov&&""==data?(mensajes.alerta("No hay Cantdad Disponible En Este Almacen Para Salida","error","top right","error"),scope.disponible=0):""==data?scope.disponible=0:scope.disponible=data.EXI_cantidad}).error(function(data){scope.mensajeError()}))},scope.eliminar=function(index){scope.movimientos.splice(index,1)},scope.guardar=function(){console.log(scope.movimientos),scope.movimientos&&(scope.guardando=!0,operacion.altaMovimientos(scope.movimientos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),scope.guardando=!1,scope.movimientoForm.$setPristine(),scope.inicio()}).error(function(data){scope.mensajeError(),scope.guardando=!1}))},scope.detalleItem=function(item){},scope.verificaForm=function(){return 1==scope.datos.tipomov&&""==scope.datos.tipoa||(3==scope.datos.tipomov&&scope.disponible<scope.datos.cantidad||(3==scope.datos.tipomov&&1==scope.item.TIT_forzoso&&""==scope.datos.idLote||!!scope.guardando))}}angular.module("app").controller("altaMovimientosCtrl",altaMovimientosCtrl),altaMovimientosCtrl.$inject=["$rootScope","datos","operacion","mensajes","$q","$filter","busqueda"]}(),function(){"use strict";function completarCtrl($rootScope,info,$mdDialog,$stateParams,operacion,mensajes){var vm=this;$rootScope.tema="theme1",$rootScope.titulo="Completar Orden",$rootScope.atras=!0,$rootScope.menu="arrow_back",$rootScope.numero=0,vm.items=info.data,angular.forEach(vm.items,function(value,key){vm.items[$rootScope.numero].numerador=$rootScope.numero,$rootScope.numero++}),console.log(vm.items),vm.inicio=function(){vm.lotesCompletos=!1,vm.guardando=!1,vm.datos={orden:$stateParams.ordenId,unidad:info.data[0].UNI_clave,items:vm.items,usuario:$rootScope.id,precioFinal:info.data[0].OCM_importeEsperado},vm.verificaLotes()},vm.ingresaLote=function(item,ev){item.OIT_cantidadSurtida;$mdDialog.show({controller:lotesItemCtrl,templateUrl:"views/lotes.html",parent:angular.element(document.body),targetEvent:ev,locals:{info:item},resolve:{informacion:function(busqueda){return busqueda.lotesUnidadXitem(item.UNI_clave,item.ITE_clave)}},clickOutsideToClose:!1}).then(function(datos){console.log(datos),item.cantidadSurtida=datos.cantidad,item.lotes=datos.lotes,console.log(item.lotes),vm.verificaLotes()})},vm.verificaLotes=function(){console.log("verifica");var items=vm.items.length,actual=1;angular.forEach(vm.items,function(value,key){console.log(value),console.log("actual="+actual+"| |items="+items),void 0!=value.lotes?(console.log(actual+" con lote"),(value.lotes.length>0||0==value.TIT_forzoso)&&actual==items&&(vm.lotesCompletos=!0)):(console.log(actual+" sin lote"),0==value.TIT_forzoso?actual==items&&(vm.lotesCompletos=!0):vm.lotesCompletos=!1),actual++})},vm.guardar=function(){vm.guardando=!0,operacion.completaOrden(vm.datos).success(function(data){vm.guardando=!1,vm.lotesCompletos=!1,mensajes.alerta(data.respuesta,"success","top right","done_all"),$rootScope.ir("index.ordenescompra")}).error(function(data){vm.guardando=!1,mensajes.alerta("Ocurrio un error de conexión intenta nuevamente","error","top right","error")})}}function lotesItemCtrl($scope,$mdDialog,info,operacion,mensajes,informacion){$scope.cantidad=0,$scope.lotes=info.lotes?info.lotes:[],$scope.maximo=Number(info.OIT_cantidadPedida)-Number(info.OIT_cantidadSurtida),$scope.lotes.length>0&&angular.forEach($scope.lotes,function(value,key){$scope.maximo-=value.cantidad}),$scope.datosLote=function(lote){if(lote)if(0==lote)$scope.existeLote=!1,$scope.datos.lote="";else{var dato=JSON.parse(lote);$scope.datos.idLote=dato.LOT_clave,$scope.datos.lote=dato.LOT_numero,$scope.datos.caducidad=moment(dato.LOT_caducidad).toDate(),$scope.cantidadLote=dato.LOT_cantidad,$scope.existeLote=!0}},$scope.inicio=function(){$scope.datos={idLote:"",cantidad:"",lote:"",caducidad:""},informacion.data.length>0?($scope.lotesUnidad=informacion.data,$scope.existeLote=!0):($scope.lotesUnidad=[],$scope.existeLote=!1)},$scope.agrega=function(){$scope.modificaForm.$valid?($scope.maximo-=$scope.datos.cantidad,$scope.cantidad+=$scope.datos.cantidad,$scope.lotes.push($scope.datos),console.log($scope.lotes),$scope.inicio()):mensajes.alerta("Verifica que los datos sean correctos","error","top right","error")},$scope.ingresa=function(){if(0==$scope.maximo){var datos={lotes:$scope.lotes,cantidad:$scope.cantidad};$mdDialog.hide(datos)}else mensajes.alerta("No has ingresado todos los items a lotes","error","top right","error")},$scope.cancel=function(){$mdDialog.cancel()},$scope.cambio=function(){console.log($scope.datos.caducidad);var d=new Date($scope.datos.caducidad),month=""+(d.getMonth()+1),day=""+d.getDate(),year=d.getFullYear();month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),$scope.datos.caducidad=year+"-"+month+"-"+day+" 00:00:00",console.log($scope.datos.caducidad)}}angular.module("app").controller("completarCtrl",completarCtrl).controller("lotesItemCtrl",lotesItemCtrl),completarCtrl.$inject=["$rootScope","info","$mdDialog","$stateParams","operacion","mensajes"],lotesItemCtrl.$inject=["$scope","$mdDialog","info","busqueda","mensajes","informacion"]}(),function(){"use strict";function configuracionCtrl($rootScope,$mdDialog,busqueda,operacion,mensajes,datos){0==$rootScope.permisos.PER_alertas&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.titulo="Configuración",$rootScope.cargando=!1,$rootScope.tema="theme1",scope.guardando=!1,scope.consultando=!1,scope.consultaUnidad=!1,scope.unidades=datos.unidades,scope.items=datos.items,scope.edicion=!0,scope.correos=[],scope.itemSeleccionado="",scope.datos={minimo:0,compra:0,maxima:0,unidad:"",item:""},scope.inicio=function(){scope.datos.compra=0,scope.datos.minimo=0,scope.datos.maxima=0,scope.id="",scope.minimo=0,scope.compra=0,scope.existe=!1},scope.verificaUnidad=function(unidad){unidad&&(scope.unidad=unidad,scope.edicion=!0)},scope.verDetalle=function(item){item&&(scope.inicio(),scope.consultando=!0,scope.datos.item=item.ITE_clave,scope.itemNombre=item.ITE_nombre,busqueda.itemUnidad(item.ITE_clave,scope.unidad).success(function(data){data.length>0&&(scope.datos.compra=Number(data[0].CON_nivelCompra),scope.datos.minimo=Number(data[0].CON_nivelMinimo),scope.datos.maxima=Number(data[0].CON_nivelMaximo),scope.id=data[0].id,scope.existe=!0),scope.minimo=Number(100*scope.datos.minimo/scope.datos.maxima),scope.compra=Number(100*scope.datos.compra/scope.datos.maxima),scope.edicion=!1,scope.consultando=!1}))},scope.valida=function(){return!(scope.datos.compra>0&&scope.datos.minimo>0&&scope.datos.maxima>0)||(scope.datos.minimo>scope.datos.compra||scope.datos.minimo>scope.datos.maximo||scope.datos.compra>scope.datos.maxima)},scope.verificaMinimo=function(minimo){scope.datos.minimo=Number(minimo*scope.datos.maxima/100),$rootScope.$apply()},scope.verificaCompra=function(compra){scope.datos.compra=Number(compra*scope.datos.maxima/100),$rootScope.$apply()},scope.guardar=function(){scope.guardando=!0,operacion.altaConfiguracion(scope.datos).success(function(data){scope.guardando=!1,mensajes.alerta(data.respuesta,"success","top right","done_all"),scope.inicio(),scope.edicion=!0})},scope.actualizar=function(){scope.guardando=!0,operacion.actualizaConfiguracion(scope.id,scope.datos).success(function(data){scope.guardando=!1,mensajes.alerta(data.respuesta,"success","top right","done_all"),scope.inicio(),scope.edicion=!0})}}angular.module("app").controller("configuracionCtrl",configuracionCtrl),configuracionCtrl.$inject=["$rootScope","$mdDialog","busqueda","operacion","mensajes","datos"]}(),function(){"use strict";function existenciasCtrl($rootScope,$mdDialog,datos,busqueda,mensajes){var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Existencias",scope.info=datos.data,scope.total=0,scope.limit=10,scope.page=1,scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.traspasar=function(ev,almacen,item){var datos={almacen:almacen,item:item};$mdDialog.show({controller:traspasoCtrl,templateUrl:"views/traspaso.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1,locals:{informacion:datos}}).then(function(){busqueda.existencias($rootScope.id).success(function(data){scope.info=data})})}}angular.module("app").controller("existenciasCtrl",existenciasCtrl),existenciasCtrl.$inject=["$rootScope","$mdDialog","datos","busqueda","mensajes"]}(),function(){"use strict";function homeCtrl($rootScope,$scope,datos,$state,mensajes,busqueda){setTimeout(function(){console.log($state.is("index.home")),$state.is("index.home")&&($state.reload(),console.log("Datos actualizados"),mensajes.alerta("Actualizando datos","info","bottom right","refresh"))},6e5),$scope.datos=datos.data,$scope.informacion={caducados:!1,apartados:!1},$scope.cargador=!1,$scope.datos.porCaducar>50&&setTimeout(function(){mensajes.alerta("¡Más de 50 items están por caducar!","error","top right","warning")},3e3),$scope.datos.porSurtir>15&&mensajes.alerta("Más de 15 items están reservados para receta","info","top right","info"),$rootScope.tema="theme1",$rootScope.titulo="Bienvenido",$scope.irItems=function(){$state.go("index.reporteItems")},$scope.irOrdenes=function(){$state.go("index.ordenescompra")},$scope.irPorCaducar=function(){$state.go("index.porCaducar")},$scope.irPorSurtir=function(){$state.go("index.porSurtir")},$scope.irOrdAbiertas=function(){$state.go("index.ordenesAbiertas")}}angular.module("app").controller("homeCtrl",homeCtrl),homeCtrl.$inject=["$rootScope","$scope","datos","$state","mensajes","busqueda"]}(),function(){"use strict";function importarCtrl($rootScope,$mdDialog,archivos,busqueda,mensajes){0==$rootScope.permisos.PER_perfiles&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.tema="theme2",$rootScope.titulo="Importación de Datos",scope.cargando=!1,scope.subir=function(file,$event){"application/vnd.ms-excel"==file.type?(scope.cargando=!0,archivos.subeArchivo(file).then(function(data){mensajes.alerta("Datos Importados Correctamente","success","top right","done_all"),scope.cargando=!1},function(error){mensajes.alerta("Ocurrio un error vuelve a intentarlo","error","top right","error"),scope.cargando=!1},function(progreso){})):mensajes.alerta("Este formato no esta permitido","error","top right","error")}}angular.module("app").controller("importarCtrl",importarCtrl),importarCtrl.$inject=["$rootScope","$mdDialog","archivos","busqueda","mensajes"]}(),function(){"use strict";function itemproCtrl($rootScope,$mdDialog,datos,busqueda,operacion){var scope=this;$rootScope.titulo="Registro de Costos por item",$rootScope.cargando=!1,$rootScope.atras=!0,$rootScope.menu="arrow_back",$rootScope.tema="theme1",scope.items=datos.data,scope.inicio=function(){scope.loading=!1,scope.total=0,scope.limit=10,scope.page=1},scope.nuevo=function(ev){$mdDialog.show({controller:nuevoItemproCtrl,templateUrl:"views/altaitempro.html",parent:angular.element(document.body),targetEvent:ev,resolve:{informacion:function(busqueda,$q){scope.loading=!0;var promesa=$q.defer(),items=busqueda.items(),proveedores=busqueda.proveedores();return $q.all([items,proveedores]).then(function(data){console.log(data),promesa.resolve(data),scope.loading=!1}),promesa.promise}},clickOutsideToClose:!1}).then(function(){busqueda.itemsProveedor().success(function(data){scope.items=data})})},scope.edita=function(ev,item){$mdDialog.show({controller:editaItemproCtrl,templateUrl:"views/altaitempro.html",parent:angular.element(document.body),targetEvent:ev,locals:{datos:item},resolve:{informacion:function(busqueda,$q){scope.loading=!0;var promesa=$q.defer(),items=busqueda.items(),proveedores=busqueda.proveedores();return $q.all([items,proveedores]).then(function(data){console.log(data),promesa.resolve(data),scope.loading=!1}),promesa.promise}},clickOutsideToClose:!1}).then(function(){busqueda.itemsProveedor().success(function(data){scope.items=data})})},scope.elimina=function(ev,item){console.log(item);var confirm=$mdDialog.confirm().title("¿Seguro que deseas eliminar esta conexión?").content("").ariaLabel("Quitar Conexión").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){operacion.eliminaItempro(item).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")}).error(function(error){mensajes.alerta("Ocurrio un error intentalo nuevamente","error","top right","error")})})}}function nuevoItemproCtrl($scope,$mdDialog,informacion,mensajes,$q,$filter,operacion,$rootScope){function consultado(query){var q=$q.defer(),response=query?$filter("filter")($scope.items,query):$scope.items;return q.resolve(response),q.promise}$scope.items=informacion[0].data,$scope.proveedores=informacion[1].data,$scope.inicio=function(){$scope.seleccionado=null,$scope.busqueda=null,$scope.consultado=consultado,$scope.datos={usuarioasigno:$rootScope.id,item:"",proveedor:"",cantidad:""},$scope.edicion=!1,$scope.guardando=!1},$scope.guardar=function(){console.log($scope.datos),$scope.guardando=!0,operacion.altaItempro($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.inicio()}).error(function(error){mensajes.alerta("Ocurrio un error intentalo nuevamente","error","top right","error")})},$scope.cancel=function(){$mdDialog.hide()}}function editaItemproCtrl($scope,$mdDialog,informacion,mensajes,$q,$filter,operacion,$rootScope,datos){function consultado(query){var q=$q.defer(),response=query?$filter("filter")($scope.items,query):$scope.items;return q.resolve(response),q.promise}console.log(datos),$scope.items=informacion[0].data,$scope.proveedores=informacion[1].data,$scope.inicio=function(){$scope.seleccionado=null,$scope.busqueda=null,$scope.consultado=consultado,$scope.datos={usuarioasigno:$rootScope.id,item:datos.ITE_nombre,itemId:datos.ITE_clave,proveedor:datos.PRO_clave,cantidad:datos.IPR_ultimoCosto,fecha:datos.IPR_ultimaFecha},$scope.edicion=!0,$scope.guardando=!1},$scope.guardar=function(){$scope.guardando=!0,operacion.actualizaItempro($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1}).error(function(error){mensajes.alerta("Ocurrio un error intentalo nuevamente","error","top right","error")})},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("itemproCtrl",itemproCtrl).controller("nuevoItemproCtrl",nuevoItemproCtrl).controller("editaItemproCtrl",editaItemproCtrl),itemproCtrl.$inject=["$rootScope","$mdDialog","datos","busqueda","operacion"],nuevoItemproCtrl.$inject=["$scope","$mdDialog","informacion","mensajes","$q","$filter","operacion","$rootScope"],editaItemproCtrl.$inject=["$scope","$mdDialog","informacion","mensajes","$q","$filter","operacion","$rootScope","datos"]}(),function(){"use strict";function itemsCtrl($rootScope,$mdDialog,datos,items,mensajes,webStorage){var scope=this;$rootScope.tema="theme3",$rootScope.titulo="Items Registrados",scope.info=datos,scope.total=0,scope.order=void 0==webStorage.session.get("ordenItems")?"":webStorage.session.get("ordenItems"),scope.page=void 0==webStorage.session.get("paginaItems")?1:webStorage.session.get("paginaItems"),scope.limit=void 0==webStorage.session.get("limiteItems")?10:webStorage.session.get("limiteItems"),scope.query=void 0==webStorage.session.get("queryItems")?"":webStorage.session.get("queryItems"),scope.onPaginationChange=function(page,limit){webStorage.session.add("paginaItems",page),webStorage.session.add("limiteItems",limit)},scope.onOrderChange=function(order){webStorage.session.add("ordenItems",order)},scope.guardaBusqueda=function(){webStorage.session.add("queryItems",scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:itemCtrl,templateUrl:"views/item.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=items.query()})},scope.edita=function(ev,item){$mdDialog.show({controller:itemEditCtrl,templateUrl:"views/item.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario}}).then(function(){scope.info=items.query()})},scope.confirmacion=function(ev,item){console.log(scope.total),console.log(scope.limit),console.log(scope.page),console.log(scope.query);var confirm=$mdDialog.confirm().title("¿Desactivar el item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar item").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){item.ITE_activo?item.ITE_activo=0:item.ITE_activo=1;var datos={nombre:item.ITE_nombre,precio:item.ITE_precioventa,cantidad:item.ITE_cantidadtotal,tipo:item.TIT_clave,subtipo:item.STI_clave,activo:item.ITE_activo};items.remove({item:item.ITE_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function itemCtrl($mdDialog,busqueda,items,mensajes,$rootScope,datos,archivos,$mdConstant){var scope=this;$rootScope.titulo="Nuevo Item",scope.tipoitems=datos[0].data,scope.subtipoitems=datos[1].data,scope.presentaciones=datos[2].data,scope.unidades=datos[3].data,scope.keys=[$mdConstant.KEY_CODE.ENTER,$mdConstant.KEY_CODE.COMMA],$rootScope.atras=!0,$rootScope.menu="arrow_back",scope.inicio=function(){scope.sustancias=[],scope.imagenes=[],scope.guardando=!1,scope.datos={nombre:"",precio:"",cantidad:"",codigo:"",codigoean:"",tipo:"",subtipo:"",presentacion:"",clasificacion:"",sustancia:scope.sustancias,posologia:"",presentacionDesc:"",agranel:!1,segmentado:!1,segmentadoReceta:!1,receta:!1,talla:!1,unidad:"",cantidadCaja:"",activo:!0}},scope.guardar=function(){scope.guardando=!0,items.save(scope.datos,function(data){var respuesta=data.respuesta;archivos.items(scope.imagenes,data.clave).then(function(data){console.log("Imagenes: "+data),mensajes.alerta(respuesta,"success","top right","done_all"),scope.guardando=!1,scope.itemForm.$setPristine(),scope.inicio()},function(data){mensajes.alerta("Ocurrio un error al subir las imagenes intentelo nuevamente editando el proveedor","error","top right","done_all"),scope.guardando=!1,scope.itemForm.$setPristine(),scope.inicio()},function(data){console.log("Estatus: "+data)})},function(error){500==error.status?mensajes.alerta("El Codigo de Item ya existe","error","top right","error"):mensajes.alerta("Ocurrio un error con su conexion a internet","error","top right","error"),
scope.guardando=!1})},scope.verificador=function(){return(!scope.itemForm.$valid||1==scope.datos.tipo)&&(!scope.itemForm.$valid||1!=scope.datos.tipo||(!scope.sustancias||!scope.datos.posologia))},scope.upload=function(files,file,event){if(files&&files.length)for(var i=0;i<files.length;i++)scope.imagenes.push(files[i])},scope.eliminaImagen=function(index){scope.imagenes.splice(index,1)},scope.cancel=function(){$mdDialog.hide()}}function itemEditCtrl($mdDialog,busqueda,items,mensajes,$rootScope,datos,archivos,$mdConstant){$rootScope.titulo="Detalle de Item",$rootScope.atras=!0,$rootScope.menu="arrow_back";var scope=this;scope.tipoitems=datos[0].data,scope.subtipoitems=datos[1].data,scope.presentaciones=datos[2].data,scope.unidades=datos[4].data,scope.keys=[$mdConstant.KEY_CODE.ENTER,$mdConstant.KEY_CODE.COMMA],scope.sustancias=datos[3].datos.ITE_sustancia?datos[3].datos.ITE_sustancia.split(","):[],scope.clave=datos[3].datos.ITE_clave,scope.datos={nombre:datos[3].datos.ITE_nombre,codigo:datos[3].datos.ITE_codigo,precio:datos[3].datos.ITE_precioventa,cantidad:datos[3].datos.ITE_cantidadtotal,presentacionDesc:datos[3].datos.ITE_presentacion,codigoean:datos[3].datos.ITE_codigoean,tipo:datos[3].datos.TIT_clave,subtipo:datos[3].datos.STI_clave,sustancia:scope.sustancias,posologia:datos[3].datos.ITE_posologia,presentacion:datos[3].datos.PRE_clave,agranel:!!Number(datos[3].datos.ITE_agranel),segmentado:!!Number(datos[3].datos.ITE_segmentable),segmentadoReceta:!!Number(datos[3].datos.ITE_noSegmentableReceta),talla:!!Number(datos[3].datos.ITE_talla),receta:!!Number(datos[3].datos.ITE_receta),unidad:datos[3].datos.UTI_clave,cantidadCaja:Number(datos[3].datos.ITE_cantidadCaja),activo:!!Number(datos[3].datos.ITE_activo)},scope.imagenesguardadas=datos[3].archivos?datos[3].archivos:[],scope.inicio=function(){scope.imagenes=[],scope.guardando=!1},scope.verificador=function(){return(!scope.itemForm.$valid||1==scope.datos.tipo)&&(!scope.itemForm.$valid||1!=scope.datos.tipo||(!scope.sustancias||!scope.datos.posologia))},scope.upload=function(files,file,event){if(files&&files.length)for(var i=0;i<files.length;i++)scope.imagenes.push(files[i])},scope.eliminaImagen=function(index){scope.imagenes.splice(index,1)},scope.eliminaImagenGuardada=function(index){mensajes.alerta("Eliminando imagen","","top right","");var imagen=scope.imagenesguardadas[index];console.log(imagen),archivos.eliminaItem(imagen,scope.clave).success(function(data){scope.imagenesguardadas.splice(index,1)})},scope.guardar=function(){scope.itemForm.$valid&&(scope.guardando=!0,items.update({item:scope.clave},scope.datos,function(data){var respuesta=data.respuesta;archivos.items(scope.imagenes,scope.clave).then(function(data){console.log("Imagenes: "+data),mensajes.alerta(respuesta,"success","top right","done_all"),scope.guardando=!1,scope.itemForm.$setPristine(),scope.inicio()},function(data){mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","done_all")},function(data){console.log("Estatus: "+data)})}))}}angular.module("app").controller("itemCtrl",itemCtrl).controller("itemsCtrl",itemsCtrl).controller("itemEditCtrl",itemEditCtrl),itemsCtrl.$inject=["$rootScope","$mdDialog","datos","items","mensajes","webStorage"],itemCtrl.$inject=["$mdDialog","busqueda","items","mensajes","$rootScope","datos","archivos","$mdConstant"],itemEditCtrl.$inject=["$mdDialog","busqueda","items","mensajes","$rootScope","datos","archivos","$mdConstant"]}(),function(){"use strict";function loginCtrl(auth,$rootScope){var sesion=this;$rootScope.cargando=!1,$rootScope.tema="theme1",sesion.inicio=function(){sesion.datos={usuario:"",psw:"",guardar:!1}},sesion.login=function(){sesion.loginForm.$valid&&($rootScope.cargando=!0,auth.login(sesion.datos))}}angular.module("app").controller("loginCtrl",loginCtrl),loginCtrl.$inject=["auth","$rootScope"]}(),function(){"use strict";function loteRecetaCtrl($scope,$mdDialog,info,mensajes,busqueda){console.log(info),$scope.lotes=info.lotes?info.lotes:[],$scope.maximo=info.caja>0?Number(info.caja)*Number(info.cantidad):info.cantidad,$scope.lotes.length>0&&angular.forEach($scope.lotes,function(value,key){$scope.maximo-=value.cantidad}),$scope.inicio=function(){$scope.datos={cantidad:"",idLote:"",lote:"",caducidad:""}},$scope.verificaLote=function(){var lote=$scope.datos.lote;""!=lote&&(mensajes.alerta("Verificando Lote","info","top right","search"),busqueda.lote(lote).success(function(data){data?(mensajes.alerta("Lote Existente","success","top right","done"),$scope.datos.idLote=data.LOT_clave,$scope.datos.caducidad=moment(data.LOT_caducidad).toDate()):($scope.datos.caducidad="",mensajes.alerta("Lote No Existente Verificalo nuevamente","error","top right","alert"))}).error(function(data){$scope.mensajeError()}))},$scope.agrega=function(){$scope.modificaForm.$valid&&($scope.maximo-=$scope.datos.cantidad,$scope.lotes.push($scope.datos),$scope.inicio())},$scope.ingresa=function(){0==$scope.maximo?$mdDialog.hide($scope.lotes):mensajes.alerta("No has ingresado todos los items a lotes","error","top right","error")},$scope.cancel=function(){$mdDialog.cancel()}}angular.module("app").controller("loteRecetaCtrl",loteRecetaCtrl),loteRecetaCtrl.$inject=["$scope","$mdDialog","info","mensajes","busqueda"]}(),function(){"use strict";function movimientosCtrl($rootScope,$mdDialog,datos,busqueda,mensajes,reportes){0==$rootScope.permisos.PER_movimientos&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Movimientos Registrados",scope.unidades=datos[0].data,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Movimientos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.inicio=function(){scope.consultando=!1,scope.items=datos[1].data,scope.tiposItem=datos[2].data,scope.almacenes=[],scope.datos={unidad:"",almacen:"",item:"",tipo:""}},scope.buscar=function(){scope.datos.unidad?(scope.consultando=!0,reportes.movimientos(scope.datos).success(function(data){scope.consultando=!1,scope.info=data,data.length>0?scope.nuevaBusqueda=!1:mensajes.alerta("No se encontro información disponible","error","top right","error")}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")})):mensajes.alerta("debes ingresar unidad y tipo","error","top right","error")},scope.onPaginationChange=function(page,limit){},scope.onOrderChange=function(order){},scope.cargaAlmacenes=function(unidad){busqueda.almacenesUnidad(unidad).success(function(data){console.log(data),scope.almacenes=data})},scope.cargaItems=function(almacen){busqueda.itemsAlmacen(almacen).success(function(data){scope.items=data})},scope.nuevo=function(ev){$mdDialog.show({controller:movimientoCtrl,templateUrl:"views/movimiento.html",parent:angular.element(document.body),targetEvent:ev,resolve:{informacion:function(busqueda,$q){scope.loading=!0;var promesa=$q.defer(),items=busqueda.items(),tiposMovimiento=busqueda.tiposMovimiento(),almacenes=busqueda.almacenesUsuario($rootScope.id),tiposajuste=busqueda.tiposAjuste();return $q.all([items,tiposMovimiento,almacenes,tiposajuste]).then(function(data){promesa.resolve(data),scope.loading=!1}),promesa.promise}},clickOutsideToClose:!1}).then(function(){busqueda.movimientos().success(function(data){scope.info=data})})}}function movimientoCtrl($scope,$rootScope,$mdDialog,informacion,operacion,mensajes,$q,$filter,busqueda){function consultado(query){var q=$q.defer(),response=query?$filter("filter")($scope.items,query):$scope.items;return q.resolve(response),q.promise}function consultaLote(query){var q2=$q.defer(),response2=query?$filter("filter")($scope.lotes,query):$scope.lotes;return q2.resolve(response2),q2.promise}$scope.items=informacion[0].data,$scope.tiposmovimiento=informacion[1].data,$scope.almacenes=informacion[2].data,$scope.tiposajuste=informacion[3].data,$scope.bloqueoMov=!1,$rootScope.atras=!0,$rootScope.menu="arrow_back",$scope.inicio=function(){$scope.existeLote=!1,$scope.busqueda=null,$scope.consultado=consultado,$scope.consultaLote=consultaLote,$scope.item="",$scope.disponible="",$scope.cantidadLote=0,$scope.lote="",$scope.lotes=[],$scope.datos={almacen:"",item:"",cantidad:"",tipomov:"",tipoa:"",orden:"",lote:"",idLote:"",caducidad:"",usuario:$rootScope.id,observaciones:"",exiActual:0},$scope.guardando=!1},$scope.selectedItemChange=function(){console.log($scope.datos.almacen),console.log($scope.item),""!=$scope.datos.almacen&&$scope.item&&($scope.datos.lote="",$scope.datos.idLote="",$scope.datos.caducidad="",$scope.verificaExistencia($scope.datos.almacen))},$scope.mensajeError=function(){mensajes.alerta("Ocurrio un error intentalo nuevamente","error","top right","error")},$scope.datosLote=function(lote){if(lote){var dato=JSON.parse(lote);$scope.datos.idLote=dato.LOT_clave,$scope.datos.lote=dato.LOT_numero,$scope.datos.caducidad=moment(dato.LOT_caducidad).toDate(),$scope.cantidadLote=dato.LOT_cantidad,$scope.existeLote=!0,$scope.verificaCantidadLote()}},$scope.verificaLote=function(){var lote=$scope.datos.lote;""!=lote&&(mensajes.alerta("Verificando Lote","info","top right","search"),busqueda.lote(lote).success(function(data){data?(mensajes.alerta("Lote Existente","success","top right","done"),$scope.datos.idLote=data.LOT_clave,$scope.datos.caducidad=moment(data.LOT_caducidad).toDate(),$scope.existeLote=!0):mensajes.alerta("Lote No Existente Ingresa Caducidad","error","top right","alert")}).error(function(data){$scope.mensajeError()}))},$scope.verificaCantidadLote=function(){1==$scope.item.TIT_forzoso?$scope.cantidadLote>0&&$scope.cantidadLote<$scope.datos.cantidad&&3==$scope.datos.tipomov?(mensajes.alerta("El lote solo tiene "+$scope.cantidadLote+" disponible(s)","error","top right","error"),$scope.datos.cantidad=0):0==$scope.cantidadLote&&$scope.datos.cantidad>0&&""!=$scope.datos.idLote&&3==$scope.datos.tipomov&&mensajes.alerta("Este lote no tiene cantidad disponible","error","top right","error"):$scope.disponible>0&&$scope.disponible<$scope.datos.cantidad&&3==$scope.datos.tipomov?(mensajes.alerta("Solo se tiene "+$scope.disponible+" disponible(s)","error","top right","error"),$scope.datos.cantidad=0):0==$scope.disponible&&$scope.datos.cantidad>0&&""!=$scope.datos.idLote&&3==$scope.datos.tipomov&&mensajes.alerta("No hay cantidad disponible","error","top right","error")},$scope.verificaExistencia=function(almacen){almacen&&($scope.lotes=[],mensajes.alerta("Verificando Datos de Almacen","info","top right","search"),1==$scope.item.TIT_forzoso&&busqueda.lotesAlmacenXitem(almacen,$scope.item.ITE_clave).success(function(data){$scope.lotes=data}),busqueda.itemAlmacen(almacen,$scope.item.ITE_clave).success(function(data){3==$scope.datos.tipomov&&""==data?(mensajes.alerta("No hay Cantdad Disponible En Este Almacen Para Salida","error","top right","error"),$scope.disponible=0):""==data?$scope.disponible=0:$scope.disponible=data.EXI_cantidad}).error(function(data){$scope.mensajeError()}))},$scope.guardar=function(){$scope.movimientoForm.$valid&&$scope.item&&($scope.datos.item=$scope.item.ITE_clave,$scope.guardando=!0,operacion.altaMovimiento($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.movimientoForm.$setPristine(),$scope.inicio()}).error(function(data){$scope.mensajeError(),$scope.guardando=!1}))},$scope.detalleItem=function(item){},$scope.verificaForm=function(){return 1==$scope.datos.tipomov&&""==$scope.datos.tipoa||(3==$scope.datos.tipomov&&$scope.disponible<$scope.datos.cantidad||(3==$scope.datos.tipomov&&1==$scope.item.TIT_forzoso&&""==$scope.datos.idLote||!!$scope.guardando))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("movimientoCtrl",movimientoCtrl).controller("movimientosCtrl",movimientosCtrl),movimientosCtrl.$inject=["$rootScope","$mdDialog","datos","busqueda","mensajes","reportes"],movimientoCtrl.$inject=["$scope","$rootScope","$mdDialog","informacion","operacion","mensajes","$q","$filter","busqueda"]}(),function(){"use strict";function opcionesCtrl($scope,$mdBottomSheet){$scope.items=[{name:"Exp. Excel",icon:"file_download"},{name:"Exp. PDF",icon:"picture_as_pdf"},{name:"Editar",icon:"mode_edit"},{name:"Nuevo",icon:"insert_drive_file"}],$scope.listItemClick=function($index){var clickedItem=$scope.items[$index];$mdBottomSheet.hide(clickedItem)}}angular.module("app").controller("opcionesCtrl",opcionesCtrl),opcionesCtrl.$inject=["$scope","$mdBottomSheet"]}(),function(){"use strict";function ordenesCompraCtrl($rootScope,$mdDialog,datos,busqueda,mensajes,$window,api,operacion){0==$rootScope.permisos.PER_surtirOrden&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.tema="theme1",$rootScope.titulo="Ordenes Registrados",scope.info=datos.data,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Movimientos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.onPaginationChange=function(page,limit){},scope.onOrderChange=function(order){},scope.nuevo=function(ev){$mdDialog.show({controller:ordenCompraCtrl,templateUrl:"views/ordencompra.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){busqueda.ordenescompra().success(function(data){scope.info=data})})},scope.completar=function(ev,orden){$mdDialog.show({controller:completaCtrl,templateUrl:"views/movimientoorden.html",parent:angular.element(document.body),targetEvent:ev,resolve:{informacion:function(operacion,$q){var promesa=$q.defer(),items=operacion.verificaFaltantes(orden.OCM_clave);return $q.when(items).then(function(data){console.log(data);var datos={items:data.data,orden:orden};console.log(datos),promesa.resolve(datos)}),promesa.promise}},clickOutsideToClose:!0}).then(function(){busqueda.ordenescompra().success(function(data){scope.info=data})})},scope.cerrar=function(ev,orden){var confirm=$mdDialog.confirm().title("¿Desactivar cerrar la orden?").content("").ariaLabel("Cerrar orden").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){var info={usuario:$rootScope.id,orden:orden.OCM_clave};operacion.cerrarOrden(info).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),orden.OCM_incompleta=0,orden.OCM_cerrada=1})})},scope.cancelar=function(ev,orden){var confirm=$mdDialog.prompt().title("¿Deseas Cancelar la orden?").content("").placeholder("Motivo de cancelación").ariaLabel("Motivo de cancelación").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(motivo){var info={usuario:$rootScope.id,orden:orden.OCM_clave,motivo:motivo};operacion.cancelarOrden(info).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),orden.OCM_cancelada=1})})},scope.correo=function(orden,ev){var datos={data:orden};$mdDialog.show({controller:correoCtrl,templateUrl:"views/correo.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,locals:{info:datos}}).then(function(){})}}function ordenCompraCtrl($scope,$rootScope,operacion,mensajes,datos,pdf,$mdDialog){$scope.paso1="views/ordenPaso1.html",$scope.paso2="views/ordenPaso2.html",$scope.paso3="views/ordenPaso3.html",$scope.paso4="views/ordenPaso4.html",$rootScope.atras=!0,$rootScope.menu="arrow_back",$rootScope.tema="theme1",$rootScope.titulo="Nueva Orden",$scope.unidades=datos.data,$scope.consultaUnidad=!1,$scope.prepara2=!1,$scope.generandoTodas=!1,$scope.inicio=function(){$scope.step1block=!1,$scope.step2block=!0,$scope.step3block=!0,$scope.step4block=!0,$scope.todos=!0,$scope.selectedIndex=0,$scope.unidad="",$scope.respuestasCorreos=[],$scope.seleccionItems=[],$scope.seleccionOrden=[],$scope.ordenItems=[],$scope.totalItems=[],$scope.proveedores=[],$scope.selected=[],$scope.items=[],$scope.ordenesListas=[],$scope.ordenes=[],$scope.verTodo=!0},$scope.info=function(unidad){unidad&&($scope.selected=[],$scope.items=[],$scope.almacenes="",$scope.unidad=unidad.UNI_clave,$scope.nombreUnidad=unidad.UNI_nombre,$scope.consultaUnidad=!0,operacion.infoUnidad(unidad.UNI_clave).then(function(data){data[1].data.length>0?($scope.almacenes=data[0].data,$scope.items=data[1].data,angular.forEach(data[0].data,function(value,key){$scope.selected.push(value)})):mensajes.alerta("No hay items en este almacen","info","top right","info"),$scope.consultaUnidad=!1},function(error){mensajes.alerta(error,"error","top right","error"),$scope.consultaUnidad=!1}))},$scope.muestraItems=function(datos){console.log(datos),$scope.consultaUnidad=!0,operacion.itemsAlmacenes($scope.unidad,datos).success(function(data){$scope.items=data,$scope.consultaUnidad=!1})},$scope.toggle=function(almacen,selected){var idx=selected.indexOf(almacen);console.log(idx),idx>-1?selected.splice(idx,1):selected.push(almacen),$scope.muestraItems(selected)},$scope.exists=function(almacen,selected){return selected.indexOf(almacen)>-1},$scope.ir2=function(selecciones){$scope.prepara2=!0,operacion.preparaOrden(selecciones).then(function(data){data.proveedores.length>0?($scope.ordenItems=data.datos,$scope.totalItems=data.info,$scope.proveedores=data.proveedores,$scope.selectedIndex=1,$scope.step2block=!1):mensajes.alerta("No hay proveedores disponibles para surtir este item agregalos desde conexión","error","top right","error"),$scope.prepara2=!1})},$scope.cambio=function(item,list){var id2x=list.indexOf(item);id2x>-1?list.splice(id2x,1):list.push(item)},$scope.existeEnOrden=function(item,list){return list.indexOf(item)>-1},$scope.segmentable=function(item){var item=Number(item[0].ITE_segmentable);return 1==item},$scope.caja=function(item){return item[0].ITE_cantidadCaja},$scope.cantidad=function(item){for(var i=0;i<$scope.ordenItems.length;i++){var itx=$scope.ordenItems[i];if(itx.ITE_nombre==item){if(1==itx.ITE_segmentable){var cantidad=Number(itx.porsurtir)/Number(itx.ITE_cantidadCaja);return cantidad.toFixed()}return Number(itx.porsurtir)}}},$scope.compra=function(item){for(var i=0;i<$scope.ordenItems.length;i++){var itx=$scope.ordenItems[i];if(itx.ITE_nombre==item)return itx.nivelcompra}},$scope.existencia=function(item){for(var i=0;i<$scope.ordenItems.length;i++){var itx=$scope.ordenItems[i];if(itx.ITE_nombre==item)return itx.existencia}},$scope.costoTotal=function(item){return 1==item.ITE_segmentable?item.cantidad*item.ITE_cantidadCaja*item.IPR_ultimoCosto:item.cantidad*item.IPR_ultimoCosto},$scope.itemProporcional=function(item){operacion.proporcionalXitem(item,$scope.ordenItems)},$scope.itemEconomico=function(item){operacion.economicoXitem(item,$scope.ordenItems)},$scope.verificaCantidad=function(item,proveedor){operacion.cambioXproveedor(proveedor,item,$scope.ordenItems)},$scope.generaOrden=function(){$scope.selectedIndex=2,$scope.todos=!0,$scope.step3block=!1,operacion.verificaItems($scope.ordenItems).then(function(data){$scope.seleccionOrden=data})},$scope.generaCantidades=function(){operacion.generaCantidades($scope.totalItems).then(function(data){$scope.ordenItems=data})},$scope.generaMasBarato=function(){operacion.generaMasBarato($scope.totalItems).then(function(data){$scope.ordenItems=data})},$scope.muestraTotal=function(proveedor){for(var total=0,i=0;i<$scope.seleccionOrden.length;i++){var item=$scope.seleccionOrden[i];if(1==item.ITE_segmentable)var cantidad=item.cantidad*item.ITE_cantidadCaja*item.IPR_ultimoCosto;else var cantidad=item.cantidad*item.IPR_ultimoCosto;item.PRO_nombrecorto==proveedor&&(total+=cantidad)}return total},$scope.total=function(){for(var TotalGeneral=0,i=0;i<$scope.seleccionOrden.length;i++){var item=$scope.seleccionOrden[i];if(1==item.ITE_segmentable)var cantidad=item.cantidad*item.ITE_cantidadCaja*item.IPR_ultimoCosto;else var cantidad=item.cantidad*item.IPR_ultimoCosto;TotalGeneral+=cantidad}return TotalGeneral},$scope.confirmaOrden=function(){$scope.generandoTodas=!0,console.log($scope.seleccionOrden),operacion.generaOrdenes($scope.seleccionOrden,$scope.proveedores,$scope.unidad,$scope.almacenes).then(function(data){angular.forEach(data.ordenes,function(value,key){pdf.enviaOrden(value).success(function(data){$scope.respuestasCorreos.push(data.respuesta)}).error(function(error){$scope.respuestasCorreos.push(error.respuesta)})}),$scope.ordenes=data.ordenes,$scope.selectedIndex=3,$scope.step1block=!0,$scope.step2block=!0,$scope.step3block=!0,$scope.step4block=!1,$scope.generandoTodas=!1},function(error){alert(error),$scope.generandoTodas=!1})},$scope.confirmaOrdenProveedor=function(proveedor){$scope.todos=!1,operacion.ordenXproveedor(proveedor,$scope.unidad,$scope.almacenes,$scope.seleccionOrden).then(function(data){mensajes.alerta("Orden generada satisfactoriamente","success","top right","done_all");var idOrden=data.ordenes[0];$scope.ordenes.push(idOrden),pdf.enviaOrden(idOrden).success(function(data){console.log(idOrden),console.log(data),$scope.respuestasCorreos.push(data.respuesta)}).error(function(error){console.log(error),$scope.respuestasCorreos.push(error.respuesta)}),$scope.step2block=!0,$scope.step4block=!1,0==$scope.seleccionOrden.length&&($scope.step1block=!0,$scope.step3block=!0,$scope.selectedIndex=3)},function(error){$scope.todos=!0,alert(error)})},$scope.eliminaOrden=function(proveedor){operacion.eliminaOrden(proveedor,$scope.seleccionOrden),$scope.todos=!1},$scope.confirmaIncompleto=function(ev){2==$scope.selectedIndex&&0==$scope.step4block},$scope.muestraOrdenes=function(){operacion.generaDetalleOrdenes($scope.ordenes).then(function(data){$scope.ordenesListas=data},function(error){alert(error)})},$scope.generaCorreo=function(ev,index){var orden=$scope.ordenesListas[index];$mdDialog.show({controller:correoCtrl,templateUrl:"views/correo.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,locals:{info:orden}}).then(function(){})}}function correoCtrl($scope,$mdDialog,info,operacion,mensajes){$scope.inicio=function(){$scope.datos={orden:info.data.OCM_clave,correo:"",copias:[],asunto:"",comentarios:""}},$scope.enviaCorreo=function(){operacion.correo($scope.datos).success(function(data){$scope.inicio(),mensajes.alerta(data.respuesta,"success","top right","done_all")}).error(function(data){mensajes.alerta("No se logro enviar el correo favor de intentarlo nuevamente","error","top right","done_all")})},$scope.cancel=function(){$mdDialog.hide()}}function completaCtrl($scope,$mdDialog,informacion,operacion,mensajes,$rootScope){$scope.inicio=function(){$scope.guardando=!1,$scope.datos={orden:informacion.orden.OCM_clave,unidad:informacion.orden.UNI_clave,items:informacion.items,usuario:$rootScope.id}},$scope.guardar=function(){$scope.guardando=!0,operacion.completaOrden($scope.datos).success(function(data){$scope.guardando=!1,mensajes.alerta(data.respuesta,"success","top right","done_all"),$mdDialog.hide()})},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("ordenCompraCtrl",ordenCompraCtrl).controller("ordenesCompraCtrl",ordenesCompraCtrl).controller("correoCtrl",correoCtrl).controller("completaCtrl",completaCtrl),ordenesCompraCtrl.$inject=["$rootScope","$mdDialog","datos","busqueda","mensajes","$window","api","operacion"],ordenCompraCtrl.$inject=["$scope","$rootScope","operacion","mensajes","datos","pdf","$mdDialog"],correoCtrl.$inject=["$scope","$mdDialog","info","operacion","mensajes"],completaCtrl.$inject=["$scope","$mdDialog","informacion","operacion","mensajes","$rootScope"]}(),function(){"use strict";function ordenesAbiertasCtrl($rootScope,$scope,busqueda,datos,reportes,proveedores,segundaprueba,mensajes,$mdDialog,pdf){function detalleOrdenCtrl($rootScope,$scope,operacion,busqueda,$mdDialog,pdf,$state){console.log($scope.listado),busqueda.detalleOrdenAbierta($rootScope.idOrden).success(function(data){$scope.detalle=data,console.log($scope.detalle[0]),console.log($rootScope.permisos),$scope.permiso=$rootScope.permisos}),$scope.cerrar=function(ev,orden){console.log("entra cerrar");var confirm=$mdDialog.confirm().title("¿Desactivar cerrar la orden?").content("").ariaLabel("Cerrar orden").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){var info={usuario:$rootScope.id,orden:orden.OCM_clave};operacion.cerrarOrden(info).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),orden.OCM_incompleta=0,orden.OCM_cerrada=1,$state.reload()})})},$scope.cancelar=function(ev,orden){var confirm=$mdDialog.prompt().title("¿Deseas Cancelar la orden?").content("").placeholder("Motivo de cancelación").ariaLabel("Motivo de cancelación").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(motivo){var info={usuario:$rootScope.id,orden:orden.OCM_clave,motivo:motivo};operacion.cancelarOrden(info).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),orden.OCM_cancelada=1,$state.reload()})})},$scope.cerrarDialogo=function(){$mdDialog.cancel(),$state.reload()}}busqueda.unidadesUsuario($rootScope.id).success(function(data){$scope.listaUnidades=data}),$rootScope.tema="theme4",$rootScope.titulo="Ordenes de compra abiertas",$scope.listado=datos.data,$scope.total=0,$scope.limit=10,$scope.page=1,$scope.texto={text:"Registros por página:",of:"de"},$scope.paginacion=[10,20,30,40],$scope.onOrderChange=function(order){},$scope.xUnidad=function(unidad){busqueda.consultaOrdenesAbiertas(unidad).success(function(data){$scope.listado=data})},$scope.abreModal=function(id,ev){$rootScope.idOrden=id,$mdDialog.show({controller:detalleOrdenCtrl,templateUrl:"views/detalleOrden.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1})},$scope.exportaExcel=function(){reportes.ordenesAbiertas($rootScope.unidadesAdmin)}}angular.module("app").controller("ordenesAbiertasCtrl",ordenesAbiertasCtrl),ordenesAbiertasCtrl.$inject=["$rootScope","$scope","busqueda","datos","reportes","proveedores","segundaprueba","mensajes","$mdDialog","pdf"]}(),function(){"use strict";function perfilesCtrl($rootScope,$mdDialog,datos,permisos,mensajes){0==$rootScope.permisos.PER_perfiles&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.tema="theme2",$rootScope.titulo="Perfiles Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Perfiles por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevoPerfil=function(ev){$mdDialog.show({controller:perfilCtrl,templateUrl:"views/perfil.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=permisos.query()})},scope.editaPerfil=function(ev,perfil){$mdDialog.show({controller:perfilEditCtrl,templateUrl:"views/perfil.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:perfil},closeTo:{bottom:1500}}).then(function(){scope.info=permisos.query()})},scope.confirmacion=function(ev,perfil){var confirm=$mdDialog.confirm().title("¿Desactivar el permiso?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){permiso.PER_activo?permiso.PER_activo=0:permiso.PER_activo=1;var datos={nombre:permiso.PER_nombre,entradas:permiso.PER_entradas,salidas:permiso.PER_salidas,traspasos:permiso.PER_traspasos,editaItem:permiso.PER_consultaItems,desactivaItem:permiso.PER_desactivaItems,editaCatalogos:permiso.PER_consultaCatalogo,desactivaCatalogos:permiso.PER_desactivaCatalogo,autorizaorden:permiso.PER_autorizaOrden,modificaorden:permiso.PER_modificaOrden,cerrarorden:permiso.PER_cerrarOrden,surtir:permiso.PER_surtir,facturas:permiso.PER_subirFactura,asociar:permiso.PER_asociar,activo:permiso.PER_activo};permisos.update({permiso:permiso.PER_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function perfilCtrl($scope,$mdDialog,permisos,mensajes){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:"",alertas:!1,conexion:!1,movimientos:!1,traspasos:!1,generaOrden:!1,surtirOrden:!1,cerrarOrden:!1,completaOrden:!1,salidasAgranel:!1,recetaMV:!1,usuarios:!1,perfiles:!1,tipos:!1,catalogos:!1,editaCatalogos:!1,reportes:!1,activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,permisos.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function perfilEditCtrl($scope,$mdDialog,permisos,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.PER_nombre,alertas:1==informacion.PER_alertas,conexion:1==informacion.PER_conexiones,movimientos:1==informacion.PER_movimientos,traspasos:1==informacion.PER_traspasos,generaOrden:1==informacion.PER_generarOrden,surtirOrden:1==informacion.PER_surtirOrden,cerrarOrden:1==informacion.PER_cerrarOrden,completaOrden:1==informacion.PER_completaOrden,salidasAgranel:1==informacion.PER_salidasAgranel,recetaMV:1==informacion.PER_recetaMV,usuarios:1==informacion.PER_usuarios,perfiles:1==informacion.PER_perfiles,tipos:1==informacion.PER_tipos,catalogos:1==informacion.PER_consultaCatalogo,editaCatalogos:1==informacion.PER_modificaCatalogo,reportes:1==informacion.PER_reportes,activo:1==informacion.PER_activo},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,permisos.update({permiso:informacion.PER_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("perfilCtrl",perfilCtrl).controller("perfilesCtrl",perfilesCtrl).controller("perfilEditCtrl",perfilEditCtrl),perfilesCtrl.$inject=["$rootScope","$mdDialog","datos","permisos","mensajes"],perfilCtrl.$inject=["$scope","$mdDialog","permisos","mensajes"],perfilEditCtrl.$inject=["$scope","$mdDialog","permisos","mensajes","informacion"]}(),function(){"use strict";function porCaducarCtrl($rootScope,$scope,busqueda,datos,proveedores,segundaprueba,mensajes){var porCaducar=this;$rootScope.tema="theme4",$rootScope.titulo="Items por caducar",porCaducar.listado=datos.data,porCaducar.total=0,porCaducar.limit=10,porCaducar.page=1,porCaducar.texto={text:"Items por página:",of:"de"},porCaducar.paginacion=[10,20,30,40],porCaducar.listado.length>50&&mensajes.alerta("¡Más de 50 items están por caducar!","error","top right","warning"),porCaducar.onOrderChange=function(order){}}angular.module("app").controller("porCaducarCtrl",porCaducarCtrl),porCaducarCtrl.$inject=["$rootScope","$scope","busqueda","datos","proveedores","segundaprueba","mensajes"]}(),function(){"use strict";function porSurtirCtrl($rootScope,$scope,busqueda,datos,proveedores,segundaprueba,mensajes,operacion,$state){var porSurtir=this;$rootScope.tema="theme4",$rootScope.titulo="Items por surtir",$scope.trabajando=!1,porSurtir.listado=datos.data,porSurtir.total=0,porSurtir.limit=10,porSurtir.page=1,porSurtir.texto={text:"Items por página:",of:"de"},porSurtir.paginacion=[10,20,30,40],porSurtir.listado.length>15&&mensajes.alerta("Más de 15 items están reservados para receta","info","top right","info"),porSurtir.onOrderChange=function(order){},$scope.actualizaPorSurtir=function(){console.info("actualiza"),$scope.trabajando=!0,operacion.eliminaReservasAntiguas().success(function(data){console.log(data),$scope.trabajando=!1,$state.reload()})}}angular.module("app").controller("porSurtirCtrl",porSurtirCtrl),porSurtirCtrl.$inject=["$rootScope","$scope","busqueda","datos","proveedores","segundaprueba","mensajes","operacion","$state"]}(),function(){"use strict";function proveedoresCtrl($rootScope,$mdDialog,datos,proveedores,mensajes){
var scope=this;$rootScope.tema="theme3",$rootScope.titulo="Proveedores Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Proveedores por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevo=function(ev){$mdDialog.show({controller:proveedorCtrl,templateUrl:"views/proveedor.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=proveedores.query()})},scope.confirmacion=function(ev,proveedor){var confirm=$mdDialog.confirm().title("¿Desactivar el proveedor?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar proveedor").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){proveedor.PRO_activo?proveedor.PRO_activo=0:proveedor.PRO_activo=1;var datos={nombre:proveedor.PRO_nombre,nombrecorto:proveedor.PRO_nombrecorto,razon:proveedor.PRO_razonSocial,rfc:proveedor.PRO_rfc,activo:proveedor.PRO_activo};proveedores.update({proveedor:proveedor.PRO_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function proveedorCtrl($scope,$mdDialog,proveedores,mensajes,archivos,Upload,$rootScope){$rootScope.titulo="Nuevo Proveedor",$rootScope.atras=!0,$rootScope.menu="arrow_back",$scope.inicio=function(){$scope.datos={nombre:"",nombrecorto:"",rfc:"",razon:"",correo1:"",correo2:"",activo:!0},$scope.imagenes=[],$scope.guardando=!1},$scope.guardar=function(){$scope.proveedorForm.$valid&&($scope.guardando=!0,proveedores.save($scope.datos,function(data){var respuesta=data.respuesta;archivos.proveedores($scope.imagenes,data.clave).then(function(data){console.log("Imagenes: "+data),mensajes.alerta(respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.proveedorForm.$setPristine(),$scope.inicio()},function(error){mensajes.alerta("Ocurrio un error al subir las imagenes intentelo nuevamente editando el item","error","top right","done_all"),$scope.guardando=!1,$scope.proveedorForm.$setPristine(),$scope.inicio()},function(data){console.log("Estatus: "+data)})}))},$scope.upload=function(files,file,event){if(files&&files.length)for(var i=0;i<files.length;i++)$scope.imagenes.push(files[i])},$scope.eliminaImagen=function(index){$scope.imagenes.splice(index,1)}}function proveedorEditCtrl($scope,$mdDialog,proveedores,mensajes,datos,archivos,Upload,$rootScope){$rootScope.titulo="Edita Proveedor",$rootScope.atras=!0,$rootScope.menu="arrow_back",$scope.inicio=function(){$scope.datos={nombre:datos.datos.PRO_nombre,nombrecorto:datos.datos.PRO_nombrecorto,razon:datos.datos.PRO_razonSocial,rfc:datos.datos.PRO_rfc,correo1:datos.datos.PRO_correo1,correo2:datos.datos.PRO_correo2,activo:!!datos.datos.PRO_activo},$scope.imagenes=[],$scope.imagenesguardadas=datos.archivos.imagenes?datos.archivos.imagenes:[],$scope.guardando=!1},$scope.guardar=function(){$scope.proveedorForm.$valid&&($scope.guardando=!0,proveedores.update({proveedor:datos.datos.PRO_clave},$scope.datos,function(data){var respuesta=data.respuesta;archivos.proveedores($scope.imagenes,data.clave).then(function(data){console.log("Imagenes: "+data),mensajes.alerta(respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.proveedorForm.$setPristine()},function(error){console.log(error),mensajes.alerta("Ocurrio un error al subir las imagenes intentelo nuevamente editando el proveedor","error","top right","done_all"),$scope.guardando=!1,$scope.proveedorForm.$setPristine()},function(data){console.log("Estatus: "+data)})}))},$scope.upload=function(files,file,event){if(files&&files.length)for(var i=0;i<files.length;i++)$scope.imagenes.push(files[i])},$scope.eliminaImagen=function(index){$scope.imagenes.splice(index,1)},$scope.eliminaImagenGuardad=function(index){mensajes.alerta("Eliminando imagen","","top right","");var imagen=$scope.imagenesguardadas[index];archivos.eliminaItem(imagen,$scope.clave).success(function(data){$scope.imagenesguardadas.splice(index,1)})}}angular.module("app").controller("proveedorCtrl",proveedorCtrl).controller("proveedoresCtrl",proveedoresCtrl).controller("proveedorEditCtrl",proveedorEditCtrl),proveedoresCtrl.$inject=["$rootScope","$mdDialog","datos","proveedores","mensajes"],proveedorCtrl.$inject=["$scope","$mdDialog","proveedores","mensajes","archivos","Upload","$rootScope"],proveedorEditCtrl.$inject=["$scope","$mdDialog","proveedores","mensajes","datos","archivos","Upload","$rootScope"]}(),function(){"use strict";function pruebaCtrl($rootScope,$scope,busqueda,datos,proveedores,segundaprueba,mensajes){var prueba=this;$rootScope.tema="theme3",$rootScope.titulo="Sección de prueba",$scope.infoA=!1,$scope.infoB=!1,$scope.infoC=!1,$scope.cliente={nombreCompleto:null,nombre:null,aPaterno:null,aMaterno:null,telefono:null,email:null,domicilio:null},prueba.info=datos,prueba.total=0,prueba.limit=10,prueba.page=1,prueba.texto={text:"Clientes por página:",of:"de"},prueba.paginacion=[10,20,30,40],prueba.inicio=function(){console.log("Bienvenido")},prueba.consulta=function(){busqueda.consultaPrueba().then(function(info){$scope.infoPrueba=info.data,$scope.infoA=!0,$scope.infoB=!1,$scope.infoC=!1})},prueba.consultaB=function(){segundaprueba.query(function(info){$scope.info2=info,console.log($scope.info2),$scope.infoA=!1,$scope.infoB=!0,$scope.infoC=!1})},prueba.consultaC=function(){busqueda.prueba2().then(function(info){$scope.info2=info.data}),$scope.infoA=!1,$scope.infoB=!1,$scope.infoC=!0},prueba.guardaCliente=function(){$scope.cliente.nombreCompleto=$scope.cliente.nombre+" "+$scope.cliente.aPaterno+" "+$scope.cliente.aMaterno,segundaprueba.save($scope.cliente,function(data){$scope.cliente={nombreCompleto:null,nombre:null,aPaterno:null,aMaterno:null,telefono:null,email:null,domicilio:null},mensajes.alerta("Cliente guardado satisfactoriamente","success","top right","wb_cloudy"),prueba.consultaB()},function(error){mensajes.alerta("Ha ocurrido un error, intentalo nuevamente","error","top right","wb_cloudy")})}}angular.module("app").controller("pruebaCtrl",pruebaCtrl),pruebaCtrl.$inject=["$rootScope","$scope","busqueda","datos","proveedores","segundaprueba","mensajes"]}(),function(){"use strict";function pruebaSECtrl($rootScope,$scope,$mdDialog,busqueda){var pruebaSE=this;$rootScope.tema="theme4",$rootScope.titulo="Pruebas de maquetación",$rootScope.mostrarDatos=!1,$scope.infoA=!1,$scope.infoB=!1,$scope.infoC=!1,$scope.cliente={nombreCompleto:null,nombre:null,aPaterno:null,aMaterno:null,telefono:null,email:null,domicilio:null},pruebaSE.total=0,pruebaSE.limit=10,pruebaSE.page=1,pruebaSE.texto={text:"Clientes por página:",of:"de"},pruebaSE.paginacion=[10,20,30,40],pruebaSE.inicio=function(){console.log("Bienvenido a pruebaSE")},pruebaSE.abreModal=function(ev){console.log("Dialogo abierto"),$mdDialog.show({controller:pruebaDialogoCtrl,templateUrl:"views/pruebaDialogo.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1})}}function pruebaDialogoCtrl($rootScope,$scope,$mdDialog,busqueda){$scope.datos={usuario:$rootScope.username,password:null},$scope.psdConfirmacion="",$scope.cerrarDialogo=function(){$mdDialog.cancel(),console.log("Dialogo cerrado")},$scope.mostrarDatos=function(){$rootScope.mostrarDatos=!1,$scope.solicitaPsw=!0,console.log("Se solicita la contraseña para mostrar los datos"),console.log($rootScope.username)},$scope.verificarPassword=function(){console.log($scope.datos)}}angular.module("app").controller("pruebaSECtrl",pruebaSECtrl).controller("pruebaDialogoCtrl",pruebaSECtrl),pruebaSECtrl.$inject=["$rootScope","$scope","$mdDialog","busqueda"],pruebaDialogoCtrl.$inject=["$rootScope","$scope","$mdDialog","busqueda"]}(),function(){"use strict";function dialogoRecetaCtrl($scope,$rootScope,busqueda,$mdDialog,mensajes,data){$scope.receta=data,$scope.esAdmin=!1,parseInt($rootScope.permisos.PER_clave)<3&&($scope.esAdmin=!0),$scope.cerrarAlerta=function(){$mdDialog.hide()}}function recetaCtrl($scope,$rootScope,busqueda,datos,operacion,$mdDialog,mensajes,$q,$filter){var scope=this;$rootScope.cargando=!1,$rootScope.tema="theme1",$rootScope.titulo="Surtir receta",scope.items=datos[1].data,scope.tipoItems=datos[0].data,scope.surtiendo=!1,scope.datosReceta=!1,scope.loading=!1,scope.cancelando=!1,scope.filtro="",scope.itemssurtidos=[],scope.tardio=null,scope.inicio=function(){scope.receta="",scope.datos=[],parseInt($rootScope.permisos.PER_clave)<3&&($scope.esAdmin=!0)},scope.surtirItem=function(valor){console.log(valor),void 0==valor.lotes&&1==valor.forzoso?mensajes.alerta("Debes ingresar un lote para surtir item","error","top right","error"):(scope.surtiendo=!0,operacion.surtirItem(valor).success(function(data){scope.surtiendo=!1,mensajes.alerta(data.respuesta,"success","top right","done_all"),valor.surtido=!0}).error(function(data){scope.surtiendo=!1,mensajes.alerta("Ocurrio un error de conexion verifica que el item se haya surtido por favor","error","top right","error")}))},scope.cancelarItem=function(valor){console.log(valor),scope.cancelando=!0,operacion.cancelarItem(valor).success(function(data){scope.cancelando=!1,data.ok?(mensajes.alerta(data.respuesta,"success","top right","done_all"),valor.surtido=!0):(mensajes.alerta(data.respuesta,"error","top right","error"),scope.buscaReceta())}).error(function(data){scope.cancelando=!1,mensajes.alerta("Error de conexion","error","top right","error"),scope.buscaReceta()})},scope.verificaExistencia=function(item,ev){if(scope.filtro="",console.log(item),scope.valorAnterior!=item.item){item.surtido=!0;var confirm=$mdDialog.confirm().title("Cambio de Item").content("¿Seguro que quieres cambiar de item puede que la existencia cambie?").ariaLabel("Confirmación").targetEvent(ev).ok("SI").cancel("NO");$mdDialog.show(confirm).then(function(){mensajes.alerta("Verificando Existencia","","top right","search"),operacion.cambiaItem(item).then(function(data){mensajes.alerta("Existencia disponible","success","top right","done_all"),item.existencia=data.EXI_clave,item.surtido=!1},function(error){mensajes.alerta(error,"error","top right","error"),item.item=scope.valorAnterior,item.surtido=!1})},function(){item.item=scope.valorAnterior,item.surtido=!1})}else item.surtido=!1},scope.ingresaLote=function(item,ev){console.log(item),$mdDialog.show({controller:loteRecetaCtrl,templateUrl:"views/loteReceta.html",parent:angular.element(document.body),targetEvent:ev,locals:{info:item},resolve:{informacion:function(busqueda){return busqueda.lotesAlmacenXitem(item.almacen,item.item)}},clickOutsideToClose:!1}).then(function(lotes){item.lotes=lotes})},scope.ingresaItem=function(ev){if(console.log(scope.datos),scope.datos.items.length>0){var item=scope.datos.items[0],datosReceta={almacen:item.almacen,receta:item.receta,tipo:scope.datos.tipo};$mdDialog.show({controller:itemRecetaCtrl,templateUrl:"views/itemReceta.html",parent:angular.element(document.body),targetEvent:ev,locals:{info:datosReceta},resolve:{informacion:function(busqueda,$q){scope.loading=!0;var promesa=$q.defer(),items=busqueda.itemsReceta(),tiposMovimiento=busqueda.tiposMovimiento(),almacenes=busqueda.almacenesUsuario($rootScope.id),tiposajuste=busqueda.tiposAjuste();return $q.all([items,tiposMovimiento,almacenes,tiposajuste]).then(function(data){promesa.resolve(data),scope.loading=!1}),promesa.promise}},clickOutsideToClose:!1}).then(function(){scope.surtidos()})}else mensajes.alerta("Ya no puedes ingresar items una vez surtida la receta","error","top right","error")},scope.surtidos=function(){busqueda.itemsRecetaSurtidas(scope.receta).success(function(data){scope.itemsSurtidos=data})},scope.buscaReceta=function(){scope.cargando=!0,scope.datosReceta=!1,scope.datos=[],busqueda.receta(scope.receta).success(function(data){scope.uniNombre=data.uniNombre;var unidades=$rootScope.unidadesAdmin.split(",");scope.autorizado=!1,scope.tardio=parseInt(data.tardio),scope.vigente=parseInt(data.vigente),scope.vigencia=data.vigencia;for(var i=0;i<unidades.length;i++){if(data.unidad==unidades[i]){scope.autorizado=!0;break}scope.autorizado=!1}0!=scope.autorizado&&0!=scope.vigente||scope.abreModal(data),scope.datos=data,data.unidad===-1&&$scope.esAdmin&&(scope.datos.unidad=data.uniAdmin[0].UNI_clave,console.log(scope.datos.unidad)),5===parseInt(scope.datos.TIR_clave)&&console.info("ES PARTICULAR"),4===parseInt(scope.datos.TIR_clave)&&console.info("ES CORTA ESTANCIA"),scope.cargando=!1,scope.datosReceta=!0,scope.surtidos()}).error(function(data){scope.cargando=!1})},scope.abreModal=function(datos){$mdDialog.show({controller:dialogoRecetaCtrl,templateUrl:"views/errorReceta.html",parent:angular.element(document.body),clickOutsideToClose:!1,data:datos})},scope.filtraOrtesis=function(item){var palabras=item.ITE_nombre.split(" ");return palabras[0]},scope.generaFiltro=function(recetaItem){var item=$filter("filter")(scope.items,{ITE_clave:recetaItem.item}),palabras=item[0].ITE_nombre.split(" ");scope.filtro=palabras[0],scope.valorAnterior=recetaItem.item}}function loteRecetaCtrl($scope,$mdDialog,info,mensajes,busqueda,informacion){console.log(informacion.data),$scope.lotesUnidad=informacion.data,$scope.lotes=info.lotes?info.lotes:[],$scope.maximo=info.caja>0?Number(info.caja)*Number(info.cantidad):info.cantidad,$scope.lotes.length>0&&angular.forEach($scope.lotes,function(value,key){$scope.maximo-=value.cantidad}),$scope.inicio=function(){$scope.cantidadLote=0,$scope.datos={cantidad:"",idLote:"",lote:"",caducidad:""}},$scope.datosLote=function(lote){if(lote){var dato=JSON.parse(lote);$scope.datos.idLote=dato.LOT_clave,$scope.datos.lote=dato.LOT_numero,$scope.datos.caducidad=moment(dato.LOT_caducidad).toDate(),$scope.cantidadLote=dato.LOT_cantidad}},$scope.verificaCantidadLote=function(){$scope.cantidadLote>0&&$scope.cantidadLote<$scope.datos.cantidad?(mensajes.alerta("El lote solo tiene "+$scope.cantidadLote+" disponible(s)","error","top right","error"),$scope.datos.cantidad=0):0==$scope.cantidadLote&&$scope.datos.cantidad>0&&""!=$scope.datos.idLote&&mensajes.alerta("Este lote no tiene cantidad disponible","error","top right","error")},$scope.verificaLote=function(){var lote=$scope.datos.lote;""!=lote&&(mensajes.alerta("Verificando Lote","info","top right","search"),busqueda.lote(lote).success(function(data){data?(mensajes.alerta("Lote Existente","success","top right","done"),$scope.datos.idLote=data.LOT_clave,$scope.datos.caducidad=moment(data.LOT_caducidad).toDate()):($scope.datos.caducidad="",mensajes.alerta("Lote No Existente Verificalo nuevamente","error","top right","alert"))}).error(function(data){$scope.mensajeError()}))},$scope.agrega=function(){$scope.modificaForm.$valid&&($scope.maximo-=$scope.datos.cantidad,$scope.lotes.push($scope.datos),$scope.inicio())},$scope.ingresa=function(){0==$scope.maximo?$mdDialog.hide($scope.lotes):mensajes.alerta("No has ingresado todos los items a lotes","error","top right","error")},$scope.cerrarDialogLote=function(){console.log("Cerrar Dialogo Lote"),$mdDialog.hide()}}function itemRecetaCtrl($scope,$rootScope,$mdDialog,informacion,operacion,mensajes,$q,$filter,busqueda,info){function consultado(query){var q=$q.defer(),response=query?$filter("filter")($scope.items,query):$scope.items;return q.resolve(response),q.promise}console.log(informacion),console.log(info),$scope.items=informacion[0].data,$scope.tiposmovimiento=informacion[1].data,$scope.almacenes=informacion[2].data,$scope.tiposajuste=informacion[3].data,$scope.existeLote=!1,$scope.inicio=function(){$scope.cambiaAlm=!1,$scope.busqueda=null,$scope.consultado=consultado,$scope.item="",$scope.disponible="",$scope.lotes=[],$scope.datos={almacen:info.almacen,recetaTipo:info.tipo,item:"",cantidad:"",tipomov:3,tipoa:"",orden:"",lote:"",idLote:"",caducidad:"",receta:info.receta,usuario:$rootScope.id,observaciones:""},$scope.guardando=!1},$scope.selectedItemChange=function(){""!=$scope.datos.almacen&&$scope.item&&(console.log("entro"),$scope.datos.lote="",$scope.datos.idLote="",$scope.datos.caducidad="",$scope.verificaExistencia($scope.datos.almacen))},$scope.cambioAlmacen=function(ALM_clave){console.log("cambio de almacen"+ALM_clave),$scope.items=busqueda.itemsAlmacen(ALM_clave),console.log($scope.items)},$scope.mensajeError=function(){mensajes.alerta("Ocurrio un error intentalo nuevamente","error","top right","error")},$scope.datosLote=function(lote){if(lote){var dato=JSON.parse(lote);console.log(dato),$scope.datos.idLote=dato.LOT_clave,$scope.datos.lote=dato.LOT_numero,$scope.datos.caducidad=moment(dato.LOT_caducidad).toDate(),console.log($scope.datos.caducidad),$scope.cantidadLote=dato.LOT_cantidad,$scope.existeLote=!0,$scope.verificaCantidadLote()}},$scope.verificaLote=function(){var lote=$scope.datos.lote;""!=lote&&(mensajes.alerta("Verificando Lote","info","top right","search"),busqueda.lote(lote).success(function(data){data?(mensajes.alerta("Lote Existente","success","top right","done"),$scope.datos.idLote=data.LOT_clave,$scope.datos.caducidad=moment(data.LOT_caducidad).toDate(),$scope.existeLote=!0):mensajes.alerta("Lote No Existente Ingresa Caducidad","error","top right","alert")}).error(function(data){$scope.mensajeError()}))},$scope.verificaCantidadLote=function(){$scope.cantidadLote>0&&$scope.cantidadLote<$scope.datos.cantidad&&3==$scope.datos.tipomov?(mensajes.alerta("El lote solo tiene "+$scope.cantidadLote+" disponible(s)","error","top right","error"),$scope.datos.cantidad=0):0==$scope.cantidadLote&&$scope.datos.cantidad>0&&""!=$scope.datos.idLote&&3==$scope.datos.tipomov&&mensajes.alerta("Este lote no tiene cantidad disponible","error","top right","error")},$scope.verificaExistencia=function(almacen){almacen&&(mensajes.alerta("Verificando Datos de Almacen","info","top right","search"),1==$scope.item.TIT_forzoso&&busqueda.lotesAlmacenXitem(almacen,$scope.item.ITE_clave).success(function(data){$scope.lotes=data}),busqueda.itemAlmacen(almacen,$scope.item.ITE_clave).success(function(data){3==$scope.datos.tipomov&&""==data?(mensajes.alerta("No hay Cantdad Disponible En Este Almacen Para Salida","error","top right","error"),$scope.disponible=0):""==data?$scope.disponible=0:$scope.disponible=data.EXI_cantidad}).error(function(data){$scope.mensajeError()}))},$scope.verificaExistenciaAlmacen=function(almacen){$scope.busqueda="",$scope.cambiaAlm=!0,busqueda.itemsAlmacen(almacen).success(function(data){$scope.cambiaAlm=!1,$scope.items=data})},$scope.guardar=function(){$scope.movimientoForm.$valid&&$scope.item&&($scope.datos.item=$scope.item.ITE_clave,$scope.guardando=!0,operacion.altaMovimiento($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.movimientoForm.$setPristine(),$scope.inicio()}).error(function(data){$scope.mensajeError(),$scope.guardando=!1}))},$scope.detalleItem=function(item){},$scope.verificaForm=function(){return console.log($scope.item),1==$scope.datos.tipomov&&""==$scope.datos.tipoa||(3==$scope.datos.tipomov&&$scope.disponible<$scope.datos.cantidad||(3==$scope.datos.tipomov&&1==$scope.item.TIT_forzoso&&""==$scope.datos.idLote||!!$scope.guardando))},$scope.cancel=function(){console.log("Cerrar dialogo item"),$mdDialog.hide()}}angular.module("app").controller("recetaCtrl",recetaCtrl).controller("loteRecetaCtrl",loteRecetaCtrl).controller("itemRecetaCtrl",itemRecetaCtrl).controller("dialogoRecetaCtrl",dialogoRecetaCtrl),recetaCtrl.$inject=["$scope","$rootScope","busqueda","datos","operacion","$mdDialog","mensajes","$q","$filter"],loteRecetaCtrl.$inject=["$scope","$mdDialog","info","mensajes","busqueda","informacion"],itemRecetaCtrl.$inject=["$scope","$rootScope","$mdDialog","informacion","operacion","mensajes","$q","$filter","busqueda","info"],dialogoRecetaCtrl.$inject=["$scope","$rootScope","busqueda","$mdDialog","mensajes","data"]}(),function(){"use strict";function reporteExistenciasCtrl($rootScope,busqueda,mensajes,datos,reportes,$mdBottomSheet){var scope=this;$rootScope.tema="theme4",$rootScope.titulo="Existencias",scope.unidades=datos[0].data,scope.total=0,scope.limit=10,scope.page=1,scope.busqueda="",scope.texto={text:"Resultados por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.inicio=function(){scope.nuevaBusqueda=!0,scope.consultando=!1,scope.items=datos[1].data,scope.tiposItem=datos[2].data,scope.almacenes=[],scope.datos={usuario:$rootScope.id,unidad:"",almacen:"",item:"",tipo:""}},scope.agregaUnidad=function(unidad){scope.unidadB=" "+unidad},scope.agregaAlmacen=function(almacen){scope.almacenB=" /"+almacen},scope.agregaItem=function(item){scope.itemB=" /"+item},scope.cargaAlmacenes=function(unidad){busqueda.almacenesUnidad(unidad).success(function(data){console.log(data),scope.almacenes=data})},scope.cargaItems=function(almacen){busqueda.itemsAlmacen(almacen).success(function(data){scope.items=data})},scope.buscar=function(){scope.datos.unidad||scope.datos.item?(scope.consultando=!0,scope.unidadB=scope.datos.unidad?scope.unidadB:"",scope.almacenB=scope.datos.almacen?scope.almacenB:"",scope.itemB=scope.datos.item?scope.itemB:"",reportes.existencias(scope.datos).success(function(data){scope.consultando=!1,data.length>0?(scope.info=data,scope.nuevaBusqueda=!1):mensajes.alerta("No se encontro información disponible","error","top right","error")}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")})):mensajes.alerta("Debes ingresar un item o una unidad","error","top right","error")},scope.opciones=function(){$mdBottomSheet.show({templateUrl:"views/opcionesReporte.html",controller:"opcionesCtrl",clickOutsideToClose:!0}).then(function(accion){console.log(accion),"Nuevo"==accion.name?scope.inicio():"Editar"==accion.name?scope.nuevaBusqueda=!0:"Exp. Excel"==accion.name?(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportar("existencias",scope.datos)):"Exp. PDF"==accion.name&&(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportarPDF("existencias",scope.datos))})}}angular.module("app").controller("reporteExistenciasCtrl",reporteExistenciasCtrl),reporteExistenciasCtrl.$inject=["$rootScope","busqueda","mensajes","datos","reportes","$mdBottomSheet"]}(),function(){"use strict";function reporteItemsCtrl($rootScope,busqueda,mensajes,reportes,$mdBottomSheet){var scope=this;$rootScope.tema="theme4",$rootScope.titulo="Reporte de Items",scope.total=0,scope.limit=40,scope.page=1,scope.busqueda="",scope.texto={text:"Resultados por pagina:",of:"de"},scope.paginacion=[10,20,30,40,50,60],scope.inicio=function(){scope.buscar()},scope.buscar=function(){mensajes.alerta("Consultando Información","info","top right","search"),reportes.items().success(function(data){scope.consultando=!1,data.length>0?scope.info=data:mensajes.alerta("No se encontro información disponible","error","top right","error")}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")})},scope.exportar=function(){mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportar("items",scope.datos)}}angular.module("app").controller("reporteItemsCtrl",reporteItemsCtrl),reporteItemsCtrl.$inject=["$rootScope","busqueda","mensajes","reportes","$mdBottomSheet"]}(),function(){"use strict";function reporteLotesCtrl($rootScope,busqueda,mensajes,datos,reportes,$mdBottomSheet){var scope=this;$rootScope.tema="theme4",$rootScope.titulo="Lotes",scope.unidades=datos[0].data,scope.total=0,scope.limit=10,scope.page=1,scope.busqueda="",scope.texto={text:"Resultados por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.inicio=function(){scope.nuevaBusqueda=!0,scope.consultando=!1,scope.items=datos[1].data,scope.tiposItem=datos[2].data,scope.almacenes=[],scope.datos={unidad:"",almacen:"",item:"",tipo:"",permiso:$rootScope.permisos.PER_clave,verCeros:!1},console.log(scope.datos)},scope.agregaUnidad=function(unidad){scope.unidadB=" "+unidad},scope.agregaAlmacen=function(almacen){scope.almacenB=" /"+almacen},scope.agregaItem=function(item){scope.itemB=" /"+item},scope.cargaAlmacenes=function(unidad){busqueda.almacenesUnidad(unidad).success(function(data){console.log(data),scope.almacenes=data})},scope.cargaItems=function(almacen){busqueda.itemsAlmacen(almacen).success(function(data){scope.items=data})},scope.buscar=function(){scope.datos.unidad?(console.log(scope.datos),scope.consultando=!0,scope.unidadB=scope.datos.unidad?scope.unidadB:"",scope.almacenB=scope.datos.almacen?scope.almacenB:"",scope.itemB=scope.datos.item?scope.itemB:"",reportes.lotes(scope.datos).success(function(data){scope.consultando=!1,scope.info=data,data.length>0?scope.nuevaBusqueda=!1:mensajes.alerta("No se encontro información disponible","error","top right","error")}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")})):mensajes.alerta("debes ingresar unidad y tipo","error","top right","error")},scope.opciones=function(){$mdBottomSheet.show({templateUrl:"views/opcionesReporte.html",controller:"opcionesCtrl",clickOutsideToClose:!0}).then(function(accion){console.log(accion),"Nuevo"==accion.name?scope.inicio():"Editar"==accion.name?scope.nuevaBusqueda=!0:"Exp. Excel"==accion.name?(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportar("lotes",scope.datos)):"Exp. PDF"==accion.name&&(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportarPDF("lotes",scope.datos))})}}angular.module("app").controller("reporteLotesCtrl",reporteLotesCtrl),reporteLotesCtrl.$inject=["$rootScope","busqueda","mensajes","datos","reportes","$mdBottomSheet"]}(),function(){"use strict";function reporteMovimientosCtrl($rootScope,busqueda,mensajes,datos,reportes,$mdBottomSheet){var scope=this;$rootScope.tema="theme4",$rootScope.titulo="Movimientos",scope.unidades=datos[0].data,scope.total=0,scope.limit=10,scope.page=1,scope.busqueda="",scope.texto={text:"Resultados por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.inicio=function(){scope.nuevaBusqueda=!0,scope.consultando=!1,scope.items=datos[1].data,scope.tiposItem=datos[2].data,scope.almacenes=[],scope.datos={unidad:"",almacen:"",item:"",tipo:"",fechaInicio:null,fechaFinal:null},scope.fechaInicio=null,scope.fechaFinal=null},scope.agregaUnidad=function(unidad){scope.unidadB=" "+unidad},scope.agregaAlmacen=function(almacen){scope.almacenB=" /"+almacen},scope.agregaItem=function(item){scope.itemB=" /"+item},scope.cargaAlmacenes=function(unidad){busqueda.almacenesUnidad(unidad).success(function(data){console.log(data),scope.almacenes=data})},scope.cargaItems=function(almacen){busqueda.itemsAlmacen(almacen).success(function(data){scope.items=data})},scope.cambio=function(){console.log(scope.datos);var d=new Date(scope.fechaInicio),month=""+(d.getMonth()+1),day=""+d.getDate(),year=d.getFullYear();month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),null==scope.fechaInicio?scope.datos.fechaInicio:scope.datos.fechaInicio=year+"-"+month+"-"+day+" 00:00:00";var d=new Date(scope.fechaFinal),month=""+(d.getMonth()+1),day=""+d.getDate(),year=d.getFullYear();month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),null==scope.fechaFinal?scope.datos.fechaFinal:scope.datos.fechaFinal=year+"-"+month+"-"+day+" 23:59:59"},scope.buscar=function(){scope.datos.fechaInicio=scope.datos.fechaInicio.substring(0,10),scope.datos.fechaFinal=scope.datos.fechaFinal.substring(0,10),null==scope.datos.fechaInicio||null==scope.datos.fechaFinal?mensajes.alerta("Se requiere fecha de inicial y final para generar el reporte","error","top right","error"):(scope.consultando=!0,scope.unidadB=scope.datos.unidad?scope.unidadB:"",scope.almacenB=scope.datos.almacen?scope.almacenB:"",scope.itemB=scope.datos.item?scope.itemB:"",reportes.movimientos(scope.datos).success(function(data){scope.consultando=!1,scope.info=data,data.length>0?scope.nuevaBusqueda=!1:mensajes.alerta("No se encontro información disponible","error","top right","error")}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")}))},scope.opciones=function(){$mdBottomSheet.show({templateUrl:"views/opcionesReporte.html",controller:"opcionesCtrl",clickOutsideToClose:!0}).then(function(accion){console.log(accion),"Nuevo"==accion.name?scope.inicio():"Editar"==accion.name?scope.nuevaBusqueda=!0:"Exp. Excel"==accion.name?(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportar("movimientos",scope.datos)):"Exp. PDF"==accion.name&&(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportarPDF("movimientos",scope.datos))})}}angular.module("app").controller("reporteMovimientosCtrl",reporteMovimientosCtrl),reporteMovimientosCtrl.$inject=["$rootScope","busqueda","mensajes","datos","reportes","$mdBottomSheet"]}(),function(){"use strict";function reporteOrdenesCtrl($rootScope,busqueda,mensajes,datos,reportes,$mdBottomSheet){var scope=this;$rootScope.tema="theme4",$rootScope.titulo="Ordenes de Compra",scope.unidades=datos[0].data,scope.items=datos[1].data,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Resultados por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.inicio=function(){scope.nuevaBusqueda=!0,scope.datos={unidad:"",item:"",tipo:"",fechaini:"",fechafin:"",acceso:"",estatus:""}},scope.buscar=function(){scope.datos.unidad?(scope.consultando=!0,scope.datos.acceso="",reportes.ordenes(scope.datos).success(function(data){data.length>0?(scope.info=data,scope.nuevaBusqueda=!1):mensajes.alerta("No se encontro información disponible","error","top right","error"),scope.consultando=!1}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")})):mensajes.alerta("debes ingresar unidad","error","top right","error")},scope.surtidos=function(){scope.datos.unidad?(scope.datos.acceso="surtidos",scope.consultando=!0,reportes.ordenes(scope.datos).success(function(data){console.log(data),data.length>0?(scope.info=data,scope.nuevaBusqueda=!1):mensajes.alerta("No se encontro información disponible","error","top right","error"),scope.consultando=!1}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")})):mensajes.alerta("debes ingresar unidad","error","top right","error")},scope.registrados=function(){scope.datos.unidad?(scope.datos.acceso="registrados",scope.consultando=!0,reportes.ordenes(scope.datos).success(function(data){data.length>0?(scope.info=data,scope.nuevaBusqueda=!1):mensajes.alerta("No se encontro información disponible","error","top right","error"),scope.consultando=!1}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")})):mensajes.alerta("debes ingresar unidad","error","top right","error")},scope.cancelados=function(){scope.datos.unidad?(scope.datos.acceso="cancelados",scope.consultando=!0,reportes.ordenes(scope.datos).success(function(data){data.length>0?(scope.info=data,scope.nuevaBusqueda=!1):mensajes.alerta("No se encontro información disponible","error","top right","error"),scope.consultando=!1}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")})):mensajes.alerta("debes ingresar unidad","error","top right","error")},scope.opciones=function(){$mdBottomSheet.show({templateUrl:"views/opcionesReporte.html",controller:"opcionesCtrl",clickOutsideToClose:!0}).then(function(accion){console.log(accion),"Nuevo"==accion.name?scope.inicio():"Editar"==accion.name?scope.nuevaBusqueda=!0:"Exp. Excel"==accion.name?(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportar("ordenes",scope.datos)):"Exp. PDF"==accion.name&&(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),
reportes.exportarPDF("ordenes",scope.datos))})}}angular.module("app").controller("reporteOrdenesCtrl",reporteOrdenesCtrl),reporteOrdenesCtrl.$inject=["$rootScope","busqueda","mensajes","datos","reportes","$mdBottomSheet"]}(),function(){"use strict";function reporteTraspasosCtrl($rootScope,busqueda,mensajes,datos,reportes,$mdBottomSheet,$mdDialog){var scope=this;$rootScope.tema="theme4",$rootScope.titulo="Traspasos",scope.unidades=datos[0].data,scope.total=0,scope.limit=10,scope.page=1,scope.busqueda="",scope.texto={text:"Resultados por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.inicio=function(){scope.nuevaBusqueda=!0,scope.consultando=!1,scope.items=datos[1].data,scope.tiposItem=datos[2].data,scope.almacenes=[],scope.datos={unidad:"",almacen:"",item:"",tipo:"",fechaInicio:null,fechaFinal:null},scope.fechaInicio=null,scope.fechaFinal=null},scope.cambio=function(){var d=new Date(scope.fechaInicio),month=""+(d.getMonth()+1),day=""+d.getDate(),year=d.getFullYear();month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),null==scope.fechaInicio?scope.datos.fechaInicio:scope.datos.fechaInicio=year+"-"+month+"-"+day+" 00:00:00";var d=new Date(scope.fechaFinal),month=""+(d.getMonth()+1),day=""+d.getDate(),year=d.getFullYear();month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),null==scope.fechaFinal?scope.datos.fechaFinal:scope.datos.fechaFinal=year+"-"+month+"-"+day+" 23:59:59"},scope.agregaUnidad=function(unidad){scope.unidadB=" "+unidad},scope.agregaAlmacen=function(almacen){scope.almacenB=" /"+almacen},scope.agregaItem=function(item){scope.itemB=" /"+item},scope.cargaAlmacenes=function(unidad){busqueda.almacenesUnidad(unidad).success(function(data){console.log(data),scope.almacenes=data})},scope.cargaItems=function(almacen){busqueda.itemsAlmacen(almacen).success(function(data){scope.items=data})},scope.buscar=function(){console.log(scope.datos),mensajes.alerta("Esto tardará un poco","warning","top right","warning"),null==scope.datos.fechaInicio||null==scope.datos.fechaFinal?mensajes.alerta("Se requiere fecha de inicio y final para generar el reporte","error","top right","error"):(scope.consultando=!0,scope.unidadB=scope.datos.unidad?scope.unidadB:"",scope.almacenB=scope.datos.almacen?scope.almacenB:"",scope.itemB=scope.datos.item?scope.itemB:"",reportes.traspasos(scope.datos).success(function(data){scope.consultando=!1,scope.info=data,data.length>0?(scope.nuevaBusqueda=!1,console.clear()):mensajes.alerta("No se encontro información disponible","error","top right","error")}).error(function(error){scope.info=[],scope.consultando=!1,mensajes.alerta("Ocurrio un error vuelva a intentarlo","error","top right","error")}))},scope.opciones=function(){$mdBottomSheet.show({templateUrl:"views/opcionesReporte.html",controller:"opcionesCtrl",clickOutsideToClose:!0}).then(function(accion){console.log(accion),"Nuevo"==accion.name?scope.inicio():"Editar"==accion.name?scope.nuevaBusqueda=!0:"Exp. Excel"==accion.name?(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportar("traspasos",scope.datos)):"Exp. PDF"==accion.name&&(mensajes.alerta("Preparando Exportación","info","top right","wb_cloudy"),reportes.exportarPDF("traspasos",scope.datos))})},scope.seleccion=function(traspaso,ev){$mdDialog.show({controller:detalleTraspasoCtrl,templateUrl:"views/detalleTraspaso.html",data:traspaso,parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1})}}function detalleTraspasoCtrl($rootScope,$scope,$mdDialog,reportes,data){console.log(data),$scope.detalleTras=data,$scope.cerrarDialogo=function(){$mdDialog.cancel(),$scope.detalleTras=null},$scope.descargaPdf=function(){reportes.traspasoPdf($scope.detalleTras.TRA_codigo)}}angular.module("app").controller("reporteTraspasosCtrl",reporteTraspasosCtrl),reporteTraspasosCtrl.$inject=["$rootScope","busqueda","mensajes","datos","reportes","$mdBottomSheet","$mdDialog"]}(),function(){"use strict";function subTiposItemCtrl($rootScope,$mdDialog,datos,subtipositem,mensajes){0==$rootScope.permisos.PER_tipos&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.tema="theme2",$rootScope.titulo="SubTipos de Item Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevoTipo=function(ev){$mdDialog.show({controller:subTipoItemCtrl,templateUrl:"views/subtipoitem.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=subtipositem.query()})},scope.editaTipo=function(ev,index){var subtipoitem=scope.info[index];$mdDialog.show({controller:subTipoItemEditCtrl,templateUrl:"views/subtipoitem.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:subtipoitem}}).then(function(){scope.info=subtipositem.query()})},scope.confirmacion=function(ev,index){var subtipoitem=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){subtipoitem.STI_activo?subtipoitem.STI_activo=0:subtipoitem.STI_activo=1;var datos={nombre:subtipoitem.STI_nombre,activo:subtipoitem.STI_activo};subtipositem.update({subtipoitem:subtipoitem.STI_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function subTipoItemCtrl($scope,$mdDialog,busqueda,subtipositem,mensajes){$scope.subtipositem=subtipositem.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.subtipoForm.$valid&&($scope.guardando=!0,subtipositem.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.subtipoForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function subTipoItemEditCtrl($scope,$mdDialog,subtipositem,mensajes,informacion,busqueda){console.log(informacion),$scope.inicio=function(){$scope.datos={nombre:informacion.STI_nombre,activo:!!informacion.STI_activo},$scope.guardando=!1},$scope.guardar=function(){$scope.subtipoForm.$valid&&($scope.guardando=!0,subtipositem.update({subtipoitem:informacion.STI_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.subtipoForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("subTipoItemCtrl",subTipoItemCtrl).controller("subTiposItemCtrl",subTiposItemCtrl).controller("subTipoItemEditCtrl",subTipoItemEditCtrl),subTiposItemCtrl.$inject=["$rootScope","$mdDialog","datos","subtipositem","mensajes"],subTipoItemCtrl.$inject=["$scope","$mdDialog","busqueda","subtipositem","mensajes"],subTipoItemEditCtrl.$inject=["$scope","$mdDialog","subtipositem","mensajes","informacion","busqueda"]}(),function(){"use strict";function surtirCtrl($scope,$rootScope,operacion,mensajes,datos,$mdDialog,$stateParams,webStorage,$filter){1==datos.data.OCM_surtida&&($rootScope.ir("index.ordenescompra"),mensajes.alerta("Esta orden ya fue surtida","error","top right","error")),$scope.paso1="views/surtirPaso1.html",$scope.paso2="views/surtirPaso2.html",$scope.paso3="views/surtirPaso3.html",$scope.paso4="views/surtirPaso4.html",$rootScope.tema="theme1",$rootScope.titulo="Surtir Orden",$rootScope.atras=!0,$rootScope.menu="arrow_back",$scope.lotesCompletos=!1,$scope.descripcion=datos.data.PRO_nombrecorto,$scope.costo=datos.data.OCM_importeEsperado,$scope.info=datos.data,$scope.items=datos.data.items;for(var i=0;i<$scope.items.length;i++)$scope.items[i].habilitado=!0;$scope.seleccionItems=[],$scope.lotes=[];var unidad=datos.data.UNI_clave,clave=(datos.data.OCM_almacenes,datos.data.PRO_clave,"orden:"+$stateParams.ordenId);$scope.inicio=function(){$scope.step1block=!1,$scope.step2block=!0,$scope.step3block=!0,$scope.step4block=!0,$scope.todos=!0,$scope.guardando=!1,$scope.inavilitado=!1,$scope.muestra=!1,$scope.selectedIndex=0,$scope.numero=1,angular.forEach($scope.items,function(value,key){$scope.seleccionItems.push(value),$scope.seleccionItems[$scope.numero-1].numerador=$scope.numero,$scope.numero++}),console.log($scope.seleccionItems),$scope.datos={orden:$stateParams.ordenId,guia:"",cajas:0,bultos:0,bolsas:0,verificacion:"",observacionEntrega:"Sin novedad",tipoEntrega:"",observacionesVerificacion:"",surtidos:$scope.seleccionItems,incompleta:!1,total:0,usuario:$rootScope.id,indice:0,items:$scope.items},$scope.aSurtir=1,$scope.total(),$scope.verificaMovimiento(),$scope.prueba=function(num,status){if(console.log(num,status),!$scope.items[num-1].habilitado,1==status)for(var i=0;i<$scope.seleccionItems.length;i++)if($scope.items[num-1].numerador==$scope.seleccionItems[i].numerador){$scope.seleccionItems.splice(i,1);break}0==status&&$scope.seleccionItems.push($scope.items[num-1]),console.log($scope.seleccionItems)}},$scope.verificaMovimiento=function(){if(null==webStorage.local.get(clave))webStorage.local.add(clave,JSON.stringify($scope.datos));else{var datos=JSON.parse(webStorage.local.get(clave));$scope.datos.tipoEntrega=datos.tipoEntrega,$scope.datos.guia=datos.guia,$scope.datos.cajas=datos.cajas,$scope.datos.bultos=datos.bultos,$scope.datos.bolsas=datos.bolsas,$scope.datos.verificacion=datos.verificacion,$scope.datos.observacionEntrega=datos.observacionEntrega,$scope.datos.tipoEntrega=datos.tipoEntrega,$scope.datos.observacionesVerificacion=datos.observacionesVerificacion,$scope.datos.incompleta=datos.incompleta,$scope.datos.total=datos.total,$scope.datos.indice=datos.indice,$scope.selectedIndex=datos.indice,$scope.items=datos.items,$scope.seleccionItems=[],$scope.numero=1,angular.forEach(datos.items,function(value,key){var busqueda=$filter("filter")(datos.surtidos,value);busqueda.length>0&&($scope.seleccionItems.push(value),$scope.seleccionItems[$scope.numero-1].numerador=$scope.numero,$scope.numero++)}),1==datos.indice?$scope.step2block=!1:2==datos.indice?($scope.step2block=!0,$scope.step3block=!1,$scope.seleccionItems=datos.surtidos,$scope.verificaLotes()):3==datos.indice&&($scope.step2block=!0,$scope.step3block=!0,$scope.step4block=!1,$scope.datos.surtidos=datos.surtidos)}},$scope.calculaTotal=function(){console.log($scope.seleccionItems),$scope.total()},$scope.miTotal=function(){},$scope.verificaLotes=function(){$scope.numero=1,angular.forEach($scope.seleccionItems,function(value,key){$scope.seleccionItems[$scope.numero-1].numerador=$scope.numero,0==$scope.seleccionItems[$scope.numero-1].TIT_forzoso&&($scope.seleccionItems[$scope.numero-1].lotes=[{lote:"N/A"}]),$scope.numero++});$scope.seleccionItems.length;$scope.lotesCompletos=!0;for(var i=0;i<$scope.seleccionItems.length;i++)if(void 0==$scope.seleccionItems[i].lotes){$scope.lotesCompletos=!1;break}},$rootScope.reVerificaLote=function(){$scope.verificaLotes()},$scope.siguiente=function(index){0==index?$scope.step2block=!1:1==index?($scope.step3block=!1,$scope.verificaLotes()):2==index&&($scope.seleccionItems.length<$scope.items.length&&($scope.datos.incompleta=!0),$scope.step4block=!1),$scope.selectedIndex=index+1,$scope.datos.indice=index+1,$scope.datos.surtidos=$scope.seleccionItems,$scope.datos.items=$scope.items,webStorage.local.add(clave,JSON.stringify($scope.datos))},$scope.verificaItems=function(){return!($scope.seleccionItems.length>0&&1==$scope.datos.verificacion||$scope.datos.observacionentrega&&2==$scope.datos.verificacion)},$scope.total=function(){return $scope.info.OCM_importeFinal=0,$scope.datos.total=0,angular.forEach($scope.seleccionItems,function(value,key){var costoItem=parseFloat(value.OIT_precioFinal)>0?parseFloat(value.OIT_precioFinal):parseFloat(value.OIT_precioEsperado),cantidadItem=parseFloat(value.OIT_cantidadSurtida)>0?Number(value.OIT_cantidadSurtida):Number(value.OIT_cantidadPedida),totalItem=costoItem*cantidadItem;$scope.info.OCM_importeFinal+=totalItem,$scope.datos.total+=totalItem}),$scope.info.OCM_importeFinal},$scope.agregaLote=function(index,ev){var d=new Date,meses=(d.getFullYear(),new Array);meses[0]="Enero",meses[1]="Febrero",meses[2]="Marzo",meses[3]="Abril",meses[4]="Mayo",meses[5]="Junio",meses[6]="Julio",meses[7]="Agosto",meses[8]="Septiembre",meses[9]="Octubre",meses[10]="Noviembre",meses[11]="Diciembre";var itemSurtido=$scope.seleccionItems[index];$mdDialog.show({controller:lotesCtrl,templateUrl:"views/lotes.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,resolve:{informacion:function(busqueda){return busqueda.lotesUnidadXitem(unidad,itemSurtido.ITE_clave)}},locals:{info:itemSurtido}}).then(function(lotes){itemSurtido.lotes=lotes,$scope.datos.surtidos=$scope.seleccionItems,$scope.datos.items=$scope.items,webStorage.local.add(clave,JSON.stringify($scope.datos)),console.log($scope.datos),$scope.verificaLotes()},function(){$scope.verificaLotes()})},$scope.modifica=function(ev,index){var item=$scope.items[index];$mdDialog.show({controller:modificaCtrl,templateUrl:"views/modifica.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,locals:{info:item}}).then(function(modificacion){console.log(modificacion),modificacion.cantidad<item.OIT_cantidadPedida&&($scope.datos.incompleta=!0),item.OIT_cantidadSurtida=modificacion.cantidad;var idx=$scope.seleccionItems.indexOf(item);idx==-1&&$scope.seleccionItems.push(item),$scope.datos.surtidos=$scope.seleccionItems,$scope.datos.items=$scope.items,$scope.total()},function(){var idx=$scope.seleccionItems.indexOf(item);idx==-1&&$scope.seleccionItems.push(item)})},$scope.surtir=function(){$scope.guardando=!0,console.log($scope.datos),operacion.surtirOrden($scope.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),webStorage.local.remove(clave),$scope.guardando=!1,$scope.surtido=!0,$rootScope.ir("index.ordenescompra")}).error(function(data){$scope.guardando=!1,mensajes.alerta("hubo un error reportalo al area de sistemas","error","top right","error"),$scope.surtido=!0})},$scope.confirmaOrden=function(){operacion.generarOrden($scope.ordenNueva).success(function(data){mensajes.alerta("Orden Generada Correctamente","success","top right","done_all")}).error(function(data){mensajes.alerta("hubo un error intentalo nuevamente","error","top right","error")})}}function modificaCtrl($scope,$mdDialog,info,operacion,mensajes){console.log("function modificaCtrl($scope, $mdDialog, info, operacion, mensajes)"),$scope.inicio=function(){$scope.maximo=Number(info.OIT_cantidadPedida),$scope.datos={cantidad:Number(info.OIT_cantidadPedida),costo:parseFloat(info.OIT_precioEsperado)}},$scope.actualiza=function(){$mdDialog.hide($scope.datos)},$scope.cancel=function(){$mdDialog.cancel()}}function lotesCtrl($scope,$rootScope,$mdDialog,info,operacion,mensajes,informacion,webStorage,surtirCtrl){console.log("function lotesCtrl($scope, $rootScope, $mdDialog, info, operacion, mensajes,informacion, webStorage, surtirCtrl)"),$scope.lotes=info.lotes?info.lotes:[],$scope.maximo=info.OIT_cantidadSurtida>0?info.OIT_cantidadSurtida:info.OIT_cantidadPedida,$scope.lotes.length>0&&angular.forEach($scope.lotes,function(value,key){$scope.maximo-=value.cantidad}),$scope.datosLote=function(lote){if(lote)if(0==lote)$scope.existeLote=!1,$scope.datos.lote="";else{var dato=JSON.parse(lote);$scope.datos.idLote=dato.LOT_clave,$scope.datos.lote=dato.LOT_numero,$scope.datos.caducidad=moment(dato.LOT_caducidad).toDate(),$scope.cantidadLote=dato.LOT_cantidad,$scope.existeLote=!0}},$scope.cambio=function(){var d=new Date($scope.datos.caducidad),month=""+(d.getMonth()+1),day=""+d.getDate(),year=d.getFullYear();month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),$scope.datos.caducidad=year+"-"+month+"-"+day+" 00:00:00",console.log($scope.datos.caducidad)},$scope.inicio=function(){$scope.datos={idLote:"",cantidad:"",lote:"",caducidad:""},informacion.data.length>0?($scope.lotesUnidad=informacion.data,$scope.existeLote=!0):($scope.lotesUnidad=[],$scope.existeLote=!1)},$scope.agrega=function(){$scope.modificaForm.$valid?($scope.maximo-=$scope.datos.cantidad,$scope.lotes.push($scope.datos),$scope.inicio()):mensajes.alerta("Verifica que los datos sean correctos","error","top right","error")},$scope.ingresa=function(){0==$scope.maximo?$mdDialog.hide($scope.lotes):mensajes.alerta("No has ingresado todos los items a lotes","error","top right","error")},$scope.cancel=function(){$mdDialog.cancel()}}angular.module("app").controller("surtirCtrl",surtirCtrl).controller("modificaCtrl",modificaCtrl).controller("lotesCtrl",lotesCtrl),surtirCtrl.$inject=["$scope","$rootScope","operacion","mensajes","datos","$mdDialog","$stateParams","webStorage","$filter"],modificaCtrl.$inject=["$scope","$mdDialog","info","operacion","mensajes"],lotesCtrl.$inject=["$scope","$rootScope","$mdDialog","info","operacion","mensajes","informacion","webStorage"]}(),function(){"use strict";function tiposAlmacenCtrl($rootScope,$mdDialog,datos,tiposalmacen,mensajes){var scope=this;$rootScope.tema="theme3",$rootScope.titulo="Tipos de Almacen Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevo=function(ev){$mdDialog.show({controller:tipoAlmacenCtrl,templateUrl:"views/tipoalmacen.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=tiposalmacen.query()})},scope.edita=function(ev,index){var tipoalmacen=scope.info[index];$mdDialog.show({controller:tipoAlmacenEditCtrl,templateUrl:"views/tipoalmacen.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:tipoalmacen},closeTo:{bottom:1500}}).then(function(){scope.info=tiposalmacen.query()})},scope.confirmacion=function(ev,index){var tipoalmacen=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de almacen?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){tipoalmacen.TAL_activo?tipoalmacen.TAL_activo=0:tipoalmacen.TAL_activo=1;var datos={nombre:tipoalmacen.TAL_nombre,activo:tipoalmacen.TAL_activo};tiposalmacen.update({tipoalmacen:tipoalmacen.TAL_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoAlmacenCtrl($scope,$mdDialog,tiposalmacen,mensajes){$scope.tiposalmacen=tiposalmacen.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoAlmacenForm.$valid&&($scope.guardando=!0,tiposalmacen.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoAlmacenForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoAlmacenEditCtrl($scope,$mdDialog,tiposalmacen,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TAL_nombre,activo:!!informacion.TAL_activo},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoAlmacenForm.$valid&&($scope.guardando=!0,tiposalmacen.update({tipoalmacen:informacion.TAL_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoAlmacenForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("tipoAlmacenCtrl",tipoAlmacenCtrl).controller("tiposAlmacenCtrl",tiposAlmacenCtrl).controller("tipoAlmacenEditCtrl",tipoAlmacenEditCtrl),tiposAlmacenCtrl.$inject=["$rootScope","$mdDialog","datos","tiposalmacen","mensajes"],tipoAlmacenCtrl.$inject=["$scope","$mdDialog","tiposalmacen","mensajes"],tipoAlmacenEditCtrl.$inject=["$scope","$mdDialog","tiposalmacen","mensajes","informacion"]}(),function(){"use strict";function tiposItemCtrl($rootScope,$mdDialog,datos,tipositem,mensajes){var scope=this;$rootScope.tema="theme3",$rootScope.titulo="Tipos de Item Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevoTipo=function(ev){$mdDialog.show({controller:tipoItemCtrl,templateUrl:"views/tipoitem.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=tipositem.query()})},scope.editaTipo=function(ev,index){var tipoitem=scope.info[index];$mdDialog.show({controller:tipoItemEditCtrl,templateUrl:"views/tipoitem.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:tipoitem},closeTo:{bottom:1500}}).then(function(){scope.info=tipositem.query()})},scope.confirmacion=function(ev,index){var tipoitem=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){tipoitem.TIT_activo?tipoitem.TIT_activo=0:tipoitem.TIT_activo=1;var datos={nombre:tipoitem.TIT_nombre,activo:tipoitem.TIT_activo};tipositem.update({tipoitem:tipoitem.TIT_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoItemCtrl($scope,$mdDialog,tipositem,mensajes){$scope.tipositem=tipositem.query(),$scope.inicio=function(){$scope.datos={nombre:"",forzoso:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,tipositem.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoItemEditCtrl($scope,$mdDialog,tipositem,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TIT_nombre,forzoso:!!informacion.TIT_forzoso,activo:!!informacion.TIT_activo},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,tipositem.update({tipoitem:informacion.TIT_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("tipoItemCtrl",tipoItemCtrl).controller("tiposItemCtrl",tiposItemCtrl).controller("tipoItemEditCtrl",tipoItemEditCtrl),tiposItemCtrl.$inject=["$rootScope","$mdDialog","datos","tipositem","mensajes"],tipoItemCtrl.$inject=["$scope","$mdDialog","tipositem","mensajes"],tipoItemEditCtrl.$inject=["$scope","$mdDialog","tipositem","mensajes","informacion"]}(),function(){"use strict";function tiposAjusteCtrl($rootScope,$mdDialog,datos,tiposajuste,mensajes){0==$rootScope.permisos.PER_tipos&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.tema="theme2",$rootScope.titulo="Tipos de Ajuste",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:tipoAjusteCtrl,templateUrl:"views/tipoajuste.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=tiposajuste.query()})},scope.edita=function(ev,index){var tipo=scope.info[index];$mdDialog.show({controller:tipoAjusteEditCtrl,templateUrl:"views/tipoajuste.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:tipo}}).then(function(){scope.info=tiposajuste.query()})},scope.confirmacion=function(ev,index){var tipoajuste=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el tipo de ajuste?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar Tipo Ajuste").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){tipoajuste.TIA_activo?tipoajuste.TIA_activo=0:tipoajuste.TIA_activo=1;var datos={nombre:tipoajuste.TIA_nombre,activo:tipoajuste.TIA_activo};tipoajustes.update({tipo:tipoajuste.TIA_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoAjusteCtrl($scope,$mdDialog,busqueda,tiposajuste,mensajes){$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoAForm.$valid&&($scope.guardando=!0,tiposajuste.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoAForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoAjusteEditCtrl($scope,$mdDialog,tiposajuste,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TIA_nombre,activo:!!informacion.TIA_activo},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoAForm.$valid&&($scope.guardando=!0,tiposajuste.update({tipo:informacion.TIA_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoAForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("tipoAjusteCtrl",tipoAjusteCtrl).controller("tiposAjusteCtrl",tiposAjusteCtrl).controller("tipoAjusteEditCtrl",tipoAjusteEditCtrl),tiposAjusteCtrl.$inject=["$rootScope","$mdDialog","datos","tiposajuste","mensajes"],tipoAjusteCtrl.$inject=["$scope","$mdDialog","busqueda","tiposajuste","mensajes"],tipoAjusteEditCtrl.$inject=["$scope","$mdDialog","tiposajuste","mensajes","informacion"]}(),function(){"use strict";function tiposMovimientoCtrl($rootScope,$mdDialog,datos,tiposmovimiento,mensajes){0==$rootScope.permisos.PER_tipos&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.tema="theme2",$rootScope.titulo="Tipos de Movmiento",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.onPaginationChange=function(page,limit){console.log(page),console.log(limit)},scope.onOrderChange=function(order){console.log(scope.query)},scope.nuevo=function(ev){$mdDialog.show({controller:tipoMovimientoCtrl,templateUrl:"views/tipomovimiento.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=tiposmovimiento.query()})},scope.edita=function(ev,index){var usuario=scope.info[index];$mdDialog.show({controller:tipoMovimientoEditCtrl,templateUrl:"views/tipomovimiento.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario},closeTo:{bottom:1500}}).then(function(){scope.info=tiposmovimiento.query()})},scope.confirmacion=function(ev,index){var tipomovimiento=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el tipo de movimiento?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar Tipo Movimiento").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){tipomovimiento.TIM_activo?tipomovimiento.TIM_activo=0:tipomovimiento.TIM_activo=1;var datos={nombre:tipomovimiento.TIM_nombre,activo:tipomovimiento.TIM_activo};tiposmovimiento.update({tipo:tipomovimiento.TIM_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoMovimientoCtrl($scope,$mdDialog,tiposmovimiento,mensajes){$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoMovForm.$valid&&($scope.guardando=!0,tiposmovimiento.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoMovForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoMovimientoEditCtrl($scope,$mdDialog,tiposmovimiento,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TIM_nombre,activo:!!informacion.TIM_activo},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoMovForm.$valid&&($scope.guardando=!0,tiposmovimiento.update({tipo:informacion.TIM_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoMovForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("tipoMovimientoCtrl",tipoMovimientoCtrl).controller("tiposMovimientoCtrl",tiposMovimientoCtrl).controller("tipoMovimientoEditCtrl",tipoMovimientoEditCtrl),tiposMovimientoCtrl.$inject=["$rootScope","$mdDialog","datos","tiposmovimiento","mensajes"],tipoMovimientoCtrl.$inject=["$scope","$mdDialog","tiposmovimiento","mensajes"],tipoMovimientoEditCtrl.$inject=["$scope","$mdDialog","tiposmovimiento","mensajes","informacion"]}(),function(){"use strict";function tiposOrdenCtrl($rootScope,$mdDialog,datos,tiposorden,mensajes){0==$rootScope.permisos.PER_tipos&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.tema="theme2",$rootScope.titulo="Tipos de Orden Registrados",scope.info=datos,scope.total=0,scope.order="TOR_clave",scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.onOrderChange=function(order){},scope.nuevo=function(ev){$mdDialog.show({controller:tipoOrdenCtrl,templateUrl:"views/tipoorden.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=tiposorden.query()})},scope.edita=function(ev,index){var tipoorden=scope.info[index];$mdDialog.show({controller:tipoOrdenEditCtrl,templateUrl:"views/tipoorden.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:tipoorden}}).then(function(){scope.info=tiposorden.query()})},scope.confirmacion=function(ev,index){var tipoorden=scope.info[index],confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev);$mdDialog.show(confirm).then(function(){tipoorden.TOR_activo?tipoorden.TOR_activo=0:tipoorden.TOR_activo=1;var datos={nombre:tipoorden.TOR_nombre,activo:tipoorden.TOR_activo};tiposorden.update({tipoorden:tipoorden.TOR_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function tipoOrdenCtrl($scope,$mdDialog,tiposorden,mensajes){$scope.tiposorden=tiposorden.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoOrdenForm.$valid&&($scope.guardando=!0,tiposorden.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoOrdenForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function tipoOrdenEditCtrl($scope,$mdDialog,tiposorden,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.TOR_nombre,activo:!!informacion.TOR_activo},$scope.guardando=!1},$scope.guardar=function(){$scope.tipoOrdenForm.$valid&&($scope.guardando=!0,tiposorden.update({tipoorden:informacion.TOR_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.tipoOrdenForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("tipoOrdenCtrl",tipoOrdenCtrl).controller("tiposOrdenCtrl",tiposOrdenCtrl).controller("tipoOrdenEditCtrl",tipoOrdenEditCtrl),tiposOrdenCtrl.$inject=["$rootScope","$mdDialog","datos","tiposorden","mensajes"],tipoOrdenCtrl.$inject=["$scope","$mdDialog","tiposorden","mensajes"],tipoOrdenEditCtrl.$inject=["$scope","$mdDialog","tiposorden","mensajes","informacion"];
}(),function(){"use strict";function traspasoCtrl($scope,$rootScope,$mdDialog,busqueda,operacion,mensajes,datos,$filter,$q,reportes){function consultado(query){var q=$q.defer(),response=query?$filter("filter")($scope.itemsAlmacen,query):$scope.itemsAlmacen;return q.resolve(response),q.promise}0==$rootScope.permisos.PER_traspasos&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home")),$rootScope.tema="theme1",$rootScope.titulo="Nuevo traspaso",$scope.almacenes=datos[0].data,$scope.inicio=function(){$scope.seleccionado=null,$scope.busqueda=null,$scope.consultado=consultado,$scope.item="",$scope.disponible="",$scope.itemsAlmacen=[],$scope.lotes=[],$scope.traspasos=[],$scope.cantidadLote=0,$scope.datos={almacenOrigen:"",almacenDestino:"",item:"",itemNombre:"",cantidad:"",lote:"",usuario:$rootScope.id,obs:"",nombreOrigen:null,nombreDestino:null},console.log($scope.datos),$scope.guardando=!1},$scope.origen=function(origen){$scope.obsOrigen=origen,$scope.datos.obs=$scope.obsOrigen+" a "+$scope.obsDestino,$scope.datos.nombreOrigen=origen,console.log($scope.datos.obs)},$scope.destino=function(destino){$scope.obsDestino=destino,$scope.datos.obs=$scope.obsOrigen+" a "+$scope.obsDestino,$scope.datos.nombreDestino=destino,console.log($scope.datos.obs)},$scope.datosLote=function(lote){if(lote){var dato=JSON.parse(lote);$scope.datos.lote=dato.LOT_clave,$scope.cantidadLote=dato.LOT_cantidad,$scope.verificaCantidadLote()}},$scope.verificaCantidadLote=function(){$scope.cantidadLote>0&&$scope.cantidadLote<$scope.datos.cantidad&&""!=$scope.datos.lote?(mensajes.alerta("El lote solo tiene "+$scope.cantidadLote+" disponible(s)","error","top right","error"),$scope.datos.cantidad=0):0==$scope.cantidadLote&&$scope.datos.cantidad>0&&""!=$scope.datos.lote&&mensajes.alerta("Este lote no tiene cantidad disponible","error","top right","error")},$scope.agregar=function(){$scope.traspasos.push({almacenOrigen:$scope.datos.almacenOrigen,almacenDestino:$scope.datos.almacenDestino,item:$scope.datos.item,itemNombre:$scope.datos.itemNombre,cantidad:$scope.datos.cantidad,lote:$scope.datos.lote,usuario:$rootScope.id,obs:$scope.datos.obs,nombreOrigen:$scope.datos.nombreOrigen,nombreDestino:$scope.datos.nombreDestino}),console.log($scope.traspasos),$scope.datos.item="",$scope.datos.cantidad="",$scope.datos.lote="",$scope.item="",$scope.disponible="",$scope.busqueda=""},$scope.guardar=function(){$scope.guardando=!0,operacion.altaTraspaso($scope.traspasos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.traspasoForm.$setPristine(),$scope.inicio(),reportes.traspasoPdf(data.cveTraspaso)}).error(function(data){mensajes.alerta("Ocurrio un error vuelve a intentarlo","error","top right","error"),$scope.guardando=!1})},$scope.itemsxalmacen=function(clave){$scope.seleccionado=null,$scope.busqueda=null,$scope.disponible="",$scope.itemsAlmacen=[],busqueda.itemsAlmacen(clave).success(function(data){$scope.itemsAlmacen=data})},$scope.eliminar=function(index){console.log(index),$scope.traspasos.splice(index,1)},$scope.seleccionaItem=function(item){$scope.disponible="",console.log(item),item&&($scope.datos.item=item.ITE_clave,$scope.datos.itemNombre=item.ITE_nombre,$scope.disponible=Number(item.EXI_cantidad),busqueda.lotesAlmacenXitem($scope.datos.almacenOrigen,item.ITE_clave).success(function(data){if($scope.lotes=data,"1"==item.TIT_forzoso&&$scope.traspasos.length>0)for(var i=0;i<$scope.traspasos.length;i++)if($scope.traspasos[i].item==$scope.lotes[0].ITE_clave&&$scope.traspasos[i].almacenOrigen==$scope.datos.almacenOrigen){console.log("son iguales"),$scope.disponible=$scope.disponible-$scope.traspasos[i].cantidad;for(var j=0;j<$scope.lotes.length;j++)$scope.lotes[j].LOT_clave==$scope.traspasos[i].lote&&($scope.lotes[j].LOT_cantidad=$scope.lotes[j].LOT_cantidad-$scope.traspasos[i].cantidad)}if("0"==item.TIT_forzoso&&(console.log("este item no tiene lote"),$scope.traspasos.length>0))for(var i=0;i<$scope.traspasos.length;i++)$scope.traspasos[i].item==$scope.datos.item&&$scope.traspasos[i].almacenOrigen==$scope.datos.almacenOrigen&&(console.log("mismo item y mismo origen"),$scope.disponible=$scope.disponible-$scope.traspasos[i].cantidad)}))},$scope.verificaAlmacen=function(ev){$scope.datos.almacenDestino==$scope.datos.almacenOrigen&&(mensajes.alerta("No puedes seleccionar el mismo almacen","error","top right","error"),$scope.datos.almacenDestino="")}}angular.module("app").controller("traspasoCtrl",traspasoCtrl),traspasoCtrl.$inject=["$scope","$rootScope","$mdDialog","busqueda","operacion","mensajes","datos","$filter","$q","reportes"]}(),function(){"use strict";function equivalenciasCtrl($rootScope,$mdDialog,datos,unidadesItem,mensajes){var scope=this;$rootScope.tema="theme3",$rootScope.titulo="Unidades de Item Registrados",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevaUnidad=function(ev){$mdDialog.show({controller:unidadItemCtrl,templateUrl:"views/unidaditem.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){scope.info=unidadesItem.query()})},scope.editaTipo=function(ev,unidaditem){$mdDialog.show({controller:unidadItemEditCtrl,templateUrl:"views/unidaditem.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:unidaditem},closeTo:{bottom:1500}}).then(function(){scope.info=unidadesItem.query()})},scope.confirmacion=function(ev,unidaditem){var confirm=$mdDialog.confirm().title("¿Desactivar el Tipo de item?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar permiso").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){unidaditem.UTI_activo?unidaditem.UTI_activo=0:unidaditem.UTI_activo=1;var datos={nombre:unidaditem.UTI_nombre,activo:unidaditem.UTI_activo};unidadesItem.update({id:unidaditem.UTI_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function unidadItemCtrl($scope,$mdDialog,unidadesItem,mensajes){$scope.unidadesItem=unidadesItem.query(),$scope.inicio=function(){$scope.datos={nombre:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,unidadesItem.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function unidadItemEditCtrl($scope,$mdDialog,unidadesItem,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.UTI_nombre,activo:!!informacion.UTI_activo},$scope.guardando=!1},$scope.guardar=function(){$scope.perfilForm.$valid&&($scope.guardando=!0,unidadesItem.update({id:informacion.UTI_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.perfilForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("unidadItemCtrl",unidadItemCtrl).controller("equivalenciasCtrl",equivalenciasCtrl).controller("unidadItemEditCtrl",unidadItemEditCtrl),equivalenciasCtrl.$inject=["$rootScope","$mdDialog","datos","unidadesItem","mensajes"],unidadItemCtrl.$inject=["$scope","$mdDialog","unidadesItem","mensajes"],unidadItemEditCtrl.$inject=["$scope","$mdDialog","unidadesItem","mensajes","informacion"]}(),function(){"use strict";function unidadesCtrl($rootScope,$mdDialog,datos,unidades,mensajes){var scope=this;$rootScope.tema="theme3",$rootScope.titulo="Unidades Registradas",scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Tipos por pagina:",of:"de"},scope.paginacion=[10,20,30,40],scope.nuevo=function(ev){$mdDialog.show({controller:unidadCtrl,templateUrl:"views/unidad.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=unidades.query()})},scope.edita=function(ev,unidad){$mdDialog.show({controller:unidadEditCtrl,templateUrl:"views/unidad.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:unidad},closeTo:{bottom:1500}}).then(function(){scope.info=unidades.query()})},scope.confirmacion=function(ev,unidad){var confirm=$mdDialog.confirm().title("¿Desactivar la Unidad?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar unidad").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){unidad.UNI_activo?unidad.UNI_activo=0:unidad.UNI_activo=1;var datos={nombre:unidad.UNI_nombre,nombrecorto:unidad.UNI_nombrecorto,correo:unidad.UNI_correo,activo:unidad.UNI_activo};unidades.update({unidad:unidad.UNI_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function unidadCtrl($scope,$mdDialog,unidades,mensajes){$scope.unidades=unidades.query(),$scope.inicio=function(){$scope.datos={nombre:"",nombrecorto:"",responsable:"",horaentrega:"",direccion:"",correo:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.unidadForm.$valid&&($scope.guardando=!0,unidades.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.unidadForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function unidadEditCtrl($scope,$mdDialog,unidades,mensajes,informacion){$scope.inicio=function(){$scope.datos={nombre:informacion.UNI_nombre,nombrecorto:informacion.UNI_nombrecorto,correo:informacion.UNI_correo,responsable:informacion.UNI_responsable,horaentrega:informacion.UNI_horaentrega,direccion:informacion.UNI_direccion,activo:!!informacion.UNI_activo},$scope.guardando=!1},$scope.guardar=function(){$scope.unidadForm.$valid&&($scope.guardando=!0,unidades.update({unidad:informacion.UNI_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.unidadForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("unidadCtrl",unidadCtrl).controller("unidadesCtrl",unidadesCtrl).controller("unidadEditCtrl",unidadEditCtrl),unidadesCtrl.$inject=["$rootScope","$mdDialog","datos","unidades","mensajes"],unidadCtrl.$inject=["$scope","$mdDialog","unidades","mensajes"],unidadEditCtrl.$inject=["$scope","$mdDialog","unidades","mensajes","informacion"]}(),function(){"use strict";function usualmCtrl($rootScope,datos,$mdDialog,busqueda,operacion){var scope=this;$rootScope.titulo="Registro de Usuario en almacen",$rootScope.cargando=!1,$rootScope.atras=!0,$rootScope.menu="arrow_back",$rootScope.tema="theme1",scope.inicio=function(){scope.total=0,scope.limit=10,scope.page=1,scope.usuarios=datos[0].data},scope.nuevo=function(ev,index){var usuario=scope.usuarios[index];$mdDialog.show({controller:nuevoUsualmCtrl,templateUrl:"views/almacenusuario.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1,locals:{informacion:usuario}}).then(function(){busqueda.usuariosAlmacen().success(function(data){scope.usuarios=data})})},scope.confirma=function(ev,usuario,almacen){var confirm=$mdDialog.confirm().title("¿Seguro que deseas asignar este almacen?").textContent("").ariaLabel("Asignar Almacen").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){operacion.bajaAlmacen(almacen.ALM_clave,usuario.clave)},function(){busqueda.usuariosAlmacen().success(function(data){scope.usuarios=data})})}}function nuevoUsualmCtrl($stateParams,busqueda,mensajes,$q,$filter,datos,operacion,$rootScope,$mdDialog){var vm=this;console.log(datos),vm.usuarios=datos[0].data,$rootScope.titulo="Registro de Usuario en almacen",$rootScope.cargando=!1,$rootScope.atras=!0,$rootScope.menu="arrow_back",vm.inicio=function(){vm.seleccionado=null,vm.busqueda=null,vm.almacenesSeleccionados=[],vm.almacenesActivos=[],vm.datos={usuario:$stateParams.usuario,usuarioasigno:$rootScope.id,almacenes:vm.almacenesSeleccionados},vm.consultaAlmacen=!1,vm.selectedAll=!1,vm.guardando=!1,vm.almacenesUsuario($stateParams.usuario)},vm.agregaAlmacen=function(almacen){if(almacen.seleccionado=!almacen.seleccionado,almacen.seleccionado)vm.almacenesSeleccionados.push(almacen);else{var index=vm.almacenesSeleccionados.indexOf(almacen);vm.almacenesSeleccionados.splice(1,index)}},vm.almacenesUsuario=function(usuario){usuario&&(vm.consultaAlmacen=!0,vm.almacenesActivos=[],busqueda.almacenesUsuario(usuario).then(function(datos){vm.almacenesActivos=datos.data}),busqueda.almacenUsuario(usuario).then(function(info){vm.almacenes=info.data,vm.consultaAlmacen=!1}))},vm.seleccionaTodo=function(){console.log(vm.selectedAll),vm.selectedAll?vm.datos.almacenes=[]:vm.datos.almacenes=vm.almacenes,angular.forEach(vm.almacenes,function(almacen){almacen.seleccionado=!vm.selectedAll})},vm.guardar=function(){vm.guardando=!0,operacion.altaAlmacenes(vm.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),vm.guardando=!1,vm.inicio()}).error(function(error){mensajes.alerta("Ocurrio un error de conexión intentalo nuevamente","error","top right","error")})},vm.confirma=function(ev,almacen){var confirm=$mdDialog.confirm().title("¿Seguro que deseas asignar este almacen?").textContent("").ariaLabel("Quitar Almacen").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){operacion.bajaAlmacen(almacen.ALM_clave,vm.datos.usuario).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),vm.inicio()}).error(function(error){})},function(){})}}angular.module("app").controller("usualmCtrl",usualmCtrl).controller("nuevoUsualmCtrl",nuevoUsualmCtrl),usualmCtrl.$inject=["$rootScope","datos","$mdDialog","busqueda","operacion"],nuevoUsualmCtrl.$inject=["$stateParams","busqueda","mensajes","$q","$filter","datos","operacion","$rootScope","$mdDialog"]}(),function(){"use strict";function usuariosCtrl($rootScope,$mdDialog,datos,usuarios,mensajes){0==$rootScope.permisos.PER_usuarios&&(console.clear(),console.error("No tiene permiso para estar en esta sección"),$rootScope.ir("index.home"));var scope=this;$rootScope.tema="theme2",$rootScope.titulo="Usuarios Registrados",scope.info=datos,scope.info=datos,scope.total=0,scope.limit=10,scope.page=1,scope.texto={text:"Usuarios por pagina:",of:"de"},scope.paginacion=[10,20,30,40,50],scope.nuevoUsuario=function(ev){$mdDialog.show({controller:usuarioCtrl,templateUrl:"views/usuario.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(){scope.info=usuarios.query()})},scope.editaUsuario=function(ev,usuario){$mdDialog.show({controller:usuarioEditCtrl,templateUrl:"views/usuarioEdicion.html",parent:angular.element(document.body),targetEvent:ev,locals:{informacion:usuario},clickOutsideToClose:!0,closeTo:{bottom:1500}}).then(function(){scope.info=usuarios.query()})},scope.confirmacion=function(ev,usuario){var confirm=$mdDialog.confirm().title("¿Desactivar el usuario?").content("Puedes activarlo cuando lo necesites nuevamente").ariaLabel("Desactivar usuario").ok("Si").cancel("No").targetEvent(ev).closeTo({bottom:1500});$mdDialog.show(confirm).then(function(){usuario.USU_activo?usuario.USU_activo=0:usuario.USU_activo=1;var datos={nombre:usuario.USU_nombrecompleto,usuario:usuario.USU_login,perfil:usuario.PER_clave,activo:usuario.USU_activo};usuarios.update({usuario:usuario.USU_clave},datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all")})})}}function usuarioCtrl($scope,$mdDialog,permisos,usuarios,mensajes){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:"",usuario:"",psw:"",psw2:"",perfil:"",activo:!0},$scope.guardando=!1},$scope.guardar=function(){$scope.usuarioForm.$valid&&($scope.guardando=!0,usuarios.save($scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.usuarioForm.$setPristine(),$scope.inicio()}))},$scope.cancel=function(){$mdDialog.hide()}}function usuarioEditCtrl($scope,$mdDialog,usuarios,mensajes,informacion,permisos){$scope.permisos=permisos.query(),$scope.inicio=function(){$scope.datos={nombre:informacion.USU_nombrecompleto,usuario:informacion.USU_login,psw:"",psw2:"",perfil:informacion.PER_clave,activo:!!informacion.USU_activo},$scope.nuevopsw=!1,$scope.guardando=!1},$scope.guardar=function(){$scope.usuarioForm.$valid&&($scope.guardando=!0,usuarios.update({usuario:informacion.USU_clave},$scope.datos,function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),$scope.guardando=!1,$scope.usuarioForm.$setPristine()}))},$scope.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("usuarioCtrl",usuarioCtrl).controller("usuariosCtrl",usuariosCtrl).controller("usuarioEditCtrl",usuarioEditCtrl),usuariosCtrl.$inject=["$rootScope","$mdDialog","datos","usuarios","mensajes"],usuarioCtrl.$inject=["$scope","$mdDialog","permisos","usuarios","mensajes"],usuarioEditCtrl.$inject=["$scope","$mdDialog","usuarios","mensajes","informacion","permisos"]}(),function(){"use strict";angular.module("app").directive("dragEnd",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,modelCtrl){var functionToCall=scope.$eval(attrs.dragEnd);element.on("$md.dragend",function(){functionToCall(modelCtrl.$viewValue)}),element.on("click",function(){functionToCall(modelCtrl.$viewValue)})}}})}(),function(){"use strict";angular.module("app").directive("backButton",["$window",function($window){return{restrict:"A",link:function(scope,elem){elem.bind("click",function(){$window.history.back()})}}}])}(),function(){"use strict";angular.module("app").directive("folio",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,modelCtrl){var rellenaFolio=function(folio){if(""!==folio){var totalletras=folio.length,letras=folio.substr(0,4),numeros=folio.substr(4,totalletras);if(letras.length<4)for(var faltantes=4-letras.length,i=0;i<faltantes;i++){letras.charAt(i);letras+="0"}if(numeros.length<6)for(var faltantes=6-numeros.length,i=0;i<faltantes;i++)numeros="0"+numeros;return folio=letras+numeros}return folio};element.on("blur",function(){if(modelCtrl.$modelValue.length>3){var nuevo=rellenaFolio(modelCtrl.$modelValue);modelCtrl.$setViewValue(nuevo.toUpperCase()),modelCtrl.$render(),scope.$apply()}}),element.on("keydown",function(e){if(modelCtrl.$modelValue){var cantidad=modelCtrl.$modelValue.length;if(cantidad<4)e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105?e.preventDefault():element.css("text-transform","uppercase");else if(cantidad>3&&cantidad<10){if(e.keyCode>=65&&e.keyCode<=90)e.preventDefault();else if(13==e.keyCode){var nuevo=rellenaFolio(modelCtrl.$modelValue);modelCtrl.$setViewValue(nuevo.toUpperCase()),modelCtrl.$render(),scope.$apply()}}else(e.keyCode>=65&&e.keyCode<=90||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105)&&e.preventDefault()}})}}})}(),function(){"use strict";angular.module("app").directive("mayusculas",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){element.bind("blur",function(){var inputValue=modelCtrl.$modelValue;if(inputValue){var capitalized=inputValue.toUpperCase();capitalized!==inputValue&&(modelCtrl.$setViewValue(capitalized),modelCtrl.$render())}}),element.css("text-transform","uppercase")}}})}(),function(){"use strict";angular.module("app").directive("dinero",function(){function link(scope,el,attrs,ngModelCtrl){function round(num){var d=Math.pow(10,precision);return Math.round(num*d)/d}function formatPrecision(value){return parseFloat(value).toFixed(precision)}function formatViewValue(value){return ngModelCtrl.$isEmpty(value)?"":""+value}var lastValidValue,min=parseFloat(attrs.min||0),precision=parseFloat(attrs.precision||2);ngModelCtrl.$parsers.push(function(value){0===value.indexOf(".")&&(value="0"+value),0===value.indexOf("-")&&(min>=0?(value=null,ngModelCtrl.$setViewValue(""),ngModelCtrl.$render()):"-"===value&&(value=""));var empty=ngModelCtrl.$isEmpty(value);return empty||NUMBER_REGEXP.test(value)?lastValidValue=""===value?null:empty?value:parseFloat(value):(ngModelCtrl.$setViewValue(formatViewValue(lastValidValue)),ngModelCtrl.$render()),ngModelCtrl.$setValidity("number",!0),lastValidValue}),ngModelCtrl.$formatters.push(formatViewValue);var minValidator=function(value){return!ngModelCtrl.$isEmpty(value)&&value<min?void ngModelCtrl.$setValidity("min",!1):(ngModelCtrl.$setValidity("min",!0),value)};if(ngModelCtrl.$parsers.push(minValidator),ngModelCtrl.$formatters.push(minValidator),attrs.max){var max=parseFloat(attrs.max),maxValidator=function(value){return!ngModelCtrl.$isEmpty(value)&&value>max?void ngModelCtrl.$setValidity("max",!1):(ngModelCtrl.$setValidity("max",!0),value)};ngModelCtrl.$parsers.push(maxValidator),ngModelCtrl.$formatters.push(maxValidator)}precision>-1&&(ngModelCtrl.$parsers.push(function(value){return value?round(value):value}),ngModelCtrl.$formatters.push(function(value){return value?formatPrecision(value):value})),el.bind("blur",function(){var value=ngModelCtrl.$modelValue;value&&(ngModelCtrl.$viewValue=formatPrecision(value),ngModelCtrl.$render())})}var NUMBER_REGEXP=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;return{restrict:"A",require:"ngModel",link:link}})}(),function(){"use strict";angular.module("app").directive("numero",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,modelCtrl){element.on("keydown",function(e){(e.keyCode>=65&&e.keyCode<=90||110==e.keyCode||190==e.keyCode||189==e.keyCode)&&e.preventDefault()})}}})}(),function(){"use strict";angular.module("app").filter("string",function(){return function(items,text){}})}(),function(){"use strict";function almacenes($resource,api){var Almacen=$resource(api+"almacenes/:almacen",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return Almacen}angular.module("app").factory("almacenes",almacenes)}(),function(){"use strict";function archivos($http,api,Upload,$q,$rootScope){return{items:function(archivos,clave){for(var promesa=$q.defer(),imagenes=[],i=0;i<archivos.length;i++)Upload.upload({url:api+"upload/items",fields:{clave:clave},file:archivos[i]}).progress(function(evt){var progressPercentage=parseInt(100*evt.loaded/evt.total);promesa.notify(progressPercentage),console.log("progress: "+progressPercentage+"% "+evt.config.file.name)}).success(function(data,status,headers,config){imagenes.push(data),console.log("file "+config.file.name+"uploaded. Response: "+data)}).error(function(data,status,headers,config){promesa.reject(data),console.log("error status: "+status)});return $q.when(imagenes).then(function(data){promesa.resolve("Imagenes subidas correctamente")}),promesa.promise},eliminaItem:function(imagen,clave,tipo){return $http.post(api+"delete",{imagen:imagen,item:clave})},proveedores:function(archivos,clave){for(var promesa=$q.defer(),imagenes=[],i=0;i<archivos.length;i++)Upload.upload({url:api+"upload/proveedores",fields:{clave:clave},file:archivos[i]}).progress(function(evt){var progressPercentage=parseInt(100*evt.loaded/evt.total);promesa.notify(progressPercentage),console.log("progress: "+progressPercentage+"% "+evt.config.file.name)}).success(function(data,status,headers,config){imagenes.push(data),console.log("file "+config.file.name+"uploaded. Response: "+data)}).error(function(data,status,headers,config){promesa.reject(data),console.log("error status: "+status)});return $q.when(imagenes).then(function(data){promesa.resolve("Imagenes subidas correctamente")}),promesa.promise},subeArchivo:function(archivo){var promesa=$q.defer();return Upload.upload({url:api+"operacion/importacion",fields:{usuario:$rootScope.id},file:archivo}).progress(function(evt){var progressPercentage=parseInt(100*evt.loaded/evt.total);promesa.notify(progressPercentage)}).success(function(data,status,headers,config){promesa.resolve(data)}).error(function(data,status,headers,config){promesa.reject(data)}),promesa.promise}}}angular.module("app").factory("archivos",archivos)}(),function(){"use strict";function auth($http,api,$state,webStorage,$rootScope,mensajes){return{login:function(credenciales){$http.post(api+"login",credenciales).success(function(data){if(data.unidades.length<1)mensajes.alerta("No tiene almacenes asignados","error","top right","warning"),$rootScope.cargando=!1;else{$rootScope.cargando=!1,webStorage.session.add("username",data.USU_login),webStorage.session.add("nombre",data.USU_nombrecompleto),webStorage.session.add("id",data.USU_clave),$rootScope.username=webStorage.session.get("username"),$rootScope.nombre=webStorage.session.get("nombre"),$rootScope.id=webStorage.session.get("id"),webStorage.session.add("permisos",JSON.stringify(data)),$rootScope.permisos=data;for(var clinicas=data.unidades,cantidad=clinicas.length,unidades="",i=0;i<cantidad;i++)i>0&&(unidades+=","),unidades=unidades+""+clinicas[i].UNI_clave;webStorage.session.add("unidades",unidades),$rootScope.unidadesAdmin=webStorage.session.get("unidades"),credenciales.guardar&&webStorage.local.add("usuario",JSON.stringify(data)),$state.go("index.home")}}).error(function(data){webStorage.clear(),localStorage.clear(),data?mensajes.alerta(data.flash,"error center-dialog","top","error"):mensajes.alerta("Error en conexión intentalo nuevamente","error center-dialog","top","error"),$rootScope.cargando=!1})},logout:function(){webStorage.clear(),localStorage.clear(),$rootScope.unidadesAdmin=null,$http.get(api+"logout"),$state.go("login")},verify:function(url){return("index.usuarios"!=url||0!=$rootScope.permisos.PER_usuarios)&&("index.usuarios"!=url||0!=$rootScope.permisos.PER_usuarios||void 0)}}}angular.module("app").factory("auth",auth)}(),function(){"use strict";function busqueda($http,api){return{almacenes:function(){return $http.get(api+"busquedas/almacenes")},almacenesUsuario:function(usuario){return $http.get(api+"busquedas/almacenes/"+usuario)},almacenUsuario:function(usuario){return $http.get(api+"busquedas/almacen/"+usuario)},almacenesUnidad:function(unidad){return $http.get(api+"busquedas/almacenes/unidad/"+unidad)},configuracion:function(unidad){return $http.get(api+"operacion/configuracion/unidad/"+unidad)},existencias:function(usuario){return $http.get(api+"busquedas/existencias/"+usuario)},items:function(){return $http.get(api+"busquedas/items")},itemsAlmacen:function(almacen){return $http.get(api+"busquedas/items/existencias/"+almacen)},itemsAlmacenReceta:function(almacen){return $http.get(api+"busquedas/items/existencias/"+almacen)},itemsProveedor:function(){return $http.get(api+"busquedas/items/proveedor")},itemsReceta:function(){return $http.get(api+"busquedas/items/receta")},itemsRecetaSurtidas:function(receta){return $http.get(api+"busquedas/items/receta/"+receta)},itemsUnidad:function(unidad){return $http.get(api+"operacion/items/unidad/"+unidad)},itemsAgranel:function(){return $http.get(api+"busquedas/items/agranel")},itemAlmacen:function(almacen,item){return $http.get(api+"busquedas/item/existencia/"+almacen+"/"+item)},itemUnidad:function(item,unidad){return $http.get(api+"busquedas/item/unidad/"+item+"/"+unidad)},lote:function(lote){return $http.get(api+"busquedas/lote/"+lote)},lotesAlmacenXitem:function(almacen,item){return $http.get(api+"busquedas/lotes/almacen/"+almacen+"/item/"+item)},lotesUnidadXitem:function(unidad,item){return $http.get(api+"busquedas/lotes/unidad/"+unidad+"/item/"+item)},movimientos:function(){return $http.get(api+"busquedas/movimientos")},movimientosAgranel:function(){return $http.get(api+"busquedas/movimientos/agranel")},ordenescompra:function(unidades){return $http.get(api+"busquedas/ordenescompra/"+unidades)},detalleOrdenCompra:function(id){return $http.get(api+"busquedas/ordencompra/"+id)},tiposAjuste:function(){return $http.get(api+"busquedas/tiposajuste")},tiposAlmacen:function(){return $http.get(api+"busquedas/tiposalmacen")},tiposItem:function(){return $http.get(api+"busquedas/tipositem")},tiposMovimiento:function(){return $http.get(api+"busquedas/tiposmovimiento")},SubTiposItem:function(){return $http.get(api+"busquedas/subtipositem")},perfiles:function(){return $http.get(api+"busquedas/permisos")},presentaciones:function(){return $http.get(api+"busquedas/presentaciones")},proveedores:function(){return $http.get(api+"busquedas/proveedores")},proveedoresItems:function(items){return $http.post(api+"operacion/proveedores/items",items)},receta:function(receta){return $http.get(api+"busquedas/receta/"+receta)},unidades:function(){return $http.get(api+"busquedas/unidades")},usuarios:function(){return $http.get(api+"busquedas/usuarios")},unidadesItem:function(){return $http.get(api+"busquedas/unidadesItem")},unidadesUsuario:function(usuario){return $http.get(api+"busquedas/unidades/usuario/"+usuario)},usuariosAlmacen:function(){return $http.get(api+"operacion/usuarios/almacen")},consultaPrueba:function(){return $http.get(api+"busquedas/proveedores")},consultaPrueba:function(){return $http.get(api+"busquedas/caducidad")},prueba2:function(){return $http.get(api+"segundaprueba")},inicial:function(unidades){return $http.get(api+"busquedas/inicial/"+unidades)},cunsultaCaducados:function(unidades){return $http.get(api+"busquedas/inicial/porCaducar/"+unidades)},cunsultaApartados:function(unidades){return $http.get(api+"busquedas/inicial/porSurtirDetalles/"+unidades)},consultaOrdenesAbiertas:function(unidades){return $http.get(api+"reportes/ordenesAbiertas/"+unidades)},detalleOrdenAbierta:function(idOrden){return $http.get(api+"reportes/detalleOrden/"+idOrden)}}}angular.module("app").factory("busqueda",busqueda)}(),function(){"use strict";function testInterceptor($q,$rootScope){return{request:function(config){return config},requestError:function(config){return config},response:function(res){return res},responseError:function(res){return res}}}angular.module("app").factory("testInterceptor",testInterceptor)}(),function(){"use strict";function items($resource,api){var Item=$resource(api+"items/:item",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"},remove:{method:"DELETE"}});return Item}angular.module("app").factory("items",items)}(),function(){"use strict";function mensajes($mdToast,$mdDialog,$q){return{confirmacion:function(titulo,mensaje,ev){var confirm=$mdDialog.confirm().title(titulo).content(mensaje).ariaLabel("Confirmación").targetEvent(ev).ok("SI").cancel("NO");$mdDialog.show(confirm).then(function(){return!0},function(){return!1})},notifica:function(mensaje,descripcion,ev){$mdDialog.show($mdDialog.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(mensaje).content(descripcion).ariaLabel(mensaje).ok("OK").targetEvent(ev))},alerta:function(mensaje,tipo,posicion,icono){$mdToast.show({template:'<md-toast class="'+tipo+'"> <md-icon class="padding-right"> <ng-md-icon icon="'+icono+'" style="fill:white"></ng-md-icon></md-icon> <span flex>'+mensaje+"</span></md-toast>",hideDelay:4e3,position:posicion})},popup:function(mensaje){}}}angular.module("app").factory("mensajes",mensajes)}(),function(){"use strict";function operacion($http,api,$q,busqueda,$rootScope,$filter){return{actualizaConfiguracion:function(id,datos){return $http.put(api+"operacion/configuraciones/"+id,datos)},actualizaItempro:function(datos){return $http.put(api+"operacion/item/proveedor",datos)},ajusteLote:function(datos){return $http.post(api+"operacion/ajuste-lote",datos)},altaAlmacenes:function(datos){return $http.post(api+"operacion/usuario/almacenes",datos)},altaConfiguracion:function(datos){return $http.post(api+"operacion/configuraciones",datos)},altaItempro:function(datos){return $http.post(api+"operacion/item/proveedor",datos)},altaMovimiento:function(datos){return $http.post(api+"operacion/movimiento",datos)},altaMovimientos:function(datos){
return $http.post(api+"operacion/movimientos",datos)},altaTraspaso:function(datos){return $http.post(api+"operacion/traspaso",datos)},bajaAlmacen:function(almacen,usuario){return $http.get(api+"operacion/elimina/almacen/"+almacen+"/"+usuario)},cambiaItem:function(datos){var defer=$q.defer(),item=datos.item,almacen=datos.almacen;return $http.get(api+"busquedas/item/existencia/"+almacen+"/"+item).then(function(data){var existenciaItem=data.data;0==existenciaItem.EXI_cantidad||0==existenciaItem.length?defer.reject("No hay Stock disponible de este item intenta generar traspasos del almacen principal"):defer.resolve(existenciaItem)})["catch"](function(error){defer.reject("Existio un error de conexion intentalo nuevamente")}),defer.promise},cancelarItem:function(datos){return $http.post(api+"operacion/cancelar/item/"+$rootScope.id,datos)},cancelarOrden:function(datos){return $http.post(api+"operacion/cancelarorden",datos)},cerrarOrden:function(datos){return $http.post(api+"operacion/cerrarorden",datos)},cambioXproveedor:function(poveedor,item,items){var datos,promesa=$q.defer(),respuesta=[],totalActual=0;datos=$filter("filter")(items,item);var cantidad=datos[0].porsurtir,proveedorCambio=datos.indexOf(poveedor);return angular.forEach(datos,function(value,key){respuesta.push(value),totalActual+=value.cantidad}),$q.when(respuesta).then(function(data){if(totalActual>cantidad){alert("Te pasaste de la cantidad a surtir");var valorDeMas=totalActual-cantidad,valorActual=items[proveedorCambio].cantidad;items[proveedorCambio].cantidad=valorActual-valorDeMas}else promesa.resolve(items)}),promesa.promise},correo:function(datos){return $http.post(api+"operacion/correo",datos)},completaOrden:function(datos){return $http.post(api+"operacion/completa/orden",datos)},economicoXitem:function(item,items){var datos,promesa=$q.defer(),respuesta=[];datos=$filter("filter")(items,item);var cantidad=datos[0].porsurtir;datos.length;return angular.forEach(datos,function(value,key){var id=items.indexOf(value);0==key?(1==value.ITE_segmentable&&(cantidad=parseInt(value.porsurtir/value.ITE_cantidadCaja)),items[id].cantidad=cantidad):items[id].cantidad=0,respuesta.push(id)}),$q.when(respuesta).then(function(data){promesa.resolve(items)}),promesa.promise},eliminaItempro:function(datos){return $http["delete"](api+"operacion/item/proveedor",datos)},eliminaOrden:function(proveedor,catalogo){var items;$q.defer();items=$filter("filter")(catalogo,proveedor),angular.forEach(items,function(value,key){var id=catalogo.indexOf(value);catalogo.splice(id,1)})},generaCantidades:function(items){var promesa=$q.defer(),seleccionOrden=[];return angular.forEach(items,function(value,key){var cantidad=value.Cantidad,proveedores=value.proveedores.length,segmentable=value.proveedores[0].ITE_segmentable,cantidadCaja=value.proveedores[0].ITE_cantidadCaja;1==segmentable&&(cantidad=parseInt(cantidad/cantidadCaja));var cantidadProporcionada=parseInt(cantidad/proveedores),cantidadSegunProporcion=cantidadProporcionada*proveedores,diferencia=cantidad-cantidadSegunProporcion;angular.forEach(value.proveedores,function(value,key){console.log(value),0==key?value.cantidad=cantidadProporcionada+diferencia:value.cantidad=cantidadProporcionada,seleccionOrden.push(value)})}),$q.when(seleccionOrden).then(function(data){promesa.resolve(data)}),promesa.promise},generaMasBarato:function(items){var promesa=$q.defer(),seleccionOrden=[];return angular.forEach(items,function(value,key){console.log(value);var cantidad=value.Cantidad,segmentable=value.proveedores[0].ITE_segmentable,cantidadCaja=value.proveedores[0].ITE_cantidadCaja;1==segmentable&&(cantidad=parseInt(cantidad/cantidadCaja)),angular.forEach(value.proveedores,function(value,key){0==key?(value.cantidad=cantidad,seleccionOrden.push(value)):(value.cantidad=0,seleccionOrden.push(value))})}),$q.when(seleccionOrden).then(function(data){promesa.resolve(data)}),promesa.promise},ordenXproveedor:function(proveedor,unidad,almacenes,catalogo){var items,promesa=$q.defer(),ordenes=[];items=$filter("filter")(catalogo,proveedor);var proveedorClave=items[0].PRO_clave,total=0,itemsproveedor=[];return angular.forEach(items,function(value,key){if(1==value.ITE_segmentable){var cantidad=value.cantidad*value.ITE_cantidadCaja*value.IPR_ultimoCosto;value.cantidad=value.cantidad*value.ITE_cantidadCaja}else var cantidad=value.cantidad*value.IPR_ultimoCosto;total+=cantidad,itemsproveedor.push(value);var id=catalogo.indexOf(value);catalogo.splice(id,1)}),$q.when(itemsproveedor).then(function(data){var preorden={proveedor:proveedorClave,items:itemsproveedor,total:total,tipo:1,usuario:$rootScope.id,unidad:unidad,almacenes:almacenes};ordenes.push(preorden),$http.post(api+"operacion/ordencompra",ordenes).success(function(datos){promesa.resolve(datos)}).error(function(data){promesa.reject("Se encontro un error intentalo nuevamente")})}),promesa.promise},generarOrden:function(datos){return $http.post(api+"operacion/ordencompra",datos)},generaOrdenes:function(items,proveedores,unidad,almacenes){var promesa=$q.defer(),ordenes=[];return angular.forEach(proveedores,function(value,key){var proveedor=value,total=0,itemsproveedor=[];if(angular.forEach(items,function(value,key){var item=value;if(proveedor==value.PRO_clave){if(1==item.ITE_segmentable)var cantidad=value.cantidad*value.ITE_cantidadCaja*value.IPR_ultimoCosto;else var cantidad=value.cantidad*value.IPR_ultimoCosto;total+=cantidad,itemsproveedor.push(value)}}),itemsproveedor.length>0){var preorden={proveedor:proveedor,items:itemsproveedor,total:total,tipo:1,usuario:$rootScope.id,unidad:unidad,almacenes:almacenes};ordenes.push(preorden)}}),$q.when(ordenes).then(function(data){$http.post(api+"operacion/ordencompra",data).success(function(datos){promesa.resolve(datos)}).error(function(data){promesa.reject("Se encontro un error intentalo nuevamente")})}),promesa.promise},generaTotales:function(items,proveedor){var promesa=$q.defer(),seleccionOrden=[],total=0;return angular.forEach(items,function(value,key){var cantidad=value.cantidad;value.PRO_nombre==proveedor&&(seleccionOrden.push(value),total+=cantidad)}),$q.when(seleccionOrden).then(function(data){promesa.resolve(total)}),promesa.promise},generaDetalleOrdenes:function(ordenes){var promesa=$q.defer(),promesas=[];return angular.forEach(ordenes,function(value,key){var dato=busqueda.detalleOrdenCompra(value);promesas.push(dato)}),$q.all(promesas).then(function(datos){promesa.resolve(datos)}),promesa.promise},itemsAlmacenes:function(unidad,almacenes){return $http.post(api+"operacion/items/almacenes/"+unidad,almacenes)},infoUnidad:function(unidad){var promesa=$q.defer(),almacenes=busqueda.almacenesUnidad(unidad),items=busqueda.itemsUnidad(unidad);return $q.all([almacenes,items]).then(function(data){promesa.resolve(data)},function(error){console.log(error);var msg;msg=error.data.respuesta?error.data.respuesta:"Hubo un problema favor de reintentarlo",promesa.reject(msg)}),promesa.promise},preparaOrden:function(items){var promesa=$q.defer(),proveedores=[],seleccionOrden=[];return $http.post(api+"operacion/proveedores/items",items).success(function(data){var info=data;angular.forEach(data,function(value,key){var cantidad=value.Cantidad,nivelcompra=value.CON_nivelCompra,existenciaitem=value.EXI_cantidad;angular.forEach(value.proveedores,function(value,key){var existencia=proveedores.indexOf(value.PRO_clave);if(existencia==-1&&proveedores.push(value.PRO_clave),value.porsurtir=cantidad,value.nivelcompra=nivelcompra,value.existencia=existenciaitem,0==key){if(1==value.ITE_segmentable){var caja=Number(cantidad)/Number(value.ITE_cantidadCaja);value.cantidad=Number(caja.toFixed())}else value.cantidad=Number(cantidad);seleccionOrden.push(value)}else value.cantidad=0,seleccionOrden.push(value)})}),$q.when(seleccionOrden).then(function(data){var respuesta={info:info,datos:data,proveedores:proveedores};promesa.resolve(respuesta)})}),promesa.promise},proporcionalXitem:function(item,items){var datos,promesa=$q.defer(),respuesta=[];datos=$filter("filter")(items,item);var cantidad=datos[0].porsurtir,proveedores=datos.length;return angular.forEach(datos,function(value,key){1==value.ITE_segmentable&&(cantidad=parseInt(value.porsurtir/value.ITE_cantidadCaja));var cantidadProporcionada=parseInt(cantidad/proveedores),cantidadSegunProporcion=cantidadProporcionada*proveedores,diferencia=cantidad-cantidadSegunProporcion,id=items.indexOf(value);0==key?items[id].cantidad=cantidadProporcionada+diferencia:items[id].cantidad=cantidadProporcionada,respuesta.push(id)}),$q.when(respuesta).then(function(data){promesa.resolve(items)}),promesa.promise},proveedoresItems:function(items){return $http.post(api+"operacion/proveedores/items",items)},surtirItem:function(datos){return $http.post(api+"operacion/surtir/item/"+$rootScope.id,datos)},surtirOrden:function(datos){return $http.post(api+"operacion/surtir/orden",datos)},verificaFaltantes:function(orden){return $http.get(api+"operacion/completa/orden/"+orden)},verificaItems:function(items){var promesa=$q.defer(),validos=[];return angular.forEach(items,function(value,key){value.cantidad>0&&validos.push(value)}),$q.when(validos).then(function(data){promesa.resolve(data)}),promesa.promise},fechas:function(){$rootScope.fechas={};for(var d=new Date,anioInicio=d.getFullYear(),anioFinal=anioInicio+20,numerador=0,anios=new Array,i=anioInicio;i<anioFinal;i++)anios[numerador]={anio:i},numerador++;$rootScope.fechas.anios=anios;var meses=new Array;return meses[0]={id:"01",nombre:"Enero"},meses[1]={id:"02",nombre:"Febrero"},meses[2]={id:"03",nombre:"Marzo"},meses[3]={id:"04",nombre:"Abril"},meses[4]={id:"05",nombre:"Mayo"},meses[5]={id:"06",nombre:"Junio"},meses[6]={id:"07",nombre:"Julio"},meses[7]={id:"08",nombre:"Agosto"},meses[8]={id:"09",nombre:"Septiembre"},meses[9]={id:"10",nombre:"Octubre"},meses[10]={id:"11",nombre:"Noviembre"},meses[11]={id:"12",nombre:"Diciembre"},$rootScope.fechas.meses=meses,$rootScope.fechas},eliminaReservasAntiguas:function(){return $http.get(api+"operacion/reservasantiguas")},altaLote:function(datos){return $http.post(api+"operacion/alta-lote",datos)}}}angular.module("app").factory("operacion",operacion)}(),function(){"use strict";function pdf($http,busqueda,$q,Upload,api){return{enviaOrden:function(orden){return console.log(orden),$http.get(api+"operacion/envia/orden/"+orden)}}}angular.module("app").factory("pdf",pdf)}(),function(){"use strict";function permisos($resource,api){var Permiso=$resource(api+"permisos/:permiso",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return Permiso}angular.module("app").factory("permisos",permisos)}(),function(){"use strict";function proveedores($resource,api){var Proveedor=$resource(api+"proveedores/:proveedor",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"},remove:{method:"DELETE"}});return Proveedor}angular.module("app").factory("proveedores",proveedores)}(),function(){"use strict";function segundaprueba($resource,api){var SegundaPrueba=$resource(api+"segundaprueba/:SegundaPrueba",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"},remove:{method:"DELETE"}});return SegundaPrueba}angular.module("app").factory("segundaprueba",segundaprueba)}(),function(){"use strict";function reportes($http,api,mensajes,publicfiles){function serializeObj(obj){var result=[];for(var property in obj)result.push(encodeURIComponent(property)+"="+encodeURIComponent(obj[property]));return result.join("&")}return{existencias:function(datos){console.log(datos);var parametros=serializeObj(datos);return $http.get(api+"reportes/existencias?"+parametros)},items:function(datos){return $http.get(api+"reportes/items")},lotes:function(datos){var parametros=serializeObj(datos);return $http.get(api+"reportes/lotes?"+parametros)},movimientos:function(datos){var parametros=serializeObj(datos);return $http.get(api+"reportes/movimientos?"+parametros)},traspasos:function(datos){var parametros=serializeObj(datos);return $http.get(api+"reportes/traspasos?"+parametros)},ordenes:function(datos){return $http.post(api+"reportes/ordenes",datos)},exportar:function(tipo,datos){$http.post(api+"reportes/exportar/"+tipo,datos).success(function(archivo){var link=document.createElement("a");link.href=publicfiles+archivo.file,link.style="visibility:hidden",link.download=publicfiles+archivo.file,document.body.appendChild(link),link.click(),document.body.removeChild(link)}).error(function(data){mensajes.alerta("Error al generar el reporte intentalo nuevamente","error","top right","alert")})},exportarPDF:function(tipo,datos){$http.post(api+"reportes/exportarPDF/"+tipo,datos).success(function(archivo){var link=document.createElement("a");link.href=publicfiles+archivo.file,link.style="visibility:hidden",link.download=publicfiles+archivo.file,document.body.appendChild(link),link.click(),document.body.removeChild(link)}).error(function(data){mensajes.alerta("Error al generar el reporte intentalo nuevamente","error","top right","alert")})},ordenesAbiertas:function(unidades){return $http.get(api+"reportes/expOrdenes/"+unidades).success(function(archivo){var link=document.createElement("a");link.href=publicfiles+archivo.file,link.style="visibility:hidden",link.download=publicfiles+archivo.file,document.body.appendChild(link),link.click(),document.body.removeChild(link)}).error(function(data){mensajes.alerta("Error al generar el reporte intentalo nuevamente","error","top right","alert")})},traspasoPdf:function(cveTraspaso){return window.open(api+"reportes/pdfTraspaso/"+cveTraspaso),$http.get(api+"reportes/pdfTraspaso/"+cveTraspaso).success(function(archivo){}).error(function(data){mensajes.alerta("Error al generar el reporte intentalo nuevamente","error","top right","alert")})}}}angular.module("app").factory("reportes",reportes)}(),function(){"use strict";function segundaprueba($resource,api){var SegundaPrueba=$resource(api+"samus/:SegundaPrueba",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"},remove:{method:"DELETE"}});return SegundaPrueba}angular.module("app").factory("segundaprueba",segundaprueba)}(),function(){"use strict";function subtipositem($resource,api){var TipoItem=$resource(api+"subtipositem/:subtipoitem",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoItem}angular.module("app").factory("subtipositem",subtipositem)}(),function(){"use strict";function tiposajuste($resource,api){var tipoajuste=$resource(api+"tiposajuste/:tipo",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return tipoajuste}angular.module("app").factory("tiposajuste",tiposajuste)}(),function(){"use strict";function tiposalmacen($resource,api){var TipoItem=$resource(api+"tiposalmacen/:tipoalmacen",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoItem}angular.module("app").factory("tiposalmacen",tiposalmacen)}(),function(){"use strict";function tipositem($resource,api){var TipoItem=$resource(api+"tipositem/:tipoitem",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoItem}angular.module("app").factory("tipositem",tipositem)}(),function(){"use strict";function tiposmovimiento($resource,api){var tipomovimietno=$resource(api+"tiposmovimiento/:tipo",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return tipomovimietno}angular.module("app").factory("tiposmovimiento",tiposmovimiento)}(),function(){"use strict";function tiposorden($resource,api){var TipoOrden=$resource(api+"tiposorden/:tipoorden",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return TipoOrden}angular.module("app").factory("tiposorden",tiposorden)}(),function(){"use strict";function unidadesItem($resource,api){var unidad=$resource(api+"unidadesitem/:id",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return unidad}angular.module("app").factory("unidadesItem",unidadesItem)}(),function(){"use strict";function unidades($resource,api){var unidad=$resource(api+"unidades/:unidad",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return unidad}angular.module("app").factory("unidades",unidades)}(),function(){"use strict";function usuarios($resource,api){var User=$resource(api+"usuarios/:usuario",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return User}angular.module("app").factory("usuarios",usuarios)}();