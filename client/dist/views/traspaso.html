<div layout="column" class="white" ng-init="inicio()" >

  <md-whiteframe class="md-whiteframe-4dp">
  <form name="traspasoForm" ng-submit="guardar()">

        <div layout="row">
          <md-subheader class="md-primary" flex>Datos</md-subheader>
          <md-button class="md-icon-button" aria-label="More" ng-click="inicio()">
              <md-tooltip md-direction="bottom">
                Limpiar
              </md-tooltip>
            <ng-md-icon icon="refresh" style="fill:gray" aria-label="Limpiar Datos"></ng-md-icon> 
          </md-button>
        </div>
        <md-divider></md-divider>

        <md-content layout-padding>

            <div layout-gt-sm="row" layout="column" class="no-padding">
              
              <md-input-container flex>
                <label>Almacen Origen</label>
                <md-select placeholder="Almacen Origen" ng-model="datos.almacenOrigen" name="origen" md-on-close="itemsxalmacen(datos.almacenOrigen)" flex>
                  <md-option ng-repeat="almacen in almacenes" value="{{almacen.ALM_clave}}" ng-click="origen(almacen.ALM_nombre)">{{almacen.ALM_nombre}}</md-option>
                </md-select>

              </md-input-container>

              <md-input-container flex>
                <label>Almacen Destino</label>
                <md-select placeholder="Almacen Destino" ng-model="datos.almacenDestino" name="almacenDestino" required md-on-close="verificaAlmacen($event)" flex>
                  <md-option ng-repeat="almacen in almacenes" value="{{almacen.ALM_clave}}" ng-click="destino(almacen.ALM_nombre)">{{almacen.ALM_nombre}}</md-option>
                </md-select>
                <div ng-messages="traspasoForm.almacenDestino.$error" ng-if="traspasoForm.$submitted">
                  <div ng-message="required">Campo obligatorio.</div>
                </div>
              </md-input-container>
              


            </div>

        </md-content>
        

        
        <md-subheader class="md-primary">Traspasar</md-subheader>
        <md-divider></md-divider>
        <md-content layout-align="center center" flex-gt-sm="50">

          <md-list>
            <md-list-item ng-repeat="traspaso in traspasos">
              <p>{{ traspaso.itemNombre }}</p>
              <p>Cantidad: {{ traspaso.cantidad }}</p>
              <md-button class="md-secondary md-icon-button" ng-click="eliminar($index)" aria-label="Eliminar">
                <md-tooltip md-direction="top">
                  Eliminar
                </md-tooltip>
                <ng-md-icon icon="delete" style="fill:red" ></ng-md-icon> 
              </md-button>
            </md-list-item>
          </md-list>

          <md-progress-circular md-mode="indeterminate" ng-show="guardando"></md-progress-circular>
          <md-button class="md-raised md-primary" ng-if="traspasos.length" ng-click="guardar()" ng-hide="guardando" ng-disabled="guardando">Terminar</md-button>

        </md-content>

        <md-content layout-padding>
          
          <div layout-gt-sm="row" layout="column">
            
            <md-autocomplete
                md-input-name="item"
                md-selected-item="item"
                md-search-text="busqueda"
                md-search-text-change="cambioTexto(busqueda)"
                md-item-text="item.ITE_nombre"
                md-selected-item-change = "seleccionaItem(item)"
                md-items="item in consultado(busqueda)"
                md-min-length="0"
                md-floating-label="Selecciona Item"
                flex>
              <md-item-template >
                <span md-highlight-text="busqueda" md-highlight-flags="^i">{{item.ITE_nombre}}</span>
              </md-item-template>
              <md-not-found>
                No se encontro "{{busqueda}}".
              </md-not-found>
            </md-autocomplete>
            <md-input-container flex ng-if="item.TIT_forzoso == '1'">
              <label>Lote</label>
              <md-select placeholder="Lote" ng-model="lote" name="tipo" md-on-close="datosLote(lote)" ng-required="item.TIT_forzoso == '1'">
                <md-option ng-repeat="lote in lotes" value="{{lote}}">{{lote.LOT_numero}} - Disponible:{{ lote.LOT_cantidad }}</md-option>
              </md-select>
            </md-input-container>

            <md-input-container flex>
              <label>Cantidad Disponible</label>
              <input type="number"  name="disponible" ng-model="disponible" disabled> 
            </md-input-container>
            

            <md-input-container flex>
              <label>Cantidad a Traspasar</label>
              <input required type="number" step="1" name="cantidad" ng-model="datos.cantidad" min="1" max="{{disponible}}" ng-change="verificaCantidadLote()">
              <div ng-messages="traspasoForm.cantidad.$error" ng-if="traspasoForm.cantidad.$dirty">
                <div ng-message="required">Cantidad obligatoria</div>
                <div ng-message="min">La cantidad no puede ser 0</div>
                <div ng-message="max">La cantidad no debe ser mayor a la disponible en el lote</div>
              </div>
            </md-input-container>
            
          </div>

        </md-content>
        
        <md-content layout="row" layout-align="center center">
          
          <md-button id="nuevo" class="md-fab boton" aria-label="Guardar" type="button" ng-click="agregar()" ng-disabled="traspasoForm.$invalid">
              <md-tooltip md-direction="top">
                Agregar
              </md-tooltip>
              <ng-md-icon icon="add" style="fill:white"></ng-md-icon> 
          </md-button>
        </md-content>
        
        <br><br>
  </form>
  </md-whiteframe>

</div>