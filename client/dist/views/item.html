
<div layout="column" class="white" ng-init="inicio()">

  <md-whiteframe class="md-whiteframe-4dp">
    
    <form name="itemForm" novalidate ng-submit="guardar()">

    <div layout="row">
      <md-subheader class="md-primary" flex>Datos</md-subheader>
      <md-button class="md-icon-button" aria-label="More" ng-click="inicio()">
          <md-tooltip md-direction="bottom">
            Limpiar
          </md-tooltip>
        <ng-md-icon icon="refresh" style="fill:gray" aria-label="Limpiar Datos"></ng-md-icon> 
      </md-button>
    </div>

    <md-content layout-padding>
      
      <div layout-gt-sm="row" layout="column" class="no-padding">
        
        <md-input-container flex flex-gt-sm="20">
          <label>Codigo</label>
          <input  name="clave" ng-model="datos.codigo" required mayusculas> 
          <div ng-messages="itemForm.clave.$error" ng-if="itemForm.$submitted">
            <div ng-message="required">Campo obligatorio.</div>
          </div>
        </md-input-container>

        <md-input-container flex flex-gt-sm="20">
          <label>Codigo EAN</label>
          <input  name="clave" ng-model="datos.codigoean" mayusculas> 
        </md-input-container>

        <md-input-container flex flex-gt-sm="60">
          <label>Nombre</label>
          <input required name="nombre" ng-model="datos.nombre" mayusculas>
          <div ng-messages="itemForm.nombre.$error" ng-if="itemForm.$submitted">
            <div ng-message="required">Campo obligatorio.</div>
          </div>
        </md-input-container>
        
      </div>
      
      <div layout-gt-sm="row" layout="column" class="no-padding">
        
        <md-input-container flex>
          <label>Precio Venta</label>
          <input  name="precio" ng-model="datos.precio" required dinero> 
          <div ng-messages="itemForm.precio.$error" ng-if="itemForm.$submitted">
            <div ng-message="required">Campo obligatorio.</div>
          </div>
        </md-input-container>

        <md-input-container flex>
          <md-select placeholder="Tipo de Item" ng-model="datos.tipo" name="tipo" required flex >
            <md-option ng-repeat="tipoitem in tipoitems" value="{{tipoitem.TIT_clave}}">{{tipoitem.TIT_nombre}}</md-option>
          </md-select>
          <div ng-messages="itemForm.cantidad.$error" ng-if="itemForm.$submitted">
            <div ng-message="required">Campo obligatorio.</div>
          </div>
        </md-input-container>

        <md-input-container flex>
          <md-select placeholder="Sub Tipo de Item" name="subtipo" ng-model="datos.subtipo" required flex>
            <md-option ng-repeat="subtipoitem in subtipoitems" value="{{subtipoitem.STI_clave}}">{{subtipoitem.STI_nombre}}</md-option>
          </md-select>
          <div ng-messages="itemForm.cantidad.$error" ng-if="itemForm.$submitted">
            <div ng-message="required">Campo obligatorio.</div>
          </div>
        </md-input-container>
        
        <md-input-container flex>
          <md-select placeholder="Presentación" name="presentacion" ng-model="datos.presentacion" required flex>
            <md-option ng-repeat="presentacion in presentaciones" value="{{presentacion.PRE_clave}}">{{presentacion.PRE_nombre}}</md-option>
          </md-select>
          <div ng-messages="itemForm.presentacion.$error" ng-if="itemForm.$submitted">
            <div ng-message="required">Campo obligatorio.</div>
          </div>
        </md-input-container>

        
      </div>

      <div layout-gt-sm="row" layout="column" class="no-padding">
        
          <md-switch ng-model="datos.activo" aria-label="Item Activo" flex>
                  <span ng-if="datos.activo">Item Activo</span>
                  <span ng-if="!datos.activo">Item Inactivo</span>
          </md-switch>

          <md-switch ng-model="datos.agranel" aria-label="Item agranel" flex>
                  <span ng-if="datos.agranel">Item a granel</span>
                  <span ng-if="!datos.agranel">Item no agranel</span>
          </md-switch>

          <md-switch ng-model="datos.segmentado" aria-label="Item segmentable" flex>
                  <span ng-if="datos.segmentado">Item Segmentable</span>
                  <span ng-if="!datos.segmentado">Item No Segmentable</span>
          </md-switch>
          
          <md-switch ng-model="datos.talla" aria-label="Item con Talla" flex>
                  <span ng-if="datos.talla">Item Con Talla</span>
                  <span ng-if="!datos.talla">Item Sin Talla</span>
          </md-switch>
        
          <md-switch ng-model="datos.receta" aria-label="Seleccionable Receta" flex>
                  <span ng-if="datos.receta">Adicionable a Receta</span>
                  <span ng-if="!datos.receta">No Adicionable a Receta</span>
          </md-switch>
      </div>


    </md-content>

    <div ng-if="datos.segmentado">

      <md-subheader class="md-primary">Datos de segmentación</md-subheader>

      <md-content layout-padding>
        
        <div layout-gt-sm="row" layout="column" >
            
            <md-input-container flex>
              <md-select placeholder="Unidades" ng-model="datos.unidad" name="unidad">
                <md-option ng-repeat="unidad in unidades" value="{{unidad.UTI_clave}}">{{unidad.UTI_nombre}}</md-option>
              </md-select>
            </md-input-container>
            <md-input-container flex>
              <label>Cantidad</label>
              <input type="number" numero min="0" name="cantidadCaja" ng-model="datos.cantidadCaja">
            </md-input-container>
          
        </div>

      </md-content>

    </div>
    
    <div ng-if="datos.tipo == 1">

      <md-subheader class="md-primary">Datos de Medicamento</md-subheader>

      <md-content layout-padding>
        
        <div layout="column" class="noppading" >
          
            <md-chips ng-model="sustancias"  
                md-separator-keys="keys"
                placeholder="Ingresa Otra Sustancias"
                delete-button-label="Remove Tag"
                delete-hint="Presiona para remover"
                secondary-placeholder="Agrega Sustancia" 
                readonly="false" flex>
            </md-chips>  
            <br>
            <md-input-container flex>
              <label>Presentación</label>
              <input  name="presentacion" ng-model="datos.presentacionDesc" mayusculas>
            </md-input-container>

            <md-input-container flex>
              <label>Clasificacion</label>
              <input  name="clasif" ng-model="datos.clasificacion" mayusculas>
            </md-input-container>
          
            <md-input-container flex>
              <label>Posologia</label>
              <textarea ng-model="datos.posologia" name="posologia" columns="1" mayusculas></textarea>
            </md-input-container>
        </div>

      </md-content>

    </div>

    <md-subheader class="md-primary">Archivos</md-subheader>
    
    <md-content layout-gt-sm="row" layout="column"  layout-padding>
      <div class="drop-box"  ngf-drop accept="image/*" ngf-drag-over-class="dragover" ngf-multiple="true" ngf-pattern="'image/*" ngf-change="upload($files, $file, $event)" flex>
          <md-button type="button" class="md-raised" accept="image/*" ngf-select="upload($files)" ngf-change="upload($files, $file, $event)" multiple="multiple" ngf-pattern="'image/*">Subir Imagenes</md-button><br>
          Arrastra tus archivos aqui
      </div>

      <md-list flex>
        <md-list-item class="md-3-line relative" ng-repeat="file in imagenes">
          <img ngf-src="file" class="face"  ng-mouseover="ver = true" ng-mouseleave="ver = false">
          <md-button type="button" class="md-fab boton abajo-derecho" ng-click="eliminaImagen($index)" ng-mouseover="ver = true" ng-show="ver" aria-label="Eliminar Imagen">
              <ng-md-icon icon="delete" style="fill:white"></ng-md-icon> 
          </md-button>
          <md-divider md-inset ng-if="!$last"></md-divider>
        </md-list-item>


        <md-list-item class="md-3-line relative" ng-repeat="file in imagenesguardadas">
          <img ng-src="{{file}}" class="face"  ng-mouseover="ver = true" ng-mouseleave="ver = false">
          <md-button type="button" class="md-fab boton abajo-derecho" ng-click="eliminaImagenGuardada($index)" ng-mouseover="ver = true" ng-show="ver" aria-label="Eliminar Imagen">
              <ng-md-icon icon="delete" style="fill:white"></ng-md-icon> 
          </md-button>
          <md-divider md-inset ng-if="!$last"></md-divider>
        </md-list-item>

        
      </md-list>
      
    </md-content>


    <div layout="row" layout-align="center center">
      <md-progress-circular md-mode="indeterminate" ng-show="guardando"></md-progress-circular>
      <md-button id="nuevo" class="md-fab boton" aria-label="Guardar" type="submit" ng-hide="guardando" ng-disabled="itemForm.$invalid">
          <md-tooltip md-direction="top">
            Guardar
          </md-tooltip>
          <ng-md-icon icon="check" style="fill:white"></ng-md-icon> 
      </md-button>
    </div>
    
    </form>
    <br>
    <br>

  </md-whiteframe>

</div>